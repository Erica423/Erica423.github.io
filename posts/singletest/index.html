<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>å•å…ƒæµ‹è¯• | Erica-Blog</title>
<meta name=keywords content="æŠ€æœ¯"><meta name=description content="GOåœ¨çº¿ç¼–è¯‘å™¨ï¼šgo playground Test-Driven Development(TDD) - æµ‹è¯•é©±åŠ¨å¼€å‘ å‘¨æœŸï¼š ç¼–å†™ä¸€ä¸ªæµ‹è¯• è®©ç¼–è¯‘é€šè¿‡ è¿è¡Œæµ‹è¯•ï¼ŒæŸ¥çœ‹å¤±è´¥åŸå› å¹¶æ£€æŸ¥é”™è¯¯æ¶ˆæ¯æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ ç¼–å†™è¶³å¤Ÿçš„ä»£ç ä»¥ä½¿æµ‹è¯•é€š"><meta name=author content="erica423"><link rel=canonical href=https://erica423.github.io/posts/singletest/><link crossorigin=anonymous href=/assets/css/stylesheet.0fd2af49d7c8b1a279992ba82155f4ce3b1d94189758b3b0a99c8692cfdc0be9.css integrity rel="preload stylesheet" as=style><link rel=icon href=https://erica423.github.io/images/dls_icon.png><link rel=icon type=image/png sizes=16x16 href=https://erica423.github.io/images/dls_icon.png><link rel=icon type=image/png sizes=32x32 href=https://erica423.github.io/images/dls_icon.png><link rel=apple-touch-icon href=https://erica423.github.io/images/dls_icon.png><link rel=mask-icon href=https://erica423.github.io/images/dls_icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://erica423.github.io/posts/singletest/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>(function(){""&&prompt("è¯·è¾“å…¥æ–‡ç« å¯†ç ")!==""&&(alert("å¯†ç é”™è¯¯ï¼"),history.back())})()</script><link rel=stylesheet href=https://s1.hdslb.com/bfs/static/jinkela/long/font/regular.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel=stylesheet><script src=https://unpkg.com/@waline/client@v2/dist/waline.js></script><link rel=stylesheet href=https://unpkg.com/@waline/client@v2/dist/waline.css><meta property="og:title" content="å•å…ƒæµ‹è¯•"><meta property="og:description" content="GOåœ¨çº¿ç¼–è¯‘å™¨ï¼šgo playground Test-Driven Development(TDD) - æµ‹è¯•é©±åŠ¨å¼€å‘ å‘¨æœŸï¼š ç¼–å†™ä¸€ä¸ªæµ‹è¯• è®©ç¼–è¯‘é€šè¿‡ è¿è¡Œæµ‹è¯•ï¼ŒæŸ¥çœ‹å¤±è´¥åŸå› å¹¶æ£€æŸ¥é”™è¯¯æ¶ˆæ¯æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ ç¼–å†™è¶³å¤Ÿçš„ä»£ç ä»¥ä½¿æµ‹è¯•é€š"><meta property="og:type" content="article"><meta property="og:url" content="https://erica423.github.io/posts/singletest/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-06-23T15:52:48+08:00"><meta property="article:modified_time" content="2024-06-23T15:52:48+08:00"><meta property="og:site_name" content="erica-blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="å•å…ƒæµ‹è¯•"><meta name=twitter:description content="GOåœ¨çº¿ç¼–è¯‘å™¨ï¼šgo playground Test-Driven Development(TDD) - æµ‹è¯•é©±åŠ¨å¼€å‘ å‘¨æœŸï¼š ç¼–å†™ä¸€ä¸ªæµ‹è¯• è®©ç¼–è¯‘é€šè¿‡ è¿è¡Œæµ‹è¯•ï¼ŒæŸ¥çœ‹å¤±è´¥åŸå› å¹¶æ£€æŸ¥é”™è¯¯æ¶ˆæ¯æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ ç¼–å†™è¶³å¤Ÿçš„ä»£ç ä»¥ä½¿æµ‹è¯•é€š"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://erica423.github.io/posts/"},{"@type":"ListItem","position":2,"name":"å•å…ƒæµ‹è¯•","item":"https://erica423.github.io/posts/singletest/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"å•å…ƒæµ‹è¯•","name":"å•å…ƒæµ‹è¯•","description":"GOåœ¨çº¿ç¼–è¯‘å™¨ï¼šgo playground Test-Driven Development(TDD) - æµ‹è¯•é©±åŠ¨å¼€å‘ å‘¨æœŸï¼š ç¼–å†™ä¸€ä¸ªæµ‹è¯• è®©ç¼–è¯‘é€šè¿‡ è¿è¡Œæµ‹è¯•ï¼ŒæŸ¥çœ‹å¤±è´¥åŸå› å¹¶æ£€æŸ¥é”™è¯¯æ¶ˆæ¯æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ ç¼–å†™è¶³å¤Ÿçš„ä»£ç ä»¥ä½¿æµ‹è¯•é€š","keywords":["æŠ€æœ¯"],"articleBody":" GOåœ¨çº¿ç¼–è¯‘å™¨ï¼šgo playground\nTest-Driven Development(TDD) - æµ‹è¯•é©±åŠ¨å¼€å‘ å‘¨æœŸï¼š\nç¼–å†™ä¸€ä¸ªæµ‹è¯•\nè®©ç¼–è¯‘é€šè¿‡\nè¿è¡Œæµ‹è¯•ï¼ŒæŸ¥çœ‹å¤±è´¥åŸå› å¹¶æ£€æŸ¥é”™è¯¯æ¶ˆæ¯æ˜¯å¾ˆæœ‰æ„ä¹‰çš„\nç¼–å†™è¶³å¤Ÿçš„ä»£ç ä»¥ä½¿æµ‹è¯•é€šè¿‡\né‡æ„\nå¸¸ç”¨åŠŸèƒ½ æµ‹è¯•æ–‡ä»¶å‘½åè§„åˆ™ï¼šxxx_test.go, ä¸xxx.goæ”¾åœ¨åŒä¸€ä¸ªpackageä¸‹\næµ‹è¯•å‡½æ•°å‘½ä»¤ä»¥Testå¼€å¤´\næµ‹è¯•å‡½æ•°åªæ¥å—ä¸€ä¸ª*testing.Tç±»å‹çš„å‚æ•°t ï¼ˆtå°±æ˜¯æµ‹è¯•æ¡†æ¶ä¸­çš„é’©å­hookï¼‰\nt.Errorf(): æ ¼å¼åŒ–è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œä½†æµ‹è¯•ç»§ç»­è¿›è¡Œã€‚f è¡¨ç¤ºæ ¼å¼åŒ–ï¼Œå…è®¸æˆ‘ä»¬æ„å»ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶å°†å€¼æ’å…¥å ä½ç¬¦å€¼ %q ä¸­ã€‚\nt.Fatalf(): æŠ¥å‘Šè‡´å‘½é”™è¯¯ï¼Œå¹¶ç»ˆæ­¢æµ‹è¯•ã€‚\nt.Fail(): æ ‡è®°æµ‹è¯•ç»“æœä¸ºå¤±è´¥çš„ï¼Œä¸åŒçš„æ˜¯t.FailåªæŠŠæµ‹è¯•ç»“æœæ ‡è®°ä¸ºå¤±è´¥ï¼Œä¸ä¼šç»ˆæ­¢å½“å‰æµ‹è¯•ï¼Œt.FailNowåˆ™ä¼šç«‹å³ç»ˆæ­¢å½“å‰çš„æµ‹è¯•å‡½æ•°ï¼Œå¹¶æ ‡è®°ä¸ºå¤±è´¥ã€‚\nt.Helper(): å‘Šè¯‰æµ‹è¯•å¥—ä»¶è¿™ä¸ªæ–¹æ³•æ˜¯è¾…åŠ©å‡½æ•°ï¼ˆhelperï¼‰ã€‚é€šè¿‡è¿™æ ·åšï¼Œå½“æµ‹è¯•å¤±è´¥æ—¶æ‰€æŠ¥å‘Šçš„è¡Œå·å°†åœ¨å‡½æ•°è°ƒç”¨ä¸­è€Œä¸æ˜¯åœ¨è¾…åŠ©å‡½æ•°å†…éƒ¨ã€‚\nSubtest - å­æµ‹è¯• æœ‰æ—¶ï¼Œå¯¹ä¸€ä¸ªã€Œäº‹æƒ…ã€è¿›è¡Œåˆ†ç»„æµ‹è¯•ï¼Œç„¶åå†å¯¹ä¸åŒåœºæ™¯è¿›è¡Œå­æµ‹è¯•éå¸¸æœ‰æ•ˆã€‚\n1 2 3 4 5 6 7 8 9 func TestMain(t *testing.T) { t.Run(\"show expected output of this function\", func(t *testing.T) { }) t.Run(\"...\", func(t *testing.T) { }) } è¿™ç§æ–¹æ³•çš„å¥½å¤„æ˜¯ï¼Œä½ å¯ä»¥å»ºç«‹åœ¨å…¶ä»–æµ‹è¯•ä¸­ä¹Ÿèƒ½å¤Ÿä½¿ç”¨çš„å…±äº«ä»£ç ã€‚ é‡è¦çš„æ˜¯ï¼Œä½ çš„æµ‹è¯•æ¸…æ¥šåœ°è¯´æ˜äº†ä»£ç éœ€è¦åšä»€ä¹ˆã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 func TestHello(t *testing.T) { assertCorrectMessage := func(t *testing.T, got, want string) { t.Helper() if got != want { t.Errorf(\"got '%q' want '%q'\", got, want) } } t.Run(\"saying hello to people\", func(t *testing.T) { got := Hello(\"Chris\") want := \"Hello, Chris\" assertCorrectMessage(t, got, want) }) t.Run(\"empty string defaults to 'world'\", func(t *testing.T) { got := Hello(\"\") want := \"Hello, World\" assertCorrectMessage(t, got, want) }) } åŠæ—¶æ·»åŠ æ³¨é‡Šï¼Œæ–¹ä¾¿ç”ŸæˆAPIæ–‡æ¡£ Swaggerè‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£\nsyntax å¥æ³•\nAdd AND assignment operactor è‡ªå¢èµ‹å€¼è¿ç®—ç¬¦ +=\næ•°ç»„ \u0026 åˆ‡ç‰‡ we are using the %v placeholder to print the â€œdefaultâ€ format, which works well for arrays.\nåœ¨ Go ä¸­ä¸èƒ½å¯¹åˆ‡ç‰‡ä½¿ç”¨ç­‰å·è¿ç®—ç¬¦ã€‚ä½ å¯ä»¥å†™ä¸€ä¸ªå‡½æ•°è¿­ä»£æ¯ä¸ªå…ƒç´ æ¥æ£€æŸ¥å®ƒä»¬çš„å€¼ã€‚ä½†æ˜¯ä¸€ç§æ¯”è¾ƒç®€å•çš„åŠæ³•æ˜¯ä½¿ç”¨ reflect.DeepEqualï¼Œå®ƒåœ¨åˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦ç›¸ç­‰æ—¶ååˆ†æœ‰ç”¨ã€‚ä½†ä¸æ˜¯ç±»å‹å®‰å…¨çš„ã€‚\næ¥å£ åœ¨ Go è¯­è¨€ä¸­ interface resolution æ˜¯éšå¼çš„ã€‚å¦‚æœä¼ å…¥çš„ç±»å‹åŒ¹é…æ¥å£éœ€è¦çš„ï¼Œåˆ™ç¼–è¯‘æ­£ç¡®ã€‚\næµ‹è¯•è¦†ç›–ç‡ 1 go test -cover Table driven tests - è¡¨æ ¼é©±åŠ¨æµ‹è¯• é€‚åˆå¤„ç†åŒè´¨åŒ–çš„æµ‹è¯•å†…å®¹, å¦‚æœä½ è¦æµ‹è¯•ä¸€ä¸ªæ¥å£çš„ä¸åŒå®ç°ï¼Œæˆ–è€…ä¼ å…¥å‡½æ•°çš„æ•°æ®æœ‰å¾ˆå¤šä¸åŒçš„æµ‹è¯•éœ€æ±‚ï¼Œè¿™ä¸ªæ­¦å™¨å°†éå¸¸ç»™åŠ›ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 func TestArea(t *testing.T) { areaTests := []struct { shape Shape want float64 }{ {Rectangle{10.0, 20.0}, 200.0}, {Circle{10.0}, 314.1592653589793}, } for _, tt := range areaTests { got := tt.shape.Area() if got != tt.want { t.Errorf(\"want %.2f but got %.2f\", tt.want, got) } } } ä½¿ç”¨äº†åŒ¿åç»“æ„ä½“ - anonymous struct, ç”¨å«æœ‰ä¸¤ä¸ªåŸŸ shape å’Œ want çš„ []struct å£°æ˜äº†ä¸€ä¸ªç»“æ„ä½“åˆ‡ç‰‡ã€‚\nå¯ä»¥æ”¹è¿›é”™è¯¯è¾“å‡ºä¸º %#v got %.2f want %.2f. %#vï¼Œè¿™æ ·ä¼šæ‰“å°ç»“æ„ä½“ä¸­åŸŸçš„å€¼ã€‚èƒ½ä¸€çœ¼çœ‹å‡ºè¢«æµ‹è¯•çš„å±æ€§ã€‚\nå…³äºåˆ—è¡¨é©±åŠ¨æµ‹è¯•çš„æœ€åä¸€ç‚¹æç¤ºæ˜¯ä½¿ç”¨ t.Runã€‚\nåœ¨æ¯ä¸ªç”¨ä¾‹ä¸­ä½¿ç”¨ t.Runï¼Œæµ‹è¯•ç”¨ä¾‹çš„é”™è¯¯è¾“å‡ºä¸­ä¼šåŒ…å«ç”¨ä¾‹çš„åå­—ï¼š\n1 2 3 -------- FAIL: TestArea (0.00s) --- FAIL: TestArea/Rectangle (0.00s) shapes_test.go:33: main.Rectangle{Width:12, Height:6} got 72.00 want 72.10 è¿è¡Œåˆ—è¡¨ä¸­æŒ‡å®šçš„æµ‹è¯•ç”¨ä¾‹ï¼šgo test -run TestArea/Rectangle\næ£€æŸ¥æœªç»æ£€æŸ¥çš„error æœ‰ä¸€ç§æƒ…å†µæˆ‘ä»¬è¿˜æ²¡æœ‰æµ‹è¯•è¿‡ã€‚è¦æ‰¾åˆ°å®ƒï¼Œåœ¨ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… errcheckï¼Œè¿™æ˜¯è®¸å¤šå¯ç”¨çš„ lintersï¼ˆä»£ç æ£€æµ‹å·¥å…·ï¼‰ä¹‹ä¸€ã€‚\ngo get -u github.com/kisielk/errcheck\nç„¶åï¼Œåœ¨ä»£ç ç›®å½•ä¸­è¿è¡Œ errcheck .\nä¾èµ–æ³¨å…¥ï¼š io.Writer æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€šç”¨æ¥å£ï¼Œç”¨äºã€Œå°†æ•°æ®æ”¾åœ¨æŸä¸ªåœ°æ–¹ã€ã€‚\nfmt.Fprintf å’Œ fmt.Printf ä¸€æ ·ï¼Œåªä¸è¿‡ fmt.Fprintf ä¼šæ¥æ”¶ä¸€ä¸ª Writer å‚æ•°ï¼Œç”¨äºæŠŠå­—ç¬¦ä¸²ä¼ é€’è¿‡å»ï¼Œè€Œ fmt.Printf é»˜è®¤æ˜¯æ ‡å‡†è¾“å‡ºã€‚\næ³¨å…¥ - Mocking å°†ä¾èµ–å…³ç³»å®šä¹‰ä¸ºä¸€ä¸ªæ¥å£ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ main ä½¿ç”¨ çœŸå®çš„ Sleeperï¼Œå¹¶ä¸”åœ¨æˆ‘ä»¬çš„æµ‹è¯•ä¸­ä½¿ç”¨ spy sleeperã€‚é€šè¿‡ä½¿ç”¨æ¥å£ï¼Œæˆ‘ä»¬çš„ Countdown å‡½æ•°å¿½ç•¥äº†è¿™ä¸€ç‚¹ï¼Œå¹¶ä¸ºè°ƒç”¨è€…å¢åŠ äº†ä¸€äº›çµæ´»æ€§ã€‚\nConcurrency åŒ¿åå‡½æ•°æœ‰è®¸å¤šæœ‰ç”¨çš„ç‰¹æ€§ã€‚é¦–å…ˆï¼Œå®ƒä»¬å¯ä»¥åœ¨å£°æ˜çš„åŒæ—¶æ‰§è¡Œ â€”â€” è¿™å°±æ˜¯åŒ¿åå‡½æ•°æœ«å°¾çš„ () å®ç°çš„ã€‚å…¶æ¬¡ï¼Œå®ƒä»¬ç»´æŠ¤å¯¹å…¶æ‰€å®šä¹‰çš„è¯æ±‡ä½œç”¨åŸŸçš„è®¿é—®æƒ â€”â€” åœ¨å£°æ˜åŒ¿åå‡½æ•°æ—¶æ‰€æœ‰å¯ç”¨çš„å˜é‡ä¹Ÿå¯åœ¨å‡½æ•°ä½“å†…ä½¿ç”¨ã€‚\nä¸Šé¢åŒ¿åå‡½æ•°çš„ä¸»ä½“å’Œä¹‹å‰å¾ªç¯ä½“ä¸­çš„å®Œå…¨ä¸€æ ·ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯å¾ªç¯çš„æ¯æ¬¡è¿­ä»£éƒ½ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ goroutineï¼Œä¸å½“å‰è¿›ç¨‹ï¼ˆWebsiteChecker å‡½æ•°ï¼‰åŒæ—¶å‘ç”Ÿï¼Œæ¯ä¸ªå¾ªç¯éƒ½ä¼šå°†ç»“æœæ·»åŠ åˆ° results map ä¸­ã€‚\n1 2 3 4 5 6 7 for _, url := range urls { go func() { results[url] = wc(url) }() } time.Sleep(2 * time.Second) è¿™é‡Œçš„é—®é¢˜æ˜¯å˜é‡ url è¢«é‡å¤ç”¨äº for å¾ªç¯çš„æ¯æ¬¡è¿­ä»£ â€”â€” æ¯æ¬¡éƒ½ä¼šä» urls è·å–æ–°å€¼ã€‚ä½†æ˜¯æˆ‘ä»¬çš„æ¯ä¸ª goroutine éƒ½æ˜¯ url å˜é‡çš„å¼•ç”¨ â€”â€” å®ƒä»¬æ²¡æœ‰è‡ªå·±çš„ç‹¬ç«‹å‰¯æœ¬ã€‚æ‰€ä»¥ä»–ä»¬ éƒ½ ä¼šå†™å…¥åœ¨è¿­ä»£ç»“æŸæ—¶çš„ url â€”â€” æœ€åä¸€ä¸ª urlã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¾—åˆ°çš„ç»“æœæ˜¯æœ€åä¸€ä¸ª urlã€‚\n1 2 3 4 5 6 7 for _, url := range urls { go func(u string) { results[u] = wc(u) }(url) } time.Sleep(2 * time.Second) é€šè¿‡ç»™æ¯ä¸ªåŒ¿åå‡½æ•°ä¸€ä¸ªå‚æ•° url(u)ï¼Œç„¶åç”¨ url ä½œä¸ºå‚æ•°è°ƒç”¨åŒ¿åå‡½æ•°ï¼Œæˆ‘ä»¬ç¡®ä¿ u çš„å€¼å›ºå®šä¸ºå¾ªç¯è¿­ä»£çš„ url å€¼ï¼Œé‡æ–°å¯åŠ¨ goroutineã€‚u æ˜¯ url å€¼çš„å‰¯æœ¬ï¼Œå› æ­¤æ— æ³•æ›´æ”¹ã€‚\nç”¨channelè§£å†³æ•°æ®ç«äº‰ data race\ngoroutines æ˜¯ Go çš„åŸºæœ¬å¹¶å‘å•å…ƒï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥åŒæ—¶æ£€æŸ¥å¤šä¸ªç½‘ç«™ã€‚\nanonymous functionsï¼ˆåŒ¿åå‡½æ•°ï¼‰ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥å¯åŠ¨æ¯ä¸ªæ£€æŸ¥ç½‘ç«™çš„å¹¶å‘è¿›ç¨‹ã€‚\nchannelsï¼Œç”¨æ¥ç»„ç»‡å’Œæ§åˆ¶ä¸åŒè¿›ç¨‹ä¹‹é—´çš„äº¤æµï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿé¿å… race conditionï¼ˆç«äº‰æ¡ä»¶ï¼‰ çš„é—®é¢˜ã€‚\nthe race detectorï¼ˆç«äº‰æ¢æµ‹å™¨ï¼‰ å¸®åŠ©æˆ‘ä»¬è°ƒè¯•å¹¶å‘ä»£ç çš„é—®é¢˜ã€‚\nä½¿ç”¨ select æ—¶ï¼Œtime.After æ˜¯ä¸€ä¸ªå¾ˆå¥½ç”¨çš„å‡½æ•°ã€‚å½“ä½ ç›‘å¬çš„ channel æ°¸è¿œä¸ä¼šè¿”å›ä¸€ä¸ªå€¼æ—¶ä½ å¯ä»¥æ½œåœ¨åœ°ç¼–å†™æ°¸è¿œé˜»å¡çš„ä»£ç ï¼Œå°½ç®¡åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­å®ƒæ²¡æœ‰å‘ç”Ÿã€‚time.After ä¼šåœ¨ä½ å®šä¹‰çš„æ—¶é—´è¿‡åå‘é€ä¸€ä¸ªä¿¡å·ç»™ channel å¹¶è¿”å›ä¸€ä¸ª chan ç±»å‹ï¼ˆå°±åƒ ping é‚£æ ·ï¼‰ã€‚\nvalue æœ‰ä¸€ä¸ªæ–¹æ³• NumFieldï¼Œå®ƒè¿”å›å€¼ä¸­çš„å­—æ®µæ•°\nSync Sync\nWaitGroup ç­‰å¾… goroutine é›†åˆå®Œæˆã€‚ä¸» goroutine è°ƒç”¨ Add è®¾ç½®ç­‰å¾…çš„ goroutine æ•°é‡ã€‚ç„¶åæ¯ä¸ª goroutine è¿è¡Œå¹¶åœ¨å®Œæˆæ—¶è°ƒç”¨ Doneã€‚åŒæ—¶ï¼ŒWait å¯ä»¥ç”¨æ¥é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰ goroutine éƒ½å®Œæˆã€‚\né€šè¿‡åœ¨åšå‡ºæ–­è¨€ä¹‹å‰ç­‰å¾…wg.Wait()å®Œæˆï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šæ‰€æœ‰çš„ goroutine éƒ½å·²å°è¯•Incè¿‡Counterã€‚\nA Mutex must not be copied after first use. Use channels when passing ownership of data\nUse mutexes for managing state\nContext context\næˆ‘ä»¬æ‰€åšçš„æ˜¯ä»æˆ‘ä»¬çš„requestä¸­æ´¾ç”Ÿä¸€ä¸ªæ–°çš„ cancellingCtxï¼Œå®ƒè¿”å›ä¸€ä¸ªcancelå‡½æ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ time.AfterFunc å®‰æ’åœ¨ 5 æ¯«ç§’å†…è°ƒç”¨è¯¥å‡½æ•°ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ request.WithContext åœ¨è¯·æ±‚ä¸­ä½¿ç”¨è¿™ä¸ªæ–°ä¸Šä¸‹æ–‡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 func Server(store Store) http.HandlerFunc { return func(w http.ResponseWriter, r *http.Request) { ctx := r.Context() data := make(chan string, 1) go func() { data \u003c- store.Fetch() }() select { case d := \u003c-data: fmt.Fprint(w, d) case \u003c-ctx.Done(): store.Cancel() } } } contextæœ‰ä¸€ä¸ªæ–¹æ³•Done()è¿”å›ä¸€ä¸ªchannelï¼Œå½“contextâ€œå®Œæˆâ€æˆ–â€œå–æ¶ˆâ€æ—¶ï¼Œè¯¥é€šé“ä¼šå‘é€ä¿¡å·ã€‚ æˆ‘ä»¬æƒ³è¦ç›‘å¬è¯¥ä¿¡å·å¹¶åœ¨æ”¶åˆ°è¯¥ä¿¡å·æ—¶è°ƒç”¨ store.Cancelï¼Œä½†å¦‚æœæˆ‘ä»¬Storeè®¾æ³•åœ¨Fetchå®ƒä¹‹å‰å°±å¿½ç•¥å®ƒã€‚\nå¯¹æœåŠ¡å™¨çš„ä¼ å…¥è¯·æ±‚åº”è¯¥åˆ›å»ºä¸Šä¸‹æ–‡ï¼Œè€Œå¯¹æœåŠ¡å™¨çš„ä¼ å‡ºè°ƒç”¨åº”è¯¥æ¥å—ä¸Šä¸‹æ–‡ã€‚å®ƒä»¬ä¹‹é—´çš„å‡½æ•°è°ƒç”¨é“¾å¿…é¡»ä¼ æ’­ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥é€‰æ‹©å°†å…¶æ›¿æ¢ä¸ºä½¿ç”¨ WithCancelã€WithDeadlineã€WithTimeout æˆ– WithValue åˆ›å»ºçš„æ´¾ç”Ÿä¸Šä¸‹æ–‡ã€‚å½“ä¸€ä¸ªä¸Šä¸‹æ–‡è¢«å–æ¶ˆæ—¶ï¼Œå®ƒæ´¾ç”Ÿçš„æ‰€æœ‰ä¸Šä¸‹æ–‡ä¹Ÿè¢«å–æ¶ˆã€‚\nProperty based tests strings.Builder ç”¨äºä½¿ç”¨å†™å…¥æ–¹æ³•é«˜æ•ˆæ„å»ºå­—ç¬¦ä¸²ã€‚å®ƒæœ€å¤§é™åº¦åœ°å‡å°‘äº†å†…å­˜å¤åˆ¶ã€‚\nç½—é©¬æ•°å­—çš„è§„åˆ™æ˜¯åŒä¸€å­—ç¬¦ä¸èƒ½åœ¨ä¸€è¡Œä¸­é‡å¤è¶…è¿‡ 3 æ¬¡ã€‚ å–è€Œä»£ä¹‹çš„æ˜¯å–ä¸‹ä¸€ä¸ªæœ€é«˜çš„ç¬¦å·ï¼Œç„¶ååœ¨å…¶å·¦ä¾§æ”¾ç½®ä¸€ä¸ªç¬¦å·æ¥ â€œå‡å»â€ã€‚ å¹¶éæ‰€æœ‰ç¬¦å·éƒ½å¯ä»¥ç”¨ä½œå‡æ³•å™¨ï¼›åªæœ‰ I (1)ã€X (10) å’Œ C (100)ã€‚\nä¾‹å¦‚ï¼Œç½—é©¬æ•°å­—ä¸­çš„ 5 æ˜¯ Vã€‚è¦åˆ›å»º 4ï¼Œæ‚¨ä¸æ‰§è¡Œ IIIIï¼Œè€Œæ˜¯æ‰§è¡Œ IVã€‚\nRomanNumeralè§„åˆ™ï¼š\nä¸èƒ½æœ‰è¶…è¿‡ 3 ä¸ªè¿ç»­çš„ç¬¦å·\nåªæœ‰ I (1), X (10) å’Œ C (100) æ˜¯ ã€Œå‡æ³•å™¨ã€\nå°† ConvertToRoman(N) çš„ç»“æœä¼ é€’ç»™ ConvertToArabic ï¼Œåº”è¯¥è¿”å› Nã€‚\nåŸºäºå±æ€§çš„æµ‹è¯•é€šè¿‡å‘ä»£ç ä¸­æŠ›å‡ºéšæœºæ•°æ®å¹¶éªŒè¯æ‰€æè¿°çš„è§„åˆ™å§‹ç»ˆä¸ºçœŸæ¥å¸®åŠ©æ‚¨åšåˆ°è¿™ä¸€ç‚¹ã€‚å¾ˆå¤šäººè®¤ä¸ºåŸºäºå±æ€§çš„æµ‹è¯•ä¸»è¦æ˜¯å…³äºéšæœºæ•°æ®çš„ï¼Œä½†ä»–ä»¬æ˜¯é”™è¯¯çš„ã€‚ åŸºäºå±æ€§çš„æµ‹è¯•é¢ä¸´çš„çœŸæ­£æŒ‘æˆ˜æ˜¯ä½ å¯¹ä½ çš„é¢†åŸŸæœ‰ã€Œå¾ˆå¥½çš„ã€ç†è§£ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥ç¼–å†™è¿™äº›å±æ€§ã€‚\nä»åº•éƒ¨è¯»å–ï¼Œæˆ‘ä»¬ä¸º quick.Check æä¾›äº†ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå°†è¿è¡Œä¸€äº›éšæœºçš„è¾“å…¥ï¼Œå¦‚æœå‡½æ•°è¿”å› falseï¼Œå®ƒå°†è¢«è§†ä¸ºæ£€æŸ¥å¤±è´¥ã€‚\nä¸Šé¢çš„ assertion å‡½æ•°æ¥å—éšæœºæ•°å¹¶è¿è¡Œå‡½æ•°æ¥æµ‹è¯•å±æ€§ã€‚\nä½ ä¸èƒ½ç”¨ç½—é©¬æ•°å­—è¡¨ç¤ºè´Ÿæ•°\næ ¹æ®æˆ‘ä»¬æœ€å¤š 3 ä¸ªè¿ç»­ç¬¦å·çš„è§„åˆ™ï¼Œæˆ‘ä»¬ä¸èƒ½è¡¨ç¤ºå¤§äº 3999 çš„å€¼ (ç½—é©¬æ•°å­—çš„æœ€å¤§å€¼)ï¼Œè€Œ int çš„æœ€å¤§å€¼æ¯” 3999 å¤§å¾—å¤šã€‚ å› æ­¤ä½¿ç”¨uint16\nå†…ç½®çš„è·¯ç”±æœºåˆ¶å«åš ServeMuxï¼ˆrequest multiplexerï¼Œå¤šè·¯è¯·æ±‚å¤ç”¨å™¨ï¼‰ï¼Œå®ƒå…è®¸ä½ å°† http.Handler é™„åŠ åˆ°ç‰¹å®šçš„è¯·æ±‚è·¯å¾„ã€‚\nWe changed the second property of PlayerServer, removing the named property router http.ServeMux and replaced it with http.Handler; this is called embedding.\nGo does not provide the typical, type-driven notion of subclassing, but it does have the ability to â€œborrowâ€ pieces of an implementation by embedding types within a struct or interface.\nè¿™æ„å‘³ç€æˆ‘ä»¬çš„ PlayerServer ç°åœ¨å·²ç»æœ‰äº† http.Handler æ‰€æœ‰çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ ServeHTTPã€‚\nä¸ºäº† â€œå¡«å……â€ http.Handlerï¼Œæˆ‘ä»¬å°†å®ƒåˆ†é…ç»™æˆ‘ä»¬åœ¨ NewPlayerServer ä¸­åˆ›å»ºçš„ routerã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åšæ˜¯å› ä¸º http.ServeMux å…·æœ‰ ServeHTTP æ–¹æ³•ã€‚\nè¿™å…è®¸æˆ‘ä»¬åˆ é™¤æˆ‘ä»¬çš„ ServeHTTP æ–¹æ³•ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»é€šè¿‡åµŒå…¥ç±»å‹å…¬å¼€äº†å®ƒã€‚\nåµŒå…¥æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ„æ€çš„è¯­æ³•ç‰¹æ€§ã€‚ä½ å¯ä»¥ç”¨å®ƒå°†æ¥å£ç»„æˆæ–°çš„æ¥å£ã€‚\nIOå’Œæ’åº æœåŠ¡å™¨é‡å¯ä¼šé‡ç½®ç§¯åˆ†\nos.OpenFile å…è®¸ä½ å®šä¹‰æ‰“å¼€æ–‡ä»¶çš„æƒé™ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒO_RDWR æ„å‘³ç€æˆ‘ä»¬æƒ³è¦è¯»å†™æƒé™ï¼Œos.O_CREATE æ˜¯æŒ‡å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥æ–‡ä»¶ã€‚\nåˆ›å»ºä¸€ä¸ªæ–°ç±»å‹æ¥å°è£…æˆ‘ä»¬çš„ã€Œå½“å†™å…¥æ—¶ï¼Œä»å¤´éƒ¨å¼€å§‹ã€åŠŸèƒ½ã€‚æˆ‘æŠŠå®ƒå«åš Tape.\nfile.Stat è¿”å›æˆ‘ä»¬çš„æ–‡ä»¶çš„ç»Ÿè®¡æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥æ£€æŸ¥æ–‡ä»¶çš„å¤§å°ï¼Œå¦‚æœå®ƒæ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬å°±ä¼šç¼–å†™ä¸€ä¸ªç©ºçš„ JSON æ•°ç»„ï¼Œç„¶å Seek åˆ°å¼€å§‹ä½ç½®ï¼Œä¸ºå‰©ä¸‹çš„ä»£ç åšå‡†å¤‡ã€‚\nå‘½ä»¤è¡Œå’Œé¡¹ç›®ç»“æ„ å½“ç”¨æˆ·è¾“å…¥ Ruth wins æ—¶ï¼Œå®ƒåªéœ€è¦èƒ½å¤Ÿè®°å½•ç©å®¶çš„èƒœå‡ºæƒ…å†µï¼Œæœ€ç»ˆç›®çš„æ˜¯ä½œä¸ºä¸€ä¸ªå¸®åŠ©ç”¨æˆ·ç©æ‰‘å…‹çš„å·¥å…·ã€‚\näº§å“è´Ÿè´£äººå¸Œæœ›åœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´å…±äº«æ•°æ®åº“ï¼Œä»¥ä¾¿ç©å®¶leagueæ ¹æ®æ–°ç¨‹åºä¸­è®°å½•çš„winsè¿›è¡Œæ›´æ–°ã€‚\nç¬¬ä¸€ä¸ªéœ€æ±‚å°±æ˜¯å½“ç”¨æˆ·è¾“å…¥ {PlayerName} wins æ—¶è®°å½•ä¸€æ¬¡èƒœåˆ©ã€‚\nbufio åŒ…å®ç°äº† I/O ç¼“å†²ã€‚å®ƒå°è£…äº†ä¸€ä¸ª io.Reader æˆ– io.Writer å¯¹è±¡ï¼Œåˆ›å»ºäº†å¦ä¸€ä¸ªå¯¹è±¡ï¼ˆReader æˆ– Writerï¼‰ï¼Œä¹Ÿå®ç°äº†æ¥å£ï¼Œå¹¶ä¸ºæ–‡æœ¬ I/O æä¾›äº†ç¼“å†²å’Œä¸€äº›å¸®åŠ©ã€‚\nScanner.Scan() ä¼šé€è¡Œè¯»å–å†…å®¹ã€‚ ç„¶åä½¿ç”¨ Scanner.Text() æ¥è¿”å› scanner è¯»å–çš„ stringã€‚ æˆ‘ä»¬å°†å®ƒå°è£…åˆ°ä¸€ä¸ªåä¸º readLine() çš„å‡½æ•°ä¸­ã€‚\nBenchmarking - åŸºå‡†æµ‹è¯• ç”¨ go test -bench=. æ¥è¿è¡ŒåŸºå‡†æµ‹è¯•ã€‚ (å¦‚æœåœ¨ Windows Powershell ç¯å¢ƒä¸‹ä½¿ç”¨ go test -bench=\".\")\nTips: benchmarksé»˜è®¤é¡ºåºæ‰§è¡Œã€‚\n1 2 3 4 5 func BenchmarkRepeat(b *testing.B) { for i := 0; i \u003c b.N; i ++ { Repeat(\"A\") } } testing.B å¯ä½¿ä½ è®¿é—®éšæ€§å‘½åï¼ˆcryptically namedï¼‰b.Nã€‚\nåŸºå‡†æµ‹è¯•è¿è¡Œæ—¶ï¼Œä»£ç ä¼šè¿è¡Œ b.N æ¬¡ï¼Œå¹¶æµ‹é‡éœ€è¦å¤šé•¿æ—¶é—´ã€‚\nä»£ç è¿è¡Œçš„æ¬¡æ•°ä¸ä¼šå¯¹ä½ äº§ç”Ÿå½±å“ï¼Œæµ‹è¯•æ¡†æ¶ä¼šé€‰æ‹©ä¸€ä¸ªå®ƒæ‰€è®¤ä¸ºçš„æœ€ä½³å€¼ï¼Œä»¥ä¾¿è®©ä½ è·å¾—æ›´åˆç†çš„ç»“æœã€‚\nGoConveyï¼ˆæµ‹è¯•æ¡†æ¶ï¼‰ 1 2 import \"github.com/smartystreets/goconvey/convey\" go get github.com/smartystreets/goconvey convey.Convey å®šä¹‰äº†æµ‹è¯•ç”¨ä¾‹åç§°ã€t æŒ‡é’ˆã€æµ‹è¯•ä»£ç ã€‚ convey.So` ç”¨æ¥åˆ¤æ–­é¢„æœŸç»“æœã€‚ convey æä¾›äº†å¤§é‡çš„æ–­è¨€å‡½æ•°ï¼Œæ¯”å¦‚åˆšæ‰ä½¿ç”¨çš„ convey.ShouldBeTrueï¼Œå°±æ˜¯åˆ¤æ–­ ok çš„å€¼åº”è¯¥ä¸º trueã€‚\n1 2 3 4 5 6 func TestCheckUrl(t *testing.T) { convey.Convey(\"TestCheckTeachUrl\", t, func() { ok:=CheckUrl(\"learnku.com\") convey.So(ok,convey.ShouldBeTrue) }) } GoConvey å®˜æ–¹æ–‡æ¡£ï¼šAssertions Â· smartystreets/goconvey Wiki Â· GitHub\nTestifyï¼ˆæ–­è¨€ï¼‰ Testify ä¹Ÿæ˜¯ä¸€ä¸ªæ–­è¨€åº“ï¼ŒåŠŸèƒ½ç›¸å¯¹äº GoConvey è€Œè¨€æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯åœ¨æä¾›æ–­è¨€åŠŸèƒ½ä¹‹å¤–ï¼Œæä¾›äº† mock çš„åŠŸèƒ½ã€‚\n1 2 import \"github.com/stretchr/testify\" go get -t github.com/stretchr/testify eg:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 func TestCheckUrl3(t *testing.T) { assert := assert.New(t) var tests = []struct { input string expected bool }{ {\"xdcute.com\", true}, {\"xxx.com\", false}, } for _, test := range tests { fmt.Println(test.input) assert.Equal(CheckUrl(test.input), test.expected) } } GoMockï¼ˆæ¨¡æ‹Ÿæ¥å£ï¼‰ mock å·¥å…·çš„ä½œç”¨æ˜¯æŒ‡å®šå‡½æ•°çš„è¡Œä¸ºï¼ˆæ¨¡æ‹Ÿå‡½æ•°çš„è¡Œä¸ºï¼‰ã€‚å¯ä»¥å¯¹å…¥å‚è¿›è¡Œæ ¡éªŒï¼Œå¯¹å‡ºå‚è¿›è¡Œè®¾å®šï¼Œè¿˜å¯ä»¥æŒ‡å®šå‡½æ•°çš„è¿”å›å€¼ã€‚\nå¹¶è¡Œæµ‹è¯• func (b *B) RunParallel(body func(*PB))ä¼šä»¥å¹¶è¡Œçš„æ–¹å¼æ‰§è¡Œç»™å®šçš„åŸºå‡†æµ‹è¯•ã€‚\nRunParallelä¼šåˆ›å»ºå‡ºå¤šä¸ªgoroutineï¼Œå¹¶å°†b.Nåˆ†é…ç»™è¿™äº›goroutineæ‰§è¡Œï¼Œ å…¶ä¸­goroutineæ•°é‡çš„é»˜è®¤å€¼ä¸ºGOMAXPROCSã€‚ç”¨æˆ·å¦‚æœæƒ³è¦å¢åŠ éCPUå—é™ï¼ˆnon-CPU-boundï¼‰åŸºå‡†æµ‹è¯•çš„å¹¶è¡Œæ€§ï¼Œ é‚£ä¹ˆå¯ä»¥åœ¨RunParallelä¹‹å‰è°ƒç”¨SetParallelism ã€‚RunParallelé€šå¸¸ä¼šä¸-cpuæ ‡å¿—ä¸€åŒä½¿ç”¨ã€‚\nå‚è€ƒæ–‡ç«  â€œhttps://studygolang.gitbook.io/learn-go-with-tests/\" â€œhttps://quii.gitbook.io/learn-go-with-tests/\" ","wordCount":"4522","inLanguage":"en","datePublished":"2024-06-23T15:52:48+08:00","dateModified":"2024-06-23T15:52:48+08:00","author":{"@type":"Person","name":"erica423"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://erica423.github.io/posts/singletest/"},"publisher":{"@type":"Organization","name":"Erica-Blog","logo":{"@type":"ImageObject","url":"https://erica423.github.io/images/dls_icon.png"}}}</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://erica423.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://erica423.github.io/images/dls_icon.png alt aria-label=logo height=25>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://erica423.github.io/archives/ title=ğŸ®åŠ¨æ€><span>ğŸ®åŠ¨æ€</span></a></li><li><a href=https://erica423.github.io/tags/ title=ğŸ²æ ‡ç­¾><span>ğŸ²æ ‡ç­¾</span></a></li><li><a href=https://erica423.github.io/search/ title="ğŸ¯æœç´¢ (Alt + /)" accesskey=/><span>ğŸ¯æœç´¢</span></a></li><li><a href=https://github.com/Erica423/Erica423.github.io/ title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://erica423.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://erica423.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">å•å…ƒæµ‹è¯•</h1><div class=post-meta><span title='2024-06-23 15:52:48 +0800 +0800'>June 23, 2024</span>&nbsp;Â·&nbsp;erica423&nbsp;|&nbsp;<a href=https://github.com/Erica423/Erica423.github.io rel="noopener noreferrer" target=_blank>ä¸»é¡µ</a><div class=meta-item>&nbspÂ·&nbsp
	      <span id=busuanzi_container_page_pv>æœ¬æ–‡é˜…è¯»é‡<span id=busuanzi_value_page_pv></span>æ¬¡</span></div></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#test-driven-developmenttdd---æµ‹è¯•é©±åŠ¨å¼€å‘>Test-Driven Development(TDD) - æµ‹è¯•é©±åŠ¨å¼€å‘</a><ul><li><a href=#å¸¸ç”¨åŠŸèƒ½>å¸¸ç”¨åŠŸèƒ½</a></li><li><a href=#subtest---å­æµ‹è¯•>Subtest - å­æµ‹è¯•</a></li><li><a href=#åŠæ—¶æ·»åŠ æ³¨é‡Šæ–¹ä¾¿ç”Ÿæˆapiæ–‡æ¡£>åŠæ—¶æ·»åŠ æ³¨é‡Šï¼Œæ–¹ä¾¿ç”ŸæˆAPIæ–‡æ¡£</a></li><li><a href=#æ•°ç»„--åˆ‡ç‰‡>æ•°ç»„ & åˆ‡ç‰‡</a></li><li><a href=#æ¥å£>æ¥å£</a></li><li><a href=#æµ‹è¯•è¦†ç›–ç‡>æµ‹è¯•è¦†ç›–ç‡</a></li></ul></li><li><a href=#table-driven-tests---è¡¨æ ¼é©±åŠ¨æµ‹è¯•>Table driven tests - è¡¨æ ¼é©±åŠ¨æµ‹è¯•</a><ul><li><a href=#æ³¨å…¥---mocking>æ³¨å…¥ - Mocking</a></li><li><a href=#concurrency>Concurrency</a></li><li><a href=#sync>Sync</a></li><li><a href=#context>Context</a></li><li><a href=#property-based-tests>Property based tests</a></li><li><a href=#ioå’Œæ’åº>IOå’Œæ’åº</a></li><li><a href=#å‘½ä»¤è¡Œå’Œé¡¹ç›®ç»“æ„>å‘½ä»¤è¡Œå’Œé¡¹ç›®ç»“æ„</a></li></ul></li><li><a href=#benchmarking---åŸºå‡†æµ‹è¯•>Benchmarking - åŸºå‡†æµ‹è¯•</a></li><li><a href=#goconveyæµ‹è¯•æ¡†æ¶>GoConveyï¼ˆæµ‹è¯•æ¡†æ¶ï¼‰</a></li><li><a href=#testifyæ–­è¨€>Testifyï¼ˆæ–­è¨€ï¼‰</a></li><li><a href=#gomockæ¨¡æ‹Ÿæ¥å£>GoMockï¼ˆæ¨¡æ‹Ÿæ¥å£ï¼‰</a></li><li><a href=#å¹¶è¡Œæµ‹è¯•>å¹¶è¡Œæµ‹è¯•</a></li><li><a href=#å‚è€ƒæ–‡ç« >å‚è€ƒæ–‡ç« </a></li></ul></nav></div></details></div><div class=post-content><hr><p>GOåœ¨çº¿ç¼–è¯‘å™¨ï¼š<a href=https://go.dev/play/p/ICCWcRGIO68>go playground</a></p><h2 id=test-driven-developmenttdd---æµ‹è¯•é©±åŠ¨å¼€å‘>Test-Driven Development(TDD) - æµ‹è¯•é©±åŠ¨å¼€å‘<a hidden class=anchor aria-hidden=true href=#test-driven-developmenttdd---æµ‹è¯•é©±åŠ¨å¼€å‘>#</a></h2><p>å‘¨æœŸï¼š</p><ol><li><p>ç¼–å†™ä¸€ä¸ªæµ‹è¯•</p></li><li><p>è®©ç¼–è¯‘é€šè¿‡</p></li><li><p>è¿è¡Œæµ‹è¯•ï¼ŒæŸ¥çœ‹å¤±è´¥åŸå› å¹¶æ£€æŸ¥é”™è¯¯æ¶ˆæ¯æ˜¯å¾ˆæœ‰æ„ä¹‰çš„</p></li><li><p>ç¼–å†™è¶³å¤Ÿçš„ä»£ç ä»¥ä½¿æµ‹è¯•é€šè¿‡</p></li><li><p>é‡æ„</p></li></ol><h3 id=å¸¸ç”¨åŠŸèƒ½>å¸¸ç”¨åŠŸèƒ½<a hidden class=anchor aria-hidden=true href=#å¸¸ç”¨åŠŸèƒ½>#</a></h3><ul><li><p>æµ‹è¯•æ–‡ä»¶å‘½åè§„åˆ™ï¼š<code>xxx_test.go</code>, ä¸<code>xxx.go</code>æ”¾åœ¨åŒä¸€ä¸ªpackageä¸‹</p></li><li><p>æµ‹è¯•å‡½æ•°å‘½ä»¤ä»¥<code>Test</code>å¼€å¤´</p></li><li><p>æµ‹è¯•å‡½æ•°åªæ¥å—ä¸€ä¸ª<code>*testing.T</code>ç±»å‹çš„å‚æ•°t ï¼ˆtå°±æ˜¯æµ‹è¯•æ¡†æ¶ä¸­çš„é’©å­hookï¼‰</p></li><li><p><code>t.Errorf()</code>: æ ¼å¼åŒ–è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œä½†æµ‹è¯•ç»§ç»­è¿›è¡Œã€‚<code>f</code> è¡¨ç¤ºæ ¼å¼åŒ–ï¼Œå…è®¸æˆ‘ä»¬æ„å»ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶å°†å€¼æ’å…¥å ä½ç¬¦å€¼ <code>%q</code> ä¸­ã€‚</p></li><li><p><code>t.Fatalf()</code>: æŠ¥å‘Šè‡´å‘½é”™è¯¯ï¼Œå¹¶ç»ˆæ­¢æµ‹è¯•ã€‚</p></li><li><p><code>t.Fail()</code>: æ ‡è®°æµ‹è¯•ç»“æœä¸ºå¤±è´¥çš„ï¼Œä¸åŒçš„æ˜¯<code>t.Fail</code>åªæŠŠæµ‹è¯•ç»“æœæ ‡è®°ä¸ºå¤±è´¥ï¼Œä¸ä¼šç»ˆæ­¢å½“å‰æµ‹è¯•ï¼Œ<code>t.FailNow</code>åˆ™ä¼šç«‹å³ç»ˆæ­¢å½“å‰çš„æµ‹è¯•å‡½æ•°ï¼Œå¹¶æ ‡è®°ä¸ºå¤±è´¥ã€‚</p></li><li><p><code>t.Helper()</code>: å‘Šè¯‰æµ‹è¯•å¥—ä»¶è¿™ä¸ªæ–¹æ³•æ˜¯è¾…åŠ©å‡½æ•°ï¼ˆhelperï¼‰ã€‚é€šè¿‡è¿™æ ·åšï¼Œå½“æµ‹è¯•å¤±è´¥æ—¶æ‰€æŠ¥å‘Šçš„è¡Œå·å°†åœ¨å‡½æ•°è°ƒç”¨ä¸­è€Œä¸æ˜¯åœ¨è¾…åŠ©å‡½æ•°å†…éƒ¨ã€‚</p></li></ul><h3 id=subtest---å­æµ‹è¯•>Subtest - å­æµ‹è¯•<a hidden class=anchor aria-hidden=true href=#subtest---å­æµ‹è¯•>#</a></h3><p>æœ‰æ—¶ï¼Œå¯¹ä¸€ä¸ªã€Œäº‹æƒ…ã€è¿›è¡Œåˆ†ç»„æµ‹è¯•ï¼Œç„¶åå†å¯¹ä¸åŒåœºæ™¯è¿›è¡Œå­æµ‹è¯•éå¸¸æœ‰æ•ˆã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestMain</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>t</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;show expected output of this function&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>t</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;...&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™ç§æ–¹æ³•çš„å¥½å¤„æ˜¯ï¼Œä½ å¯ä»¥å»ºç«‹åœ¨å…¶ä»–æµ‹è¯•ä¸­ä¹Ÿèƒ½å¤Ÿä½¿ç”¨çš„å…±äº«ä»£ç ã€‚
é‡è¦çš„æ˜¯ï¼Œä½ çš„æµ‹è¯•æ¸…æ¥šåœ°è¯´æ˜äº†ä»£ç éœ€è¦åšä»€ä¹ˆã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestHello</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>assertCorrectMessage</span> <span class=o>:=</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>,</span> <span class=nx>got</span><span class=p>,</span> <span class=nx>want</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>t</span><span class=p>.</span><span class=nf>Helper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>got</span> <span class=o>!=</span> <span class=nx>want</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;got &#39;%q&#39; want &#39;%q&#39;&#34;</span><span class=p>,</span> <span class=nx>got</span><span class=p>,</span> <span class=nx>want</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>t</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;saying hello to people&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>got</span> <span class=o>:=</span> <span class=nf>Hello</span><span class=p>(</span><span class=s>&#34;Chris&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>want</span> <span class=o>:=</span> <span class=s>&#34;Hello, Chris&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nf>assertCorrectMessage</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=nx>got</span><span class=p>,</span> <span class=nx>want</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>t</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;empty string defaults to &#39;world&#39;&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>got</span> <span class=o>:=</span> <span class=nf>Hello</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>want</span> <span class=o>:=</span> <span class=s>&#34;Hello, World&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nf>assertCorrectMessage</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=nx>got</span><span class=p>,</span> <span class=nx>want</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=åŠæ—¶æ·»åŠ æ³¨é‡Šæ–¹ä¾¿ç”Ÿæˆapiæ–‡æ¡£>åŠæ—¶æ·»åŠ æ³¨é‡Šï¼Œæ–¹ä¾¿ç”ŸæˆAPIæ–‡æ¡£<a hidden class=anchor aria-hidden=true href=#åŠæ—¶æ·»åŠ æ³¨é‡Šæ–¹ä¾¿ç”Ÿæˆapiæ–‡æ¡£>#</a></h3><p><a href=https://zhuanlan.zhihu.com/p/679637398>Swaggerè‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£</a></p><blockquote><p>syntax å¥æ³•</p><p>Add AND assignment operactor è‡ªå¢èµ‹å€¼è¿ç®—ç¬¦ +=</p></blockquote><h3 id=æ•°ç»„--åˆ‡ç‰‡>æ•°ç»„ & åˆ‡ç‰‡<a hidden class=anchor aria-hidden=true href=#æ•°ç»„--åˆ‡ç‰‡>#</a></h3><p>we are using the <code>%v</code> placeholder to print the &ldquo;default&rdquo; format, which works well for arrays.</p><p>åœ¨ Go ä¸­ä¸èƒ½å¯¹åˆ‡ç‰‡ä½¿ç”¨ç­‰å·è¿ç®—ç¬¦ã€‚ä½ å¯ä»¥å†™ä¸€ä¸ªå‡½æ•°è¿­ä»£æ¯ä¸ªå…ƒç´ æ¥æ£€æŸ¥å®ƒä»¬çš„å€¼ã€‚ä½†æ˜¯ä¸€ç§æ¯”è¾ƒç®€å•çš„åŠæ³•æ˜¯ä½¿ç”¨ <code>reflect.DeepEqual</code>ï¼Œå®ƒåœ¨åˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦ç›¸ç­‰æ—¶ååˆ†æœ‰ç”¨ã€‚<strong>ä½†ä¸æ˜¯ç±»å‹å®‰å…¨çš„</strong>ã€‚</p><h3 id=æ¥å£>æ¥å£<a hidden class=anchor aria-hidden=true href=#æ¥å£>#</a></h3><p>åœ¨ Go è¯­è¨€ä¸­ interface resolution æ˜¯éšå¼çš„ã€‚å¦‚æœä¼ å…¥çš„ç±»å‹åŒ¹é…æ¥å£éœ€è¦çš„ï¼Œåˆ™ç¼–è¯‘æ­£ç¡®ã€‚</p><h3 id=æµ‹è¯•è¦†ç›–ç‡>æµ‹è¯•è¦†ç›–ç‡<a hidden class=anchor aria-hidden=true href=#æµ‹è¯•è¦†ç›–ç‡>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>go</span> <span class=nx>test</span> <span class=o>-</span><span class=nx>cover</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=table-driven-tests---è¡¨æ ¼é©±åŠ¨æµ‹è¯•>Table driven tests - è¡¨æ ¼é©±åŠ¨æµ‹è¯•<a hidden class=anchor aria-hidden=true href=#table-driven-tests---è¡¨æ ¼é©±åŠ¨æµ‹è¯•>#</a></h2><p>é€‚åˆå¤„ç†åŒè´¨åŒ–çš„æµ‹è¯•å†…å®¹, å¦‚æœä½ è¦æµ‹è¯•ä¸€ä¸ªæ¥å£çš„ä¸åŒå®ç°ï¼Œæˆ–è€…ä¼ å…¥å‡½æ•°çš„æ•°æ®æœ‰å¾ˆå¤šä¸åŒçš„æµ‹è¯•éœ€æ±‚ï¼Œè¿™ä¸ªæ­¦å™¨å°†éå¸¸ç»™åŠ›ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestArea</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>areaTests</span> <span class=o>:=</span> <span class=p>[]</span><span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>shape</span> <span class=nx>Shape</span>
</span></span><span class=line><span class=cl>		<span class=nx>want</span>  <span class=kt>float64</span>
</span></span><span class=line><span class=cl>	<span class=p>}{</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span><span class=nx>Rectangle</span><span class=p>{</span><span class=mf>10.0</span><span class=p>,</span> <span class=mf>20.0</span><span class=p>},</span> <span class=mf>200.0</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span><span class=nx>Circle</span><span class=p>{</span><span class=mf>10.0</span><span class=p>},</span> <span class=mf>314.1592653589793</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>tt</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>areaTests</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>got</span> <span class=o>:=</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>shape</span><span class=p>.</span><span class=nf>Area</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>got</span> <span class=o>!=</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>want</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;want %.2f but got %.2f&#34;</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>want</span><span class=p>,</span> <span class=nx>got</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ä½¿ç”¨äº†åŒ¿åç»“æ„ä½“ - anonymous struct, ç”¨å«æœ‰ä¸¤ä¸ªåŸŸ shape å’Œ want çš„ []struct å£°æ˜äº†ä¸€ä¸ªç»“æ„ä½“åˆ‡ç‰‡ã€‚</p><p>å¯ä»¥æ”¹è¿›é”™è¯¯è¾“å‡ºä¸º <code>%#v got %.2f want %.2f. %#v</code>ï¼Œè¿™æ ·ä¼šæ‰“å°ç»“æ„ä½“ä¸­åŸŸçš„å€¼ã€‚èƒ½ä¸€çœ¼çœ‹å‡ºè¢«æµ‹è¯•çš„å±æ€§ã€‚</p><p>å…³äºåˆ—è¡¨é©±åŠ¨æµ‹è¯•çš„æœ€åä¸€ç‚¹æç¤ºæ˜¯ä½¿ç”¨ t.Runã€‚</p><p>åœ¨æ¯ä¸ªç”¨ä¾‹ä¸­ä½¿ç”¨ <code>t.Run</code>ï¼Œæµ‹è¯•ç”¨ä¾‹çš„é”™è¯¯è¾“å‡ºä¸­ä¼šåŒ…å«ç”¨ä¾‹çš„åå­—ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>-------- FAIL: TestArea (0.00s)
</span></span><span class=line><span class=cl>    --- FAIL: TestArea/Rectangle (0.00s)
</span></span><span class=line><span class=cl>        shapes_test.go:33: main.Rectangle{Width:12, Height:6} got 72.00 want 72.10
</span></span></code></pre></td></tr></table></div></div><p>è¿è¡Œåˆ—è¡¨ä¸­æŒ‡å®šçš„æµ‹è¯•ç”¨ä¾‹ï¼š<code>go test -run TestArea/Rectangle</code></p><ul><li>æ£€æŸ¥æœªç»æ£€æŸ¥çš„error</li></ul><p>æœ‰ä¸€ç§æƒ…å†µæˆ‘ä»¬è¿˜æ²¡æœ‰æµ‹è¯•è¿‡ã€‚è¦æ‰¾åˆ°å®ƒï¼Œåœ¨ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… errcheckï¼Œè¿™æ˜¯è®¸å¤šå¯ç”¨çš„ lintersï¼ˆä»£ç æ£€æµ‹å·¥å…·ï¼‰ä¹‹ä¸€ã€‚</p><p><code>go get -u github.com/kisielk/errcheck</code></p><p>ç„¶åï¼Œåœ¨ä»£ç ç›®å½•ä¸­è¿è¡Œ <code>errcheck .</code></p><ul><li>ä¾èµ–æ³¨å…¥ï¼š</li></ul><p><code>io.Writer</code> æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€šç”¨æ¥å£ï¼Œç”¨äºã€Œå°†æ•°æ®æ”¾åœ¨æŸä¸ªåœ°æ–¹ã€ã€‚</p><p><code>fmt.Fprintf</code> å’Œ <code>fmt.Printf</code> ä¸€æ ·ï¼Œåªä¸è¿‡ fmt.Fprintf ä¼šæ¥æ”¶ä¸€ä¸ª Writer å‚æ•°ï¼Œç”¨äºæŠŠå­—ç¬¦ä¸²ä¼ é€’è¿‡å»ï¼Œè€Œ fmt.Printf é»˜è®¤æ˜¯æ ‡å‡†è¾“å‡ºã€‚</p><h3 id=æ³¨å…¥---mocking>æ³¨å…¥ - Mocking<a hidden class=anchor aria-hidden=true href=#æ³¨å…¥---mocking>#</a></h3><p>å°†ä¾èµ–å…³ç³»å®šä¹‰ä¸ºä¸€ä¸ªæ¥å£ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ main ä½¿ç”¨ çœŸå®çš„ Sleeperï¼Œå¹¶ä¸”åœ¨æˆ‘ä»¬çš„æµ‹è¯•ä¸­ä½¿ç”¨ spy sleeperã€‚é€šè¿‡ä½¿ç”¨æ¥å£ï¼Œæˆ‘ä»¬çš„ Countdown å‡½æ•°å¿½ç•¥äº†è¿™ä¸€ç‚¹ï¼Œå¹¶ä¸ºè°ƒç”¨è€…å¢åŠ äº†ä¸€äº›çµæ´»æ€§ã€‚</p><h3 id=concurrency>Concurrency<a hidden class=anchor aria-hidden=true href=#concurrency>#</a></h3><p>åŒ¿åå‡½æ•°æœ‰è®¸å¤šæœ‰ç”¨çš„ç‰¹æ€§ã€‚é¦–å…ˆï¼Œå®ƒä»¬å¯ä»¥<strong>åœ¨å£°æ˜çš„åŒæ—¶æ‰§è¡Œ</strong> â€”â€” è¿™å°±æ˜¯åŒ¿åå‡½æ•°æœ«å°¾çš„ () å®ç°çš„ã€‚å…¶æ¬¡ï¼Œå®ƒä»¬ç»´æŠ¤å¯¹å…¶æ‰€å®šä¹‰çš„è¯æ±‡ä½œç”¨åŸŸçš„è®¿é—®æƒ â€”â€” åœ¨å£°æ˜åŒ¿åå‡½æ•°æ—¶æ‰€æœ‰å¯ç”¨çš„å˜é‡ä¹Ÿå¯åœ¨å‡½æ•°ä½“å†…ä½¿ç”¨ã€‚</p><p>ä¸Šé¢åŒ¿åå‡½æ•°çš„ä¸»ä½“å’Œä¹‹å‰å¾ªç¯ä½“ä¸­çš„å®Œå…¨ä¸€æ ·ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯å¾ªç¯çš„æ¯æ¬¡è¿­ä»£éƒ½ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ goroutineï¼Œä¸å½“å‰è¿›ç¨‹ï¼ˆWebsiteChecker å‡½æ•°ï¼‰åŒæ—¶å‘ç”Ÿï¼Œæ¯ä¸ªå¾ªç¯éƒ½ä¼šå°†ç»“æœæ·»åŠ åˆ° results map ä¸­ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>url</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>urls</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>results</span><span class=p>[</span><span class=nx>url</span><span class=p>]</span> <span class=p>=</span> <span class=nf>wc</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™é‡Œçš„é—®é¢˜æ˜¯å˜é‡ url è¢«é‡å¤ç”¨äº for å¾ªç¯çš„æ¯æ¬¡è¿­ä»£ â€”â€” æ¯æ¬¡éƒ½ä¼šä» urls è·å–æ–°å€¼ã€‚ä½†æ˜¯æˆ‘ä»¬çš„æ¯ä¸ª goroutine éƒ½æ˜¯ url å˜é‡çš„å¼•ç”¨ â€”â€” å®ƒä»¬æ²¡æœ‰è‡ªå·±çš„ç‹¬ç«‹å‰¯æœ¬ã€‚æ‰€ä»¥ä»–ä»¬ éƒ½ ä¼šå†™å…¥åœ¨è¿­ä»£ç»“æŸæ—¶çš„ url â€”â€” æœ€åä¸€ä¸ª urlã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¾—åˆ°çš„ç»“æœæ˜¯æœ€åä¸€ä¸ª urlã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>url</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>urls</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>go</span> <span class=kd>func</span><span class=p>(</span><span class=nx>u</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>results</span><span class=p>[</span><span class=nx>u</span><span class=p>]</span> <span class=p>=</span> <span class=nf>wc</span><span class=p>(</span><span class=nx>u</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}(</span><span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>é€šè¿‡ç»™æ¯ä¸ªåŒ¿åå‡½æ•°ä¸€ä¸ªå‚æ•° url(u)ï¼Œç„¶åç”¨ url ä½œä¸ºå‚æ•°è°ƒç”¨åŒ¿åå‡½æ•°ï¼Œæˆ‘ä»¬ç¡®ä¿ u çš„å€¼å›ºå®šä¸ºå¾ªç¯è¿­ä»£çš„ url å€¼ï¼Œé‡æ–°å¯åŠ¨ goroutineã€‚u æ˜¯ url å€¼çš„å‰¯æœ¬ï¼Œå› æ­¤æ— æ³•æ›´æ”¹ã€‚</p><p>ç”¨channelè§£å†³æ•°æ®ç«äº‰ data race</p><ul><li><p>goroutines æ˜¯ Go çš„åŸºæœ¬å¹¶å‘å•å…ƒï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥åŒæ—¶æ£€æŸ¥å¤šä¸ªç½‘ç«™ã€‚</p></li><li><p>anonymous functionsï¼ˆåŒ¿åå‡½æ•°ï¼‰ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥å¯åŠ¨æ¯ä¸ªæ£€æŸ¥ç½‘ç«™çš„å¹¶å‘è¿›ç¨‹ã€‚</p></li><li><p>channelsï¼Œç”¨æ¥ç»„ç»‡å’Œæ§åˆ¶ä¸åŒè¿›ç¨‹ä¹‹é—´çš„äº¤æµï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿé¿å… race conditionï¼ˆç«äº‰æ¡ä»¶ï¼‰ çš„é—®é¢˜ã€‚</p></li><li><p>the race detectorï¼ˆç«äº‰æ¢æµ‹å™¨ï¼‰ å¸®åŠ©æˆ‘ä»¬è°ƒè¯•å¹¶å‘ä»£ç çš„é—®é¢˜ã€‚</p></li></ul><p>ä½¿ç”¨ select æ—¶ï¼Œtime.After æ˜¯ä¸€ä¸ªå¾ˆå¥½ç”¨çš„å‡½æ•°ã€‚å½“ä½ ç›‘å¬çš„ channel æ°¸è¿œä¸ä¼šè¿”å›ä¸€ä¸ªå€¼æ—¶ä½ å¯ä»¥æ½œåœ¨åœ°ç¼–å†™æ°¸è¿œé˜»å¡çš„ä»£ç ï¼Œå°½ç®¡åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­å®ƒæ²¡æœ‰å‘ç”Ÿã€‚time.After ä¼šåœ¨ä½ å®šä¹‰çš„æ—¶é—´è¿‡åå‘é€ä¸€ä¸ªä¿¡å·ç»™ channel å¹¶è¿”å›ä¸€ä¸ª chan ç±»å‹ï¼ˆå°±åƒ ping é‚£æ ·ï¼‰ã€‚</p><p>value æœ‰ä¸€ä¸ªæ–¹æ³• NumFieldï¼Œå®ƒè¿”å›å€¼ä¸­çš„å­—æ®µæ•°</p><h3 id=sync>Sync<a hidden class=anchor aria-hidden=true href=#sync>#</a></h3><p><a href=https://pkg.go.dev/sync#WaitGroup>Sync</a></p><p>WaitGroup ç­‰å¾… goroutine é›†åˆå®Œæˆã€‚ä¸» goroutine è°ƒç”¨ Add è®¾ç½®ç­‰å¾…çš„ goroutine æ•°é‡ã€‚ç„¶åæ¯ä¸ª goroutine è¿è¡Œå¹¶åœ¨å®Œæˆæ—¶è°ƒç”¨ Doneã€‚åŒæ—¶ï¼ŒWait å¯ä»¥ç”¨æ¥é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰ goroutine éƒ½å®Œæˆã€‚</p><p>é€šè¿‡åœ¨åšå‡ºæ–­è¨€ä¹‹å‰ç­‰å¾…wg.Wait()å®Œæˆï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šæ‰€æœ‰çš„ goroutine éƒ½å·²å°è¯•Incè¿‡Counterã€‚</p><p>A Mutex must not be copied after first use.
Use channels when passing ownership of data</p><p>Use mutexes for managing state</p><h3 id=context>Context<a hidden class=anchor aria-hidden=true href=#context>#</a></h3><p><a href=https://go.dev/blog/context>context</a></p><p>æˆ‘ä»¬æ‰€åšçš„æ˜¯ä»æˆ‘ä»¬çš„requestä¸­æ´¾ç”Ÿä¸€ä¸ªæ–°çš„ cancellingCtxï¼Œå®ƒè¿”å›ä¸€ä¸ªcancelå‡½æ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ time.AfterFunc å®‰æ’åœ¨ 5 æ¯«ç§’å†…è°ƒç”¨è¯¥å‡½æ•°ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ request.WithContext åœ¨è¯·æ±‚ä¸­ä½¿ç”¨è¿™ä¸ªæ–°ä¸Šä¸‹æ–‡ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Server</span><span class=p>(</span><span class=nx>store</span> <span class=nx>Store</span><span class=p>)</span> <span class=nx>http</span><span class=p>.</span><span class=nx>HandlerFunc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>ctx</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>Context</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=nx>data</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>string</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>data</span> <span class=o>&lt;-</span> <span class=nx>store</span><span class=p>.</span><span class=nf>Fetch</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=p>}()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>select</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=nx>d</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprint</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=o>&lt;-</span><span class=nx>ctx</span><span class=p>.</span><span class=nf>Done</span><span class=p>():</span>
</span></span><span class=line><span class=cl>			<span class=nx>store</span><span class=p>.</span><span class=nf>Cancel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>contextæœ‰ä¸€ä¸ªæ–¹æ³•Done()è¿”å›ä¸€ä¸ªchannelï¼Œå½“contextâ€œå®Œæˆâ€æˆ–â€œå–æ¶ˆâ€æ—¶ï¼Œè¯¥é€šé“ä¼šå‘é€ä¿¡å·ã€‚
æˆ‘ä»¬æƒ³è¦ç›‘å¬è¯¥ä¿¡å·å¹¶åœ¨æ”¶åˆ°è¯¥ä¿¡å·æ—¶è°ƒç”¨ <code>store.Cancel</code>ï¼Œä½†å¦‚æœæˆ‘ä»¬Storeè®¾æ³•åœ¨Fetchå®ƒä¹‹å‰å°±å¿½ç•¥å®ƒã€‚</p><p>å¯¹æœåŠ¡å™¨çš„ä¼ å…¥è¯·æ±‚åº”è¯¥åˆ›å»ºä¸Šä¸‹æ–‡ï¼Œè€Œå¯¹æœåŠ¡å™¨çš„ä¼ å‡ºè°ƒç”¨åº”è¯¥æ¥å—ä¸Šä¸‹æ–‡ã€‚å®ƒä»¬ä¹‹é—´çš„å‡½æ•°è°ƒç”¨é“¾å¿…é¡»ä¼ æ’­ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥é€‰æ‹©å°†å…¶æ›¿æ¢ä¸ºä½¿ç”¨ WithCancelã€WithDeadlineã€WithTimeout æˆ– WithValue åˆ›å»ºçš„æ´¾ç”Ÿä¸Šä¸‹æ–‡ã€‚å½“ä¸€ä¸ªä¸Šä¸‹æ–‡è¢«å–æ¶ˆæ—¶ï¼Œå®ƒæ´¾ç”Ÿçš„æ‰€æœ‰ä¸Šä¸‹æ–‡ä¹Ÿè¢«å–æ¶ˆã€‚</p><h3 id=property-based-tests>Property based tests<a hidden class=anchor aria-hidden=true href=#property-based-tests>#</a></h3><p>strings.Builder ç”¨äºä½¿ç”¨å†™å…¥æ–¹æ³•é«˜æ•ˆæ„å»ºå­—ç¬¦ä¸²ã€‚å®ƒæœ€å¤§é™åº¦åœ°å‡å°‘äº†å†…å­˜å¤åˆ¶ã€‚</p><p>ç½—é©¬æ•°å­—çš„è§„åˆ™æ˜¯åŒä¸€å­—ç¬¦ä¸èƒ½åœ¨ä¸€è¡Œä¸­é‡å¤è¶…è¿‡ 3 æ¬¡ã€‚
å–è€Œä»£ä¹‹çš„æ˜¯å–ä¸‹ä¸€ä¸ªæœ€é«˜çš„ç¬¦å·ï¼Œç„¶ååœ¨å…¶å·¦ä¾§æ”¾ç½®ä¸€ä¸ªç¬¦å·æ¥ â€œå‡å»â€ã€‚
å¹¶éæ‰€æœ‰ç¬¦å·éƒ½å¯ä»¥ç”¨ä½œå‡æ³•å™¨ï¼›åªæœ‰ I (1)ã€X (10) å’Œ C (100)ã€‚</p><p>ä¾‹å¦‚ï¼Œç½—é©¬æ•°å­—ä¸­çš„ 5 æ˜¯ Vã€‚è¦åˆ›å»º 4ï¼Œæ‚¨ä¸æ‰§è¡Œ IIIIï¼Œè€Œæ˜¯æ‰§è¡Œ IVã€‚</p><p>RomanNumeralè§„åˆ™ï¼š</p><ul><li><p>ä¸èƒ½æœ‰è¶…è¿‡ 3 ä¸ªè¿ç»­çš„ç¬¦å·</p></li><li><p>åªæœ‰ I (1), X (10) å’Œ C (100) æ˜¯ ã€Œå‡æ³•å™¨ã€</p></li><li><p>å°† ConvertToRoman(N) çš„ç»“æœä¼ é€’ç»™ ConvertToArabic ï¼Œåº”è¯¥è¿”å› Nã€‚</p></li></ul><p>åŸºäºå±æ€§çš„æµ‹è¯•é€šè¿‡å‘ä»£ç ä¸­æŠ›å‡ºéšæœºæ•°æ®å¹¶éªŒè¯æ‰€æè¿°çš„è§„åˆ™å§‹ç»ˆä¸ºçœŸæ¥å¸®åŠ©æ‚¨åšåˆ°è¿™ä¸€ç‚¹ã€‚å¾ˆå¤šäººè®¤ä¸ºåŸºäºå±æ€§çš„æµ‹è¯•ä¸»è¦æ˜¯å…³äºéšæœºæ•°æ®çš„ï¼Œä½†ä»–ä»¬æ˜¯é”™è¯¯çš„ã€‚ åŸºäºå±æ€§çš„æµ‹è¯•é¢ä¸´çš„çœŸæ­£æŒ‘æˆ˜æ˜¯ä½ å¯¹ä½ çš„é¢†åŸŸæœ‰ã€Œå¾ˆå¥½çš„ã€ç†è§£ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥ç¼–å†™è¿™äº›å±æ€§ã€‚</p><p>ä»åº•éƒ¨è¯»å–ï¼Œæˆ‘ä»¬ä¸º quick.Check æä¾›äº†ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå°†è¿è¡Œä¸€äº›éšæœºçš„è¾“å…¥ï¼Œå¦‚æœå‡½æ•°è¿”å› falseï¼Œå®ƒå°†è¢«è§†ä¸ºæ£€æŸ¥å¤±è´¥ã€‚</p><p>ä¸Šé¢çš„ assertion å‡½æ•°æ¥å—éšæœºæ•°å¹¶è¿è¡Œå‡½æ•°æ¥æµ‹è¯•å±æ€§ã€‚</p><ul><li><p>ä½ ä¸èƒ½ç”¨ç½—é©¬æ•°å­—è¡¨ç¤ºè´Ÿæ•°</p></li><li><p>æ ¹æ®æˆ‘ä»¬æœ€å¤š 3 ä¸ªè¿ç»­ç¬¦å·çš„è§„åˆ™ï¼Œæˆ‘ä»¬ä¸èƒ½è¡¨ç¤ºå¤§äº 3999 çš„å€¼ (ç½—é©¬æ•°å­—çš„æœ€å¤§å€¼)ï¼Œè€Œ int çš„æœ€å¤§å€¼æ¯” 3999 å¤§å¾—å¤šã€‚
å› æ­¤ä½¿ç”¨<code>uint16</code></p></li></ul><p>å†…ç½®çš„è·¯ç”±æœºåˆ¶å«åš ServeMuxï¼ˆrequest multiplexerï¼Œå¤šè·¯è¯·æ±‚å¤ç”¨å™¨ï¼‰ï¼Œå®ƒå…è®¸ä½ å°† http.Handler é™„åŠ åˆ°ç‰¹å®šçš„è¯·æ±‚è·¯å¾„ã€‚</p><p>We changed the second property of PlayerServer, removing the named property router http.ServeMux and replaced it with http.Handler; this is called embedding.</p><p>Go does not provide the typical, type-driven notion of subclassing, but it does have the ability to â€œborrowâ€ pieces of an implementation by embedding types within a struct or interface.</p><p>è¿™æ„å‘³ç€æˆ‘ä»¬çš„ PlayerServer ç°åœ¨å·²ç»æœ‰äº† http.Handler æ‰€æœ‰çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ ServeHTTPã€‚</p><p>ä¸ºäº† â€œå¡«å……â€ http.Handlerï¼Œæˆ‘ä»¬å°†å®ƒåˆ†é…ç»™æˆ‘ä»¬åœ¨ NewPlayerServer ä¸­åˆ›å»ºçš„ routerã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åšæ˜¯å› ä¸º http.ServeMux å…·æœ‰ ServeHTTP æ–¹æ³•ã€‚</p><p>è¿™å…è®¸æˆ‘ä»¬åˆ é™¤æˆ‘ä»¬çš„ ServeHTTP æ–¹æ³•ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»é€šè¿‡åµŒå…¥ç±»å‹å…¬å¼€äº†å®ƒã€‚</p><p>åµŒå…¥æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ„æ€çš„è¯­æ³•ç‰¹æ€§ã€‚ä½ å¯ä»¥ç”¨å®ƒå°†æ¥å£ç»„æˆæ–°çš„æ¥å£ã€‚</p><h3 id=ioå’Œæ’åº>IOå’Œæ’åº<a hidden class=anchor aria-hidden=true href=#ioå’Œæ’åº>#</a></h3><p>æœåŠ¡å™¨é‡å¯ä¼šé‡ç½®ç§¯åˆ†</p><p><code>os.OpenFile</code> å…è®¸ä½ å®šä¹‰æ‰“å¼€æ–‡ä»¶çš„æƒé™ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œ<code>O_RDWR</code> æ„å‘³ç€æˆ‘ä»¬æƒ³è¦è¯»å†™æƒé™ï¼Œ<code>os.O_CREATE</code> æ˜¯æŒ‡å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥æ–‡ä»¶ã€‚</p><p>åˆ›å»ºä¸€ä¸ªæ–°ç±»å‹æ¥å°è£…æˆ‘ä»¬çš„ã€Œå½“å†™å…¥æ—¶ï¼Œä»å¤´éƒ¨å¼€å§‹ã€åŠŸèƒ½ã€‚æˆ‘æŠŠå®ƒå«åš Tape.</p><p>file.Stat è¿”å›æˆ‘ä»¬çš„æ–‡ä»¶çš„ç»Ÿè®¡æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥æ£€æŸ¥æ–‡ä»¶çš„å¤§å°ï¼Œå¦‚æœå®ƒæ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬å°±ä¼šç¼–å†™ä¸€ä¸ªç©ºçš„ JSON æ•°ç»„ï¼Œç„¶å Seek åˆ°å¼€å§‹ä½ç½®ï¼Œä¸ºå‰©ä¸‹çš„ä»£ç åšå‡†å¤‡ã€‚</p><h3 id=å‘½ä»¤è¡Œå’Œé¡¹ç›®ç»“æ„>å‘½ä»¤è¡Œå’Œé¡¹ç›®ç»“æ„<a hidden class=anchor aria-hidden=true href=#å‘½ä»¤è¡Œå’Œé¡¹ç›®ç»“æ„>#</a></h3><p>å½“ç”¨æˆ·è¾“å…¥ Ruth wins æ—¶ï¼Œå®ƒåªéœ€è¦èƒ½å¤Ÿè®°å½•ç©å®¶çš„èƒœå‡ºæƒ…å†µï¼Œæœ€ç»ˆç›®çš„æ˜¯ä½œä¸ºä¸€ä¸ªå¸®åŠ©ç”¨æˆ·ç©æ‰‘å…‹çš„å·¥å…·ã€‚</p><p>äº§å“è´Ÿè´£äººå¸Œæœ›åœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´å…±äº«æ•°æ®åº“ï¼Œä»¥ä¾¿ç©å®¶leagueæ ¹æ®æ–°ç¨‹åºä¸­è®°å½•çš„winsè¿›è¡Œæ›´æ–°ã€‚</p><ul><li><p>ç¬¬ä¸€ä¸ªéœ€æ±‚å°±æ˜¯å½“ç”¨æˆ·è¾“å…¥ {PlayerName} wins æ—¶è®°å½•ä¸€æ¬¡èƒœåˆ©ã€‚</p></li><li><p>bufio åŒ…å®ç°äº† I/O ç¼“å†²ã€‚å®ƒå°è£…äº†ä¸€ä¸ª io.Reader æˆ– io.Writer å¯¹è±¡ï¼Œåˆ›å»ºäº†å¦ä¸€ä¸ªå¯¹è±¡ï¼ˆReader æˆ– Writerï¼‰ï¼Œä¹Ÿå®ç°äº†æ¥å£ï¼Œå¹¶ä¸ºæ–‡æœ¬ I/O æä¾›äº†ç¼“å†²å’Œä¸€äº›å¸®åŠ©ã€‚</p></li><li><p>Scanner.Scan() ä¼šé€è¡Œè¯»å–å†…å®¹ã€‚
ç„¶åä½¿ç”¨ Scanner.Text() æ¥è¿”å› scanner è¯»å–çš„ stringã€‚
æˆ‘ä»¬å°†å®ƒå°è£…åˆ°ä¸€ä¸ªåä¸º readLine() çš„å‡½æ•°ä¸­ã€‚</p></li></ul><h2 id=benchmarking---åŸºå‡†æµ‹è¯•>Benchmarking - åŸºå‡†æµ‹è¯•<a hidden class=anchor aria-hidden=true href=#benchmarking---åŸºå‡†æµ‹è¯•>#</a></h2><p>ç”¨ <code>go test -bench=.</code> æ¥è¿è¡ŒåŸºå‡†æµ‹è¯•ã€‚ (å¦‚æœåœ¨ Windows Powershell ç¯å¢ƒä¸‹ä½¿ç”¨ <code>go test -bench="."</code>)</p><p>Tips: benchmarksé»˜è®¤é¡ºåºæ‰§è¡Œã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>BenchmarkRepeat</span><span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>B</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>N</span><span class=p>;</span> <span class=nx>i</span> <span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>Repeat</span><span class=p>(</span><span class=s>&#34;A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>testing.B</code> å¯ä½¿ä½ è®¿é—®éšæ€§å‘½åï¼ˆcryptically namedï¼‰<code>b.N</code>ã€‚</p><p>åŸºå‡†æµ‹è¯•è¿è¡Œæ—¶ï¼Œä»£ç ä¼šè¿è¡Œ <code>b.N</code> æ¬¡ï¼Œå¹¶æµ‹é‡éœ€è¦å¤šé•¿æ—¶é—´ã€‚</p><p>ä»£ç è¿è¡Œçš„æ¬¡æ•°ä¸ä¼šå¯¹ä½ äº§ç”Ÿå½±å“ï¼Œæµ‹è¯•æ¡†æ¶ä¼šé€‰æ‹©ä¸€ä¸ªå®ƒæ‰€è®¤ä¸ºçš„æœ€ä½³å€¼ï¼Œä»¥ä¾¿è®©ä½ è·å¾—æ›´åˆç†çš„ç»“æœã€‚</p><h2 id=goconveyæµ‹è¯•æ¡†æ¶>GoConveyï¼ˆæµ‹è¯•æ¡†æ¶ï¼‰<a hidden class=anchor aria-hidden=true href=#goconveyæµ‹è¯•æ¡†æ¶>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/smartystreets/goconvey/convey&#34;</span>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=nx>get</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>smartystreets</span><span class=o>/</span><span class=nx>goconvey</span>
</span></span></code></pre></td></tr></table></div></div><p><code>convey.Convey</code> å®šä¹‰äº†æµ‹è¯•ç”¨ä¾‹åç§°ã€t æŒ‡é’ˆã€æµ‹è¯•ä»£ç ã€‚
<code>convey.S</code>o` ç”¨æ¥åˆ¤æ–­é¢„æœŸç»“æœã€‚
convey æä¾›äº†å¤§é‡çš„æ–­è¨€å‡½æ•°ï¼Œæ¯”å¦‚åˆšæ‰ä½¿ç”¨çš„ convey.ShouldBeTrueï¼Œå°±æ˜¯åˆ¤æ–­ ok çš„å€¼åº”è¯¥ä¸º trueã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestCheckUrl</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>convey</span><span class=p>.</span><span class=nf>Convey</span><span class=p>(</span><span class=s>&#34;TestCheckTeachUrl&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>,</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ok</span><span class=o>:=</span><span class=nf>CheckUrl</span><span class=p>(</span><span class=s>&#34;learnku.com&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>convey</span><span class=p>.</span><span class=nf>So</span><span class=p>(</span><span class=nx>ok</span><span class=p>,</span><span class=nx>convey</span><span class=p>.</span><span class=nx>ShouldBeTrue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>GoConvey å®˜æ–¹æ–‡æ¡£ï¼š<a href=https://github.com/smartystreets/goconvey/wiki/Assertions>Assertions Â· smartystreets/goconvey Wiki Â· GitHub</a></p><h2 id=testifyæ–­è¨€>Testifyï¼ˆæ–­è¨€ï¼‰<a hidden class=anchor aria-hidden=true href=#testifyæ–­è¨€>#</a></h2><p>Testify ä¹Ÿæ˜¯ä¸€ä¸ªæ–­è¨€åº“ï¼ŒåŠŸèƒ½ç›¸å¯¹äº GoConvey è€Œè¨€æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯åœ¨æä¾›æ–­è¨€åŠŸèƒ½ä¹‹å¤–ï¼Œæä¾›äº† mock çš„åŠŸèƒ½ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/stretchr/testify&#34;</span>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=nx>get</span> <span class=o>-</span><span class=nx>t</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>stretchr</span><span class=o>/</span><span class=nx>testify</span>
</span></span></code></pre></td></tr></table></div></div><p>eg:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestCheckUrl3</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>assert</span> <span class=o>:=</span> <span class=nx>assert</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>tests</span> <span class=p>=</span> <span class=p>[]</span><span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>input</span>    <span class=kt>string</span>
</span></span><span class=line><span class=cl>        <span class=nx>expected</span> <span class=kt>bool</span>
</span></span><span class=line><span class=cl>    <span class=p>}{</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s>&#34;xdcute.com&#34;</span><span class=p>,</span> <span class=kc>true</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s>&#34;xxx.com&#34;</span><span class=p>,</span> <span class=kc>false</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>test</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>tests</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>test</span><span class=p>.</span><span class=nx>input</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>assert</span><span class=p>.</span><span class=nf>Equal</span><span class=p>(</span><span class=nf>CheckUrl</span><span class=p>(</span><span class=nx>test</span><span class=p>.</span><span class=nx>input</span><span class=p>),</span> <span class=nx>test</span><span class=p>.</span><span class=nx>expected</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=gomockæ¨¡æ‹Ÿæ¥å£>GoMockï¼ˆæ¨¡æ‹Ÿæ¥å£ï¼‰<a hidden class=anchor aria-hidden=true href=#gomockæ¨¡æ‹Ÿæ¥å£>#</a></h2><p>mock å·¥å…·çš„ä½œç”¨æ˜¯æŒ‡å®šå‡½æ•°çš„è¡Œä¸ºï¼ˆæ¨¡æ‹Ÿå‡½æ•°çš„è¡Œä¸ºï¼‰ã€‚å¯ä»¥å¯¹å…¥å‚è¿›è¡Œæ ¡éªŒï¼Œå¯¹å‡ºå‚è¿›è¡Œè®¾å®šï¼Œè¿˜å¯ä»¥æŒ‡å®šå‡½æ•°çš„è¿”å›å€¼ã€‚</p><h2 id=å¹¶è¡Œæµ‹è¯•>å¹¶è¡Œæµ‹è¯•<a hidden class=anchor aria-hidden=true href=#å¹¶è¡Œæµ‹è¯•>#</a></h2><p><code>func (b *B) RunParallel(body func(*PB))</code>ä¼šä»¥å¹¶è¡Œçš„æ–¹å¼æ‰§è¡Œç»™å®šçš„åŸºå‡†æµ‹è¯•ã€‚</p><p><code>RunParallel</code>ä¼šåˆ›å»ºå‡ºå¤šä¸ª<code>goroutine</code>ï¼Œå¹¶å°†<code>b.N</code>åˆ†é…ç»™è¿™äº›<code>goroutine</code>æ‰§è¡Œï¼Œ å…¶ä¸­<code>goroutine</code>æ•°é‡çš„é»˜è®¤å€¼ä¸º<code>GOMAXPROCS</code>ã€‚ç”¨æˆ·å¦‚æœæƒ³è¦å¢åŠ éCPUå—é™ï¼ˆnon-CPU-boundï¼‰åŸºå‡†æµ‹è¯•çš„å¹¶è¡Œæ€§ï¼Œ é‚£ä¹ˆå¯ä»¥åœ¨<code>RunParallel</code>ä¹‹å‰è°ƒç”¨<code>SetParallelism</code> ã€‚<code>RunParallel</code>é€šå¸¸ä¼šä¸<code>-cpu</code>æ ‡å¿—ä¸€åŒä½¿ç”¨ã€‚</p><h2 id=å‚è€ƒæ–‡ç« >å‚è€ƒæ–‡ç« <a hidden class=anchor aria-hidden=true href=#å‚è€ƒæ–‡ç« >#</a></h2><ul><li>&ldquo;<a href=https://studygolang.gitbook.io/learn-go-with-tests/%22>https://studygolang.gitbook.io/learn-go-with-tests/"</a></li><li>&ldquo;<a href=https://quii.gitbook.io/learn-go-with-tests/%22>https://quii.gitbook.io/learn-go-with-tests/"</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://erica423.github.io/tags/%E6%8A%80%E6%9C%AF/>æŠ€æœ¯</a></li></ul><nav class=paginav><a class=prev href=https://erica423.github.io/posts/rpc/><span class=title>Â« Prev</span><br><span>RPCç›¸å…³</span>
</a><a class=next href=https://erica423.github.io/posts/question/><span class=title>Next Â»</span><br><span>Q&amp;A | é¢ç»</span></a></nav></footer><div id=waline></div><script>Waline.init({el:"#waline",dark:"body.dark",serverURL:"https://waline.vercel.app"})</script></article></main><footer class=footer><span>&copy; 2024 <a href=https://erica423.github.io/>Erica-Blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><div class=busuanzi-footer><span id=busuanzi_container_site_pv>æœ¬ç«™æ€»è®¿é—®é‡<span id=busuanzi_value_site_pv></span>æ¬¡
</span><span id=busuanzi_container_site_uv>æœ¬ç«™è®¿å®¢æ•°<span id=busuanzi_value_site_uv></span>äººæ¬¡</span></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>