<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ä¸€æ–‡ç†è§£å’Œä½¿ç”¨Redis | Erica-Blog</title>
<meta name=keywords content="æŠ€æœ¯"><meta name=description content="Redis å®˜ç½‘: https://redis.io/ å®‰è£… Redis: https://github.com/tporadowski/redis/releases. é€‰æ‹©Redis-x64-5.0.14.1.msiå³å¯ å®šä¹‰ Redis æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ NoSQL, ç”¨ C å®ç°, å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„ Key-Value å­˜å‚¨æ•°æ®åº“, å¹¶æ"><meta name=author content="erica423"><link rel=canonical href=https://erica423.github.io/posts/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3redis/><link crossorigin=anonymous href=/assets/css/stylesheet.0fd2af49d7c8b1a279992ba82155f4ce3b1d94189758b3b0a99c8692cfdc0be9.css integrity rel="preload stylesheet" as=style><link rel=icon href=https://erica423.github.io/images/dls_icon.png><link rel=icon type=image/png sizes=16x16 href=https://erica423.github.io/images/dls_icon.png><link rel=icon type=image/png sizes=32x32 href=https://erica423.github.io/images/dls_icon.png><link rel=apple-touch-icon href=https://erica423.github.io/images/dls_icon.png><link rel=mask-icon href=https://erica423.github.io/images/dls_icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://erica423.github.io/posts/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3redis/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>(function(){""&&prompt("è¯·è¾“å…¥æ–‡ç« å¯†ç ")!==""&&(alert("å¯†ç é”™è¯¯ï¼"),history.back())})()</script><link rel=stylesheet href=https://s1.hdslb.com/bfs/static/jinkela/long/font/regular.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel=stylesheet><script src=https://unpkg.com/@waline/client@v2/dist/waline.js></script><link rel=stylesheet href=https://unpkg.com/@waline/client@v2/dist/waline.css><meta property="og:title" content="ä¸€æ–‡ç†è§£å’Œä½¿ç”¨Redis"><meta property="og:description" content="Redis å®˜ç½‘: https://redis.io/ å®‰è£… Redis: https://github.com/tporadowski/redis/releases. é€‰æ‹©Redis-x64-5.0.14.1.msiå³å¯ å®šä¹‰ Redis æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ NoSQL, ç”¨ C å®ç°, å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„ Key-Value å­˜å‚¨æ•°æ®åº“, å¹¶æ"><meta property="og:type" content="article"><meta property="og:url" content="https://erica423.github.io/posts/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3redis/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-01T15:39:00+08:00"><meta property="article:modified_time" content="2024-11-01T15:39:00+08:00"><meta property="og:site_name" content="erica-blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="ä¸€æ–‡ç†è§£å’Œä½¿ç”¨Redis"><meta name=twitter:description content="Redis å®˜ç½‘: https://redis.io/ å®‰è£… Redis: https://github.com/tporadowski/redis/releases. é€‰æ‹©Redis-x64-5.0.14.1.msiå³å¯ å®šä¹‰ Redis æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ NoSQL, ç”¨ C å®ç°, å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„ Key-Value å­˜å‚¨æ•°æ®åº“, å¹¶æ"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://erica423.github.io/posts/"},{"@type":"ListItem","position":2,"name":"ä¸€æ–‡ç†è§£å’Œä½¿ç”¨Redis","item":"https://erica423.github.io/posts/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3redis/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ä¸€æ–‡ç†è§£å’Œä½¿ç”¨Redis","name":"ä¸€æ–‡ç†è§£å’Œä½¿ç”¨Redis","description":"Redis å®˜ç½‘: https://redis.io/ å®‰è£… Redis: https://github.com/tporadowski/redis/releases. é€‰æ‹©Redis-x64-5.0.14.1.msiå³å¯ å®šä¹‰ Redis æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ NoSQL, ç”¨ C å®ç°, å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„ Key-Value å­˜å‚¨æ•°æ®åº“, å¹¶æ","keywords":["æŠ€æœ¯"],"articleBody":"Redis å®˜ç½‘: https://redis.io/\nå®‰è£… Redis: https://github.com/tporadowski/redis/releases. é€‰æ‹©Redis-x64-5.0.14.1.msiå³å¯\nå®šä¹‰ Redis æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ NoSQL, ç”¨ C å®ç°, å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„ Key-Value å­˜å‚¨æ•°æ®åº“, å¹¶æä¾›å¤šç§è¯­è¨€çš„ APIã€‚\næ ¹æ®æœˆåº¦æ’è¡Œç½‘ç«™DB-Engines.comçš„æ•°æ®ï¼ŒRedis æ˜¯ç°åœ¨æœ€å—æ¬¢è¿çš„ NoSQL æ•°æ®åº“ä¹‹ä¸€(MongoDB äº¦ä¸º NoSQL æ•°æ®åº“)ã€‚\nå’ŒMySQLçš„åŒºåˆ« å…³ç³»å‹DBä¾èµ–äºä¼ ç»Ÿçš„è¡¨è¡Œåˆ—å­˜å‚¨ï¼Œéå…³ç³»å‹DBä¾é kvå­˜å‚¨ã€‚ Redisä¸æ”¯æŒSQLè¯­å¥ã€‚ ä¸ MySQL æ•°æ®åº“ä¸åŒçš„æ˜¯(ä¸ºäº†å®ç°æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨, Mysql å°†æ•°æ®å­˜å‚¨åˆ°äº†ç£ç›˜ä¸­), Redis çš„æ•°æ®æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ã€‚å®ƒçš„è¯»å†™é€Ÿåº¦éå¸¸å¿«ã€‚ RedisåŸºæœ¬æ•°æ®ç±»å‹ Redis æœ‰å¦‚ å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(Set)ã€æœ‰åºé›†åˆ(ZSet/Sorted Set) è¿™æ ·çš„åŸºç¡€æ•°æ®ç±»å‹ã€‚\nä¼˜åŠ¿: æ€§èƒ½å¥½ã€ä¸°å¯Œçš„æ•°æ®ç±»å‹ã€‚\nRedisæŒä¹…åŒ– å®šä¹‰: æŒä¹…åŒ–æ˜¯æŒ‡å°†æ•°æ®å†™å…¥æŒä¹…å­˜å‚¨(durable storage), å¦‚å›ºæ€ç¡¬ç›˜(SSD)ã€‚\næ³¨: å³ä½¿æœ‰æŒä¹…åŒ–æœºåˆ¶ï¼ŒRedisä¹Ÿæ— æ³•ä¿è¯æ°¸è¿œä¸ä¸¢å¤±æ•°æ®ã€‚\nRedis æä¾›äº†ä¸€ç³»åˆ—é€‰é¡¹ã€‚\nRDB(Redis Database): åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…åˆ›å»ºæ•°æ®é›†çš„å¿«ç…§æ¥ä¿å­˜æ•°æ®ã€‚ ä¼˜åŠ¿ï¼šéš”ä¸€æ®µæ—¶é—´ä¿å­˜ä¸€æ¬¡ï¼Œå¯¹æ€§èƒ½å½±å“å°ï¼› ç¼ºç‚¹ï¼šåœ¨ä¸¤æ¬¡ä¿å­˜é—´éš”ä¹‹é—´å¯èƒ½ä¸¢å¤±æ•°æ®ã€‚\nAOF(Append Only File): è®°å½•æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ¯ä¸€ä¸ªå†™æ“ä½œï¼Œå¹¶å°†è¿™äº›æ“ä½œè¿½åŠ åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚ ä¼˜åŠ¿ï¼šå‡ºç°é—®é¢˜å¯ä»¥é‡æ”¾æ—¥å¿—æ“ä½œæ¥é‡å»ºdbï¼› ç¼ºç‚¹ï¼šè®°å½•äº†æ¯ä¸€ä¸ªæ“ä½œï¼Œå½±å“æ€§èƒ½ã€‚\næ— æŒä¹…åŒ–: å®Œå…¨ç¦ç”¨ Redis çš„æŒä¹…åŒ–æœºåˆ¶, è¿™æ„å‘³ç€ Redis åªä¼šåœ¨å†…å­˜ä¸­å­˜å‚¨æ•°æ®ã€‚\nAOF + RDB ç»„åˆ: å¯ä»¥åœ¨åŒä¸€ä¸ªå®ä¾‹ä¸­åŒæ—¶å¯ç”¨ RDB å’Œ AOF æŒä¹…åŒ–ã€‚\nè®¾ç½®æ–¹æ³• åœ¨ redis ç›®å½•ä¸‹, æ‰¾åˆ°redis.windows.confå³å¯ã€‚\nRDB éƒ¨åˆ†\né»˜è®¤æƒ…å†µä¸‹, Redis ä¼šå°†æ•°æ®é›†çš„å¿«ç…§ä¿å­˜åœ¨ç£ç›˜ä¸Šä¸€ä¸ªåä¸º dump.rdbçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚\nç›®å½•(ä¸€èˆ¬æƒ…å†µ)\nC:\\Program Files\\Redisï¼Œ åœ¨redis.windows.confæ–‡ä»¶å†…\næ‰¾åˆ°\n1 save 60 1000 AOF éƒ¨åˆ†\næ‰¾åˆ° å°†noæ”¹ä¸ºyes, å¼€å¯ AOF\n1 appendonly yes å®ƒåœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­çš„ä½œç”¨ï¼š\nè®¡æ•°å™¨ ï¼ˆç‚¹èµã€è½¬å‘ã€è¯„è®ºæ•°ï¼‰ Go-redis å®šä¹‰: Go-redis æ˜¯ Golang ä¸­ç”¨äºä¸ Redis äº¤äº’çš„å¼ºå¤§å·¥å…·, æ”¯æŒ Redis Server çš„ Golang å®¢æˆ·ç«¯ã€‚\nGitHub: https://github.com/redis/go-redis\næ–‡æ¡£: https://redis.uptrace.dev/zh/\n1 go get -u github.com/go-redis/redis config/redis.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 package config import ( \"github.com/go-redis/redis\" ) var RedisClient *redis.Client func InitRedis() { RedisClient = redis.NewClient(\u0026redis.Options{ Addr: \"localhost:6379\", DB: 0, // é»˜è®¤æ•°æ®åº“(use default DB) Password: \"\", }) _, err := RedisClient.Ping().Result() if err != nil { panic(\"Failed to connect to Redis\") } } localhost:6379â€”â€”åœ¨å®‰è£…è¿‡ç¨‹ä¸­è®¾ç½®çš„ç«¯å£ã€‚é»˜è®¤æƒ…å†µä¸‹å°±æ˜¯ 6379ã€‚\nglobal.go\n1 2 3 4 var ( DB *gorm.DB RedisDB *redis.Client ) å®ç°ç‚¹èµåŠŸèƒ½ ç»™æ–‡ç« å¢åŠ ç‚¹èµæ•°ï¼Œlike_controller.go\nredis key å‘½åè§„èŒƒçš„è®¾è®¡ key å•è¯ä¸å•è¯ä¹‹é—´ä»¥ (:)åˆ†å‰², å¦‚user:userinfo, article:1:likes\nSET, INCR, DECR, GETå‘½ä»¤ SET å‘½ä»¤ç”¨äºè®¾ç½®ç»™å®š key çš„å€¼ã€‚\nINCR å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€ã€‚è‹¥ key ä¸å­˜åœ¨,é‚£ä¹ˆ key çš„å€¼ä¼šå…ˆè¢«åˆå§‹åŒ–ä¸º 0,ç„¶åå†æ‰§è¡Œæ“ä½œã€‚(0 -\u003e 1)\nDECR åˆ™å°† key ä¸­å‚¨å­˜çš„æ•°å­—å‡ä¸€ã€‚\nGET å‘½ä»¤ç”¨äºè·å–æŒ‡å®š key çš„å€¼ã€‚\nGo-redisæ´»ç”¨:\n1 2 3 // æ‰§è¡Œ Redis å‘½ä»¤: val, err := rdb.Get(\"key\").Result() // (*redis.Client).Get(key) fmt.Println(val) é‡è¦æ¦‚å¿µ: åŸå­æ€§ åŸå­æ€§ç¡®ä¿ä¸€ä¸ªæ“ä½œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯ä¸å¯è¢«æ‰“æ–­çš„ã€‚å¯¹äºåŸå­æ“ä½œ, è¦ä¹ˆæ‰€æœ‰çš„æ­¥éª¤éƒ½æˆåŠŸå®Œæˆå¹¶å¯¹å¤–å¯è§, è¦ä¹ˆè¿™äº›æ­¥éª¤éƒ½ä¸æ‰§è¡Œ, ç³»ç»Ÿçš„çŠ¶æ€ä¿æŒä¸å˜ã€‚\nINCR å’Œ DECR æ“ä½œåœ¨ Redis ä¸­å°±æ˜¯åŸå­æ“ä½œã€‚\nä¾‹å­: ç”¨æˆ· A å‘èµ·ç‚¹èµè¯·æ±‚, Redis æ‰§è¡Œ INCR å‘½ä»¤, å°†ç‚¹èµæ•°ä» 10 å¢åŠ åˆ° 11ã€‚ ç”¨æˆ· B å‡ ä¹åŒæ—¶å‘èµ·ç‚¹èµè¯·æ±‚, Redis æ‰§è¡Œ INCR å‘½ä»¤, å°†ç‚¹èµæ•°ä» 11 å¢åŠ åˆ° 12ã€‚\nå› æ­¤, è‹¥å¤šä¸ªæ“ä½œåªæ˜¯å•çº¯çš„å¯¹æ•°æ®è¿›è¡Œå¢åŠ æˆ–å‡å°‘å€¼, Redis æä¾›çš„INCRå’ŒDECRå‘½ä»¤å¯ä»¥ç›´æ¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œå¹¶å‘æ§åˆ¶ã€‚\nä½†æ˜¯, è‹¥å¤šä¸ªæ“ä½œä¸åªæ˜¯å•çº¯çš„è¿›è¡Œæ•°æ®å¢å‡å€¼, è¿˜åŒ…æ‹¬æ›´å¤æ‚çš„æ“ä½œ, å¦‚: é€»è¾‘åˆ¤æ–­, æ­¤æ—¶ Redis çš„å•å‘½ä»¤æ“ä½œæ— æ³•ä¿è¯å¤šä¸ªæ“ä½œäº’æ–¥æ‰§è¡Œ, æ•…å¯ç”¨ Lua è„šæœ¬æ¥è§£å†³æ­¤é—®é¢˜ã€‚https://cloud.tencent.com/developer/article/1844723/\nè·¯ç”±éƒ¨åˆ†æœ€åé…ç½® router.go\n1 2 api.POST(\"/articles/:id/likes\", controllers.LikeArticle) api.GET(\"/articles/:id/likes\", controllers.GetArticleLikes) æµ‹è¯•ç”¨: GET\n1 http://localhost:3000/api/articles/1/likes å¯ä»¥çœ‹åˆ°, æ­£ç¡®åœ°å¾—åˆ°äº† likes ä¸º 0 çš„å“åº”å†…å®¹ã€‚\nä¼˜åŒ– - Redisç¼“å­˜ ä¸ºä½•è¦æœ‰ç¼“å­˜æŠ€æœ¯? å‡è½»æ•°æ®åº“è®¿é—®å‹åŠ›, åŠ å¿«è¯·æ±‚å“åº”é€Ÿåº¦ã€‚\nç¼“å­˜è¯»å–é€Ÿåº¦æ¯”ä»æ•°æ®åº“ä¸­è¯»å–å¿«å¾—å¤šã€‚äº¦å¯å¤§å¹…å‡å°‘æ•°æ®åº“æŸ¥è¯¢çš„æ¬¡æ•°, æé«˜åº”ç”¨ç¨‹åºçš„å“åº”é€Ÿåº¦ã€‚\næ¡ˆä¾‹: æ–‡ç« é¢„è§ˆé¡µé¢, è‹¥æœ‰éå¸¸å¤šçš„æ–‡ç« å†…å®¹(å‡ åƒæ¡å†…å®¹), ä¸”æ­¤é¡¹ç›®ç”¨æˆ·é‡è¾ƒå¤§ è‹¥æ— ç¼“å­˜, æ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€è¦ç›´æ¥è®¿é—®æ•°æ®åº“,\nå¯èƒ½å¸¦æ¥çš„é£é™©: åº”ç”¨ç¨‹åºå“åº”å˜æ…¢, æ•°æ®åº“å®¹æ˜“è¢«å¤§é‡æŸ¥è¯¢æ‹–æ…¢, å½±å“æ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚\nå¸¸è§çš„ç¼“å­˜è®¾è®¡æ¨¡å¼ æ—è·¯ç¼“å­˜æ¨¡å¼(Cache-Aside æ¨¡å¼): åº”ç”¨ç¨‹åºç›´æ¥ä¸ç¼“å­˜å’Œæ•°æ®åº“äº¤äº’, å¹¶è´Ÿè´£ç®¡ç†ç¼“å­˜çš„å†…å®¹ã€‚ä½¿ç”¨è¯¥æ¨¡å¼çš„åº”ç”¨ç¨‹åº, ä¼šåŒæ—¶æ“ä½œç¼“å­˜ä¸æ•°æ®åº“\nå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š\nå…ˆå°è¯•ä»ç¼“å­˜ä¸­è¯»å–æ•°æ®ã€‚è‹¥ç¼“å­˜å‘½ä¸­, ç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„æ•°æ®,\nè‹¥ç¼“å­˜æœªå‘½ä¸­, åˆ™ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®, å¹¶å°†æ•°æ®å­˜å…¥ç¼“å­˜ä¸­, ç„¶åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚\nä»£ç é€»è¾‘:\nç¼“å­˜æœªå‘½ä¸­ï¼š å¦‚æœ Redis ä¸­æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç¼“å­˜(ç¼“å­˜æœªå‘½ä¸­), ä»£ç ä¼šä»æ•°æ®åº“ä¸­è·å–æ–‡ç« æ•°æ®ã€‚ è·å–åˆ°æ•°æ®å, ä»£ç å°†æ•°æ®åºåˆ—åŒ–ä¸º JSON, å¹¶å°†å…¶å­˜å‚¨åœ¨ Redis ç¼“å­˜ä¸­, åŒæ—¶è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚ æœ€å, è¿”å›æ•°æ®åº“ä¸­çš„æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚ ç¼“å­˜å‘½ä¸­ï¼š å¦‚æœç¼“å­˜å‘½ä¸­ (Redis ä¸­æ‰¾åˆ°äº†å¯¹åº”çš„ç¼“å­˜æ•°æ®), ä»£ç ç›´æ¥ä»ç¼“å­˜ä¸­è·å–æ•°æ®ã€‚ ç„¶å, å°†ç¼“å­˜ä¸­çš„æ•°æ®ååºåˆ—åŒ–ä¸ºæ–‡ç« åˆ—è¡¨, è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ (åœ¨è¯»å–æ•°æ®æ—¶, åªæœ‰åœ¨ç¼“å­˜æœªå‘½ä¸­çš„æƒ…å†µä¸‹, æ‰ä¼šæŸ¥è¯¢æ•°æ®åº“å¹¶å°†ç»“æœå†™å…¥ç¼“å­˜ã€‚)\næ­¤å¤–, è¿˜æœ‰å¦‚è¯»å†™ç©¿é€æ¨¡å¼ç­‰ç­‰æ¨¡å¼ã€‚\nè§£å†³ä¸‹ä¸€ä¸ªé—®é¢˜ï¼š\nè‹¥åœ¨ç¼“å­˜æœ‰æ•ˆæœŸå†…, ç”¨æˆ·åˆæ–°å¢äº†ä¸€äº›æ–‡ç« , æ­¤æ—¶ç”¨æˆ·é€šè¿‡ç¼“å­˜å¾—åˆ°æ–‡ç« , å°†çœ‹ä¸åˆ°å˜åŒ–ã€‚\nè§£å†³æ–¹æ³•æ¡ˆä¾‹:\nå¸¸è§çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥ è®¾ç½®è¿‡æœŸæ—¶é—´ (æˆ‘ä»¬å·²ç»åšè¿‡äº†)\nä¸»åŠ¨æ›´æ–°ç¼“å­˜ (å¦‚ä½•ä¿è¯æ•°æ®åº“å’Œç¼“å­˜çš„æ•°æ®ä¸€è‡´æ€§)\nå¦‚: å½“æ–°å¢æ–‡ç« æ—¶, é™¤äº†æ›´æ–°æ•°æ®åº“, è¿˜è¦åŒæ­¥æ›´æ–°æˆ–åˆ é™¤ç¼“å­˜ä¸­çš„å¯¹åº”æ•°æ®ã€‚è¿™æ ·, ä¸‹ä¸€æ¬¡è¯»å–æ—¶, ç¼“å­˜ä¸­çš„æ•°æ®å°±æ˜¯æœ€æ–°çš„ã€‚\næˆ–è€…æ–°å¢æ–‡ç« æ—¶, ä¸ç›´æ¥æ›´æ–°ç¼“å­˜, è€Œæ˜¯åˆ é™¤ç¼“å­˜ä¸­çš„æ—§æ•°æ®ã€‚ä¸‹æ¬¡è¯»å–æ—¶, ç”±äºç¼“å­˜æ²¡æœ‰å‘½ä¸­, ä»æ•°æ®åº“ä¸­è¯»å–æœ€æ–°æ•°æ®å¹¶é‡æ–°å†™å…¥ç¼“å­˜ã€‚\nRedis DELå‘½ä»¤: ç”¨äºåˆ é™¤å·²å­˜åœ¨çš„é”®ã€‚\n1 2 3 4 5 // ä¸»åŠ¨æ›´æ–°ç¼“å­˜ åˆ é™¤å°±ç¼“å­˜ if err := global.RedisDB.Del(cacheKey); err != nil { ctx.JSON(http.StatusInternalServerError, gin.H{\"error\": err.Error()}) return } CORS è·¨åŸŸ CORS (Cross-Origin Resource Sharing), å…¨ç§°ä¸º\"è·¨åŸŸ (è·¨æº) èµ„æºå…±äº«, æ˜¯ä¸€ç§æœºåˆ¶, ä½¿ç”¨é¢å¤–çš„ HTTP å¤´æ¥å‘Šè¯‰æµè§ˆå™¨å…è®¸ä¸€ä¸ªç½‘é¡µä»å¦ä¸€ä¸ªåŸŸ (ä¸åŒäºè¯¥ç½‘é¡µæ‰€åœ¨çš„åŸŸ) è¯·æ±‚èµ„æºã€‚è¿™æ ·å¯ä»¥åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´è¿›è¡Œå®‰å…¨çš„è·¨åŸŸé€šä¿¡ã€‚\næµè§ˆå™¨å°† CORS è¯·æ±‚åˆ†æˆä¸¤ç±»:\nç®€å•è¯·æ±‚ (simple req) æ–¹æ³•å¦‚GET, POST\nå¤´éƒ¨å­—æ®µå¦‚: Accept, Accept-Language, Content-Language, Content-Type(éœ€è¦æ³¨æ„é¢å¤–çš„é™åˆ¶)ç­‰\nåœ¨ Postman ä¸­æ£€æŸ¥ content-type åŠ content-length\néç®€å•è¯·æ±‚ (not-so-simple req) æ–¹æ³•å¦‚PUT\nåœ¨æ­£å¼é€šä¿¡ä¹‹å‰, å¢åŠ ä¸€æ¬¡HTTPæŸ¥è¯¢è¯·æ±‚, ç§°ä¸ºé¢„æ£€ (Preflight)è¯·æ±‚ã€‚ è¯¥è¯·æ±‚æ˜¯Optionæ–¹æ³•çš„, é€šè¿‡è¯¥è¯·æ±‚æ¥çŸ¥é“æœåŠ¡ç«¯æ˜¯å¦å…è®¸è·¨åŸŸè¯·æ±‚ã€‚\nå¯¹äºç®€å•è¯·æ±‚, æµè§ˆå™¨ç›´æ¥å‘å‡º CORS è¯·æ±‚ã€‚\nCORS ç›¸å…³çš„é—®é¢˜ åŸŸæ˜¯ä»€ä¹ˆ?\nOrigin, å¯è¯‘ä¸ºæº, äº¦å¯è¯‘ä¸ºåŸŸ, åœ¨ CORS ä¸Šä¸‹æ–‡ä¸­ Origin ç”±ä¸‰ä¸ªå…ƒç´ ç»„æˆï¼š Origin å³ä¸º åè®®(å¦‚https) + åŸŸå(å¦‚www.example.com) + ç«¯å£(å¦‚80) åŒæºç­–ç•¥(Same-Origin Policy, SOP)\næµè§ˆå™¨çš„ä¸€ç§å®‰å…¨æœºåˆ¶, ç”¨äºé˜²æ­¢æ¶æ„ç½‘ç«™é€šè¿‡è„šæœ¬å¯¹å…¶ä»–ç½‘ç«™çš„å†…å®¹è¿›è¡Œè®¿é—®ã€‚ ä»¥ä¸‹ URL å±äºåŒæºåœ°å€ï¼š\nå¦‚: example.com:443 å’Œ example.com:443/articles\nä½†inkkaplumé¢‘é“Bç«™.example.com/articles å’Œ example.com/articlesåˆ™ä¸æ˜¯ã€‚\nè‡ªç„¶, example.com:80å’Œexample.com:443åˆ™ä¸æ˜¯\nè·¨åŸŸè¯·æ±‚\næŒ‡ä»ä¸€ä¸ªåŸŸå‘å¦ä¸€ä¸ªåŸŸå‘èµ·çš„ HTTP è¯·æ±‚ã€‚(æ¯”å¦‚ä»80ç«¯å£å‘é€åˆ°443ç«¯å£çš„è¯·æ±‚)\nå¦‚ä»å‰ç«¯åº”ç”¨å‘ä¸åŒçš„åç«¯ API æœåŠ¡å™¨è¯·æ±‚æ•°æ®, ä½†æ˜¯åŒæºç­–ç•¥é»˜è®¤ä¼šé˜»æ­¢è¿™äº›è¯·æ±‚ã€‚\næ‰€ä»¥éœ€è¦ CORS æœºåˆ¶æ¥æ˜¾å¼å…è®¸è·¨åŸŸè®¿é—®ã€‚\næœ¬æ¡ˆä¾‹çš„ URL:\n(å‰ç«¯)http://localhost:5173 å’Œ(åç«¯)http://localhost:3000\næµè§ˆå™¨é»˜è®¤å…è®¸åŒæºè¯·æ±‚, ä½†æ˜¯é»˜è®¤ä¼šé˜»æ­¢è¿™äº›è·¨åŸŸè¯·æ±‚, é™¤éæœåŠ¡å™¨æ˜ç¡®å…è®¸ã€‚\nè¦è§£å†³è¿™ä¸ªé—®é¢˜, éœ€åœ¨åç«¯åº”ç”¨ä¸­é…ç½® CORS, å…è®¸å‰ç«¯åº”ç”¨http://localhost:5173è®¿é—®åç«¯ APIã€‚\nå®‰è£… CORS ä¸­é—´ä»¶ ä½¿ç”¨ Gin CORS middleware, å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨ Gin ä¸­é…ç½® CORSã€‚\nå®˜æ–¹æ¡ˆä¾‹: https://github.com/gin-contrib/cors\nå‘½ä»¤\n1 go get github.com/gin-contrib/cors 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 package main import ( \"time\" \"github.com/gin-contrib/cors\" \"github.com/gin-gonic/gin\" ) func main() { router := gin.Default() // CORS for https://foo.com and https://github.com origins, allowing: // - PUT and PATCH methods // - Origin header // - Credentials share // - Preflight requests cached for 12 hours router.Use(cors.New(cors.Config{ AllowOrigins: []string{\"https://....com\"}, AllowMethods: []string{\"PUT\", \"PATCH\"}, AllowHeaders: []string{\"Origin\"}, ExposeHeaders: []string{\"Content-Length\"}, AllowCredentials: true, AllowOriginFunc: func(origin string) bool { return origin == \"https://github.com\" }, MaxAge: 12 * time.Hour, })) router.Run() } ä¼˜é›…åœ°é€€å‡ºåº”ç”¨ æˆ‘ä»¬ç›®å‰å¯ä»¥çœ‹åˆ°\n1 exit status 0xc000013a æˆ‘ä»¬éœ€è¦è¿›è¡Œå¤„ç†ã€‚\nå‚è€ƒæ­¤æ–‡æ¡£:\nhttps://gin-gonic.com/zh-cn/docs/examples/graceful-restart-or-stop/\nGo Channel Go è¯­è¨€çš„å¹¶å‘æ¨¡å‹æ˜¯ CSP (Communicating Sequential Processes/è¯‘ä¸ºé€šä¿¡é¡ºåºè¿›ç¨‹), æå€¡ é€šè¿‡é€šä¿¡å…±äº«å†…å­˜ è€Œéé€šè¿‡å…±äº«å†…å­˜è€Œå®ç°é€šä¿¡ã€‚ä¹Ÿå°±æ˜¯goroutineé—´çš„é€šä¿¡æœºåˆ¶ã€‚\nChannel ç±»å‹: é€šé“åœ¨ Go ä¸­æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»å‹ã€‚\né€šé“åƒä¸€ä¸ªé˜Ÿåˆ—(Queue), æ€»æ˜¯éµå¾ªå…ˆå…¥å…ˆå‡º(FIFO)çš„è§„åˆ™ä»¥ä¿è¯æ”¶å‘æ•°æ®çš„é¡ºåºã€‚\n1 var channelExample chan int // å£°æ˜ä¸€ä¸ªä¼ é€’æ•´å‹çš„é€šé“ åˆ¤æ–­:\nchan T åŒå‘chanç±»å‹çš„T\nchan\u003c- T å•å‘å†™å…¥chanç±»å‹çš„Tï¼ˆåªå†™ï¼‰\n\u003c-chan Tå•å‘æ¥æ”¶chanç±»å‹çš„Tï¼ˆåªè¯»ï¼‰\né€šé“æ˜¯å¼•ç”¨ç±»å‹, æ•…ç©ºå€¼ä¸ºnilã€‚\næ¡ˆä¾‹:\n1 2 var channelExample chan int fmt.Println(channelExample) //è¾“å‡º å£°æ˜çš„ Channel, éœ€ç”¨ make func åˆå§‹åŒ–ä¹‹åæ‰èƒ½ä½¿ç”¨ã€‚æ ¼å¼å¦‚ä¸‹:\n1 2 3 make(chan å…ƒç´ ç±»å‹, [ç¼“å†²(Buffer)å¤§å°(å¯é€‰)]) // ä¾‹å­: channelExample01 := make(chan []int) æ“ä½œ: æœ‰å‘é€(Send)ã€æ¥æ”¶(Receive)å’Œå…³é—­(Close)ä¸‰ç§æ“ä½œã€‚ å‘é€çš„æ¡ˆä¾‹:\n1 2 var channelExample chan int channelExample \u003c- 114 // ä¼šæ­»é” æ¥æ”¶çš„æ¡ˆä¾‹\n1 2 example := \u003c- channelExample \u003c-channelExample å…³é—­çš„æ¡ˆä¾‹\né€šè¿‡è°ƒç”¨å†…ç½®çš„ close func æ¥å…³é—­ channelã€‚\n1 close(channelExample) å…³é—­åçš„é€šé“æœ‰å¦‚ä¸‹ç‰¹ç‚¹:\nå†å‘é€å€¼å°±ä¼šå¯¼è‡´ panicã€‚ å¯¹å…¶è¿›è¡Œæ¥æ”¶ä¼šä¸€ç›´è·å–å€¼ç›´åˆ°é€šé“ä¸ºç©ºã€‚ å¯¹ä¸€ä¸ªå…³é—­çš„å¹¶ä¸”æ²¡æœ‰å€¼çš„é€šé“æ‰§è¡Œæ¥æ”¶æ“ä½œä¼šå¾—åˆ°å¯¹åº”ç±»å‹çš„é›¶å€¼ã€‚ å…³é—­ä¸€ä¸ªå·²ç»å…³é—­çš„é€šé“ä¼šå¯¼è‡´ panicã€‚ åˆ¤æ–­ channel æ˜¯å¦å…³é—­\n1 v, ok := \u003c-channel æ­»é”(Deadlock) 1 fatal error: all goroutines are asleep - deadlock! ç¬¬ä¸€ç§æƒ…å½¢\n1 2 3 4 5 6 7 8 func main() { channel := make(chan int, 0) // ç¼“å†²åŒºå¤§å°ä¸º0 channel \u003c- 114 x := \u003c- channel fmt.Println(x) } è§£å†³æ–¹æ³•, ç¼“å†²å¤§å°æ”¹å˜, å¦‚channel := make(chan int, 1)\nä½†æ˜¯:\n1 2 3 4 5 6 7 8 func main() { channel := make(chan int, 1) channel \u003c- 10 channel \u003c- 10 x:= \u003c- channel fmt.Println(x) // deadlock } æˆ–è€…,\n1 2 3 4 5 6 7 8 9 10 func main() { channel := make(chan int, 0) go func(){ channel \u003c- 114 }() x := \u003c- channel fmt.Println(x) // 114 } ç¬¬äºŒç§æƒ…å½¢\n1 2 3 4 5 6 7 8 func main() { channel := make(chan int) x := \u003c- channel go func() { channel \u003c-114 }() fmt.Println(x) // deadlock } ç¬¬ä¸‰ç§æƒ…å½¢\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 func main() { channel01 := make(chan int) channel02 := make(chan int) go func() { select { case \u003c- channel01: channel02\u003c-114 } }() select { case \u003c- channel02: channel01 \u003c- 114 } } // chan1 chan2éƒ½åœ¨ç­‰ä»å¯¹æ–¹è¯»å‡ºä¸œè¥¿ //ç»“è®º: fatal error: all goroutines are asleep - deadlock! Selectè¯´æ˜: select æ˜¯ Go ä¸­çš„ä¸€ä¸ªæ§åˆ¶ç»“æ„ã€‚\nå®˜æ–¹æ–‡æ¡£å…³é—­æ¡ˆä¾‹ https://gin-gonic.com/zh-cn/docs/examples/graceful-restart-or-stop/\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 // +build go1.8 package main import ( \"context\" \"log\" \"net/http\" \"os\" \"os/signal\" \"time\" \"github.com/gin-gonic/gin\" ) func main() { router := gin.Default() router.GET(\"/\", func(c *gin.Context) { time.Sleep(5 * time.Second) c.String(http.StatusOK, \"Welcome Gin Server\") }) srv := \u0026http.Server{ Addr: \":8080\", Handler: router, } go func() { if err := srv.ListenAndServe(); err != nil \u0026\u0026 err != http.ErrServerClosed { log.Fatalf(\"listen: %s\\n\", err) } }() quit := make(chan os.Signal, 1) signal.Notify(quit, os.Interrupt) \u003c-quit log.Println(\"Shutdown Server ...\") ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second) defer cancel() if err := srv.Shutdown(ctx); err != nil { log.Fatal(\"Server Shutdown:\", err) } log.Println(\"Server exiting\") } ç„¶åå³å¯çœ‹åˆ°æ”¹å˜:\n1 2 2024/08/30 23:34:22 Shutdown Server... 2024/08/30 23:34:22 Server exiting sync.WaitGroup WaitGroupæ˜¯sync package ä¸­çš„ä¸€ä¸ªstruct, ç”¨æ¥æ”¶é›†éœ€è¦ç­‰å¾…æ‰§è¡Œå®Œæˆçš„goroutineã€‚\nä¸‰ä¸ªæ–¹æ³•:\nAdd(): ç”¨æ¥è®¾ç½®æˆ–æ·»åŠ è¦ç­‰å¾…å®Œæˆçš„ goroutine æ•°é‡ ä¾‹å­:\nAdd(2)æˆ–ä¸¤æ¬¡è°ƒç”¨Add(1)éƒ½ä¼šè®¾ç½®ç­‰å¾…è®¡æ•°å™¨çš„å€¼ä¸º 2, å³ä¸ºè¦ç­‰å¾… 2 ä¸ª goroutine å®Œæˆã€‚\nè‡ªç„¶, Done()åˆ™è¡¨ç¤ºéœ€è¦ç­‰å¾…çš„ goroutine åœ¨çœŸæ­£å®Œæˆä¹‹å‰, åº”è°ƒç”¨è¯¥æ–¹æ³•æ¥äººä¸ºè¡¨ç¤º goroutine å®Œæˆäº†, é‡è¦åœ°æ˜¯: è¯¥æ–¹æ³•ä¼šå¯¹ç­‰å¾…è®¡æ•°å™¨å‡ 1ã€‚\næœ€å, Wait()åˆ™æ„å‘³ç€åœ¨ç­‰å¾…è®¡æ•°å™¨å‡ä¸º 0 ä¹‹å‰, Wait()ä¼šä¸€ç›´é˜»å¡å½“å‰çš„ goroutine\næ¡ˆä¾‹ä»£ç :\n1 2 3 4 5 6 7 8 9 10 11 12 13 func TestTaskControdl(t *testing.T) { taskNum := 5 wg := sync.WaitGroup{} wg.Add(taskNum) for i := 0; i \u003c taskNum; i ++ { go func(i int) { defer wg.Done() fmt.Println(\"info\", i) }(i) } wg.Wait() } ç»“è®ºï¼š\n1 2 3 4 5 info 4 info 3 info 1 info 0 info 2 Closeæ¡ˆä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 func Test(t *testing.T){ test := make(chan int, 10) go func(info chan int){ for{ select{ case val, ok := \u003c- test: if !ok{ t.Logf(\"Channel Closed!\") return } t.Logf(\"data %d\\n\", val) } } }(test) go func(){ test \u003c- 1 time.Sleep(1 * time.Second) test \u003c- 2 close(test) }() time.Sleep(5 *time.Second) } è¾“å‡º\n1 2 3 data 1 data 2 Context Closed! å•ç‹¬é€€å‡ºé€šé“ ä¼ è¾“æ•°æ®ä¸å…±ç”¨ä¸€ä¸ª channel\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 func TestA(t *testing.T) { test := make(chan int, 5) exit := make(chan struct{}) go func(info chan int, exit chan struct{}) { for { select { case val := \u003c-info: t.Logf(\"data %d\\n\", val) case \u003c-exit: t.Logf(\"Task Exit!!\\n\") return } } }(test, exit) go func() { test \u003c- 1 time.Sleep(1 * time.Second) test \u003c- 2 close(exit) }() time.Sleep(5 *time.Second) } è¶…æ—¶ä»»åŠ¡æ§åˆ¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 func Test(t *testing.T){ test := make(chan int, 5) go func(info chan int){ for{ select{ case val := \u003c- info: t.Logf(\"Data %d\\n\", val) case \u003c- time.After(2 * time.Second): t.Logf(\"Time out!\\n\") return } } }(test) go func(){ test \u003c- 1 time.Sleep(2 * time.Second) //\u003e=2 test \u003c- 2 }() time.Sleep(5 *time.Second) } ç»“è®º:\n1 2 main_test.go:98: Data 1 main_test.go:101: Time out! Context çš„åœºæ™¯ ","wordCount":"4821","inLanguage":"en","datePublished":"2024-11-01T15:39:00+08:00","dateModified":"2024-11-01T15:39:00+08:00","author":{"@type":"Person","name":"erica423"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://erica423.github.io/posts/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3redis/"},"publisher":{"@type":"Organization","name":"Erica-Blog","logo":{"@type":"ImageObject","url":"https://erica423.github.io/images/dls_icon.png"}}}</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://erica423.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://erica423.github.io/images/dls_icon.png alt aria-label=logo height=25>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://erica423.github.io/archives/ title=ğŸ®åŠ¨æ€><span>ğŸ®åŠ¨æ€</span></a></li><li><a href=https://erica423.github.io/tags/ title=ğŸ²æ ‡ç­¾><span>ğŸ²æ ‡ç­¾</span></a></li><li><a href=https://erica423.github.io/search/ title="ğŸ¯æœç´¢ (Alt + /)" accesskey=/><span>ğŸ¯æœç´¢</span></a></li><li><a href=https://github.com/Erica423/Erica423.github.io/ title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://erica423.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://erica423.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">ä¸€æ–‡ç†è§£å’Œä½¿ç”¨Redis</h1><div class=post-meta><span title='2024-11-01 15:39:00 +0800 +0800'>November 1, 2024</span>&nbsp;Â·&nbsp;erica423&nbsp;|&nbsp;<a href=https://github.com/Erica423/Erica423.github.io rel="noopener noreferrer" target=_blank>ä¸»é¡µ</a><div class=meta-item>&nbspÂ·&nbsp
	      <span id=busuanzi_container_page_pv>æœ¬æ–‡é˜…è¯»é‡<span id=busuanzi_value_page_pv></span>æ¬¡</span></div></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#å®šä¹‰>å®šä¹‰</a></li><li><a href=#å’Œmysqlçš„åŒºåˆ«>å’ŒMySQLçš„åŒºåˆ«</a></li><li><a href=#redisåŸºæœ¬æ•°æ®ç±»å‹>RedisåŸºæœ¬æ•°æ®ç±»å‹</a></li><li><a href=#redisæŒä¹…åŒ–>RedisæŒä¹…åŒ–</a><ul><li><a href=#è®¾ç½®æ–¹æ³•>è®¾ç½®æ–¹æ³•</a></li></ul></li><li><a href=#go-redis>Go-redis</a></li><li><a href=#å®ç°ç‚¹èµåŠŸèƒ½>å®ç°ç‚¹èµåŠŸèƒ½</a><ul><li><a href=#redis-key-å‘½åè§„èŒƒçš„è®¾è®¡>redis key å‘½åè§„èŒƒçš„è®¾è®¡</a></li><li><a href=#set-incr-decr-getå‘½ä»¤>SET, INCR, DECR, GETå‘½ä»¤</a></li><li><a href=#é‡è¦æ¦‚å¿µ-åŸå­æ€§>é‡è¦æ¦‚å¿µ: åŸå­æ€§</a></li><li><a href=#è·¯ç”±éƒ¨åˆ†æœ€åé…ç½®>è·¯ç”±éƒ¨åˆ†æœ€åé…ç½®</a></li></ul></li><li><a href=#ä¼˜åŒ–---redisç¼“å­˜>ä¼˜åŒ– - Redisç¼“å­˜</a><ul><li><a href=#å¸¸è§çš„ç¼“å­˜è®¾è®¡æ¨¡å¼>å¸¸è§çš„ç¼“å­˜è®¾è®¡æ¨¡å¼</a></li><li><a href=#å¸¸è§çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥>å¸¸è§çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥</a></li></ul></li><li><a href=#cors-è·¨åŸŸ>CORS è·¨åŸŸ</a><ul><li><a href=#cors-ç›¸å…³çš„é—®é¢˜>CORS ç›¸å…³çš„é—®é¢˜</a></li></ul></li><li><a href=#ä¼˜é›…åœ°é€€å‡ºåº”ç”¨>ä¼˜é›…åœ°é€€å‡ºåº”ç”¨</a><ul><li><a href=#go-channel>Go Channel</a></li><li><a href=#æ­»é”deadlock>æ­»é”(Deadlock)</a></li><li><a href=#syncwaitgroup>sync.WaitGroup</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>Redis å®˜ç½‘: <a href=https://redis.io/>https://redis.io/</a></p><p>å®‰è£… Redis: <a href=https://github.com/tporadowski/redis/releases>https://github.com/tporadowski/redis/releases</a>.
é€‰æ‹©<code>Redis-x64-5.0.14.1.msi</code>å³å¯</p><h2 id=å®šä¹‰>å®šä¹‰<a hidden class=anchor aria-hidden=true href=#å®šä¹‰>#</a></h2><p>Redis æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ NoSQL, ç”¨ C å®ç°, å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„ Key-Value å­˜å‚¨æ•°æ®åº“, å¹¶æä¾›å¤šç§è¯­è¨€çš„ APIã€‚</p><p>æ ¹æ®æœˆåº¦æ’è¡Œç½‘ç«™<code>DB-Engines.com</code>çš„æ•°æ®ï¼ŒRedis æ˜¯ç°åœ¨æœ€å—æ¬¢è¿çš„ NoSQL æ•°æ®åº“ä¹‹ä¸€(MongoDB äº¦ä¸º NoSQL æ•°æ®åº“)ã€‚</p><h2 id=å’Œmysqlçš„åŒºåˆ«>å’ŒMySQLçš„åŒºåˆ«<a hidden class=anchor aria-hidden=true href=#å’Œmysqlçš„åŒºåˆ«>#</a></h2><ul><li>å…³ç³»å‹DBä¾èµ–äºä¼ ç»Ÿçš„è¡¨è¡Œåˆ—å­˜å‚¨ï¼Œéå…³ç³»å‹DBä¾é kvå­˜å‚¨ã€‚</li><li>Redisä¸æ”¯æŒSQLè¯­å¥ã€‚</li><li>ä¸ MySQL æ•°æ®åº“ä¸åŒçš„æ˜¯(ä¸ºäº†å®ç°æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨, Mysql å°†æ•°æ®å­˜å‚¨åˆ°äº†ç£ç›˜ä¸­), Redis çš„æ•°æ®æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ã€‚å®ƒçš„è¯»å†™é€Ÿåº¦éå¸¸å¿«ã€‚</li></ul><h2 id=redisåŸºæœ¬æ•°æ®ç±»å‹>RedisåŸºæœ¬æ•°æ®ç±»å‹<a hidden class=anchor aria-hidden=true href=#redisåŸºæœ¬æ•°æ®ç±»å‹>#</a></h2><p>Redis æœ‰å¦‚ å­—ç¬¦ä¸²(String)ã€åˆ—è¡¨(List)ã€é›†åˆ(Set)ã€æœ‰åºé›†åˆ(ZSet/Sorted Set) è¿™æ ·çš„åŸºç¡€æ•°æ®ç±»å‹ã€‚</p><p>ä¼˜åŠ¿: æ€§èƒ½å¥½ã€ä¸°å¯Œçš„æ•°æ®ç±»å‹ã€‚</p><h2 id=redisæŒä¹…åŒ–>RedisæŒä¹…åŒ–<a hidden class=anchor aria-hidden=true href=#redisæŒä¹…åŒ–>#</a></h2><p>å®šä¹‰: æŒä¹…åŒ–æ˜¯æŒ‡å°†æ•°æ®å†™å…¥æŒä¹…å­˜å‚¨(durable storage), å¦‚å›ºæ€ç¡¬ç›˜(SSD)ã€‚</p><blockquote><p>æ³¨: å³ä½¿æœ‰æŒä¹…åŒ–æœºåˆ¶ï¼ŒRedisä¹Ÿæ— æ³•ä¿è¯æ°¸è¿œä¸ä¸¢å¤±æ•°æ®ã€‚</p></blockquote><p>Redis æä¾›äº†ä¸€ç³»åˆ—é€‰é¡¹ã€‚</p><ol><li><p><strong>RDB</strong>(Redis Database): åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…åˆ›å»ºæ•°æ®é›†çš„å¿«ç…§æ¥ä¿å­˜æ•°æ®ã€‚
ä¼˜åŠ¿ï¼šéš”ä¸€æ®µæ—¶é—´ä¿å­˜ä¸€æ¬¡ï¼Œå¯¹æ€§èƒ½å½±å“å°ï¼› ç¼ºç‚¹ï¼šåœ¨ä¸¤æ¬¡ä¿å­˜é—´éš”ä¹‹é—´å¯èƒ½ä¸¢å¤±æ•°æ®ã€‚</p></li><li><p><strong>AOF</strong>(Append Only File): è®°å½•æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ¯ä¸€ä¸ªå†™æ“ä½œï¼Œå¹¶å°†è¿™äº›æ“ä½œè¿½åŠ åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚
ä¼˜åŠ¿ï¼šå‡ºç°é—®é¢˜å¯ä»¥é‡æ”¾æ—¥å¿—æ“ä½œæ¥é‡å»ºdbï¼› ç¼ºç‚¹ï¼šè®°å½•äº†æ¯ä¸€ä¸ªæ“ä½œï¼Œå½±å“æ€§èƒ½ã€‚</p></li><li><p>æ— æŒä¹…åŒ–: å®Œå…¨ç¦ç”¨ Redis çš„æŒä¹…åŒ–æœºåˆ¶, è¿™æ„å‘³ç€ Redis åªä¼šåœ¨å†…å­˜ä¸­å­˜å‚¨æ•°æ®ã€‚</p></li><li><p>AOF + RDB ç»„åˆ: å¯ä»¥åœ¨åŒä¸€ä¸ªå®ä¾‹ä¸­åŒæ—¶å¯ç”¨ RDB å’Œ AOF æŒä¹…åŒ–ã€‚</p></li></ol><h3 id=è®¾ç½®æ–¹æ³•>è®¾ç½®æ–¹æ³•<a hidden class=anchor aria-hidden=true href=#è®¾ç½®æ–¹æ³•>#</a></h3><p>åœ¨ redis ç›®å½•ä¸‹, æ‰¾åˆ°<code>redis.windows.conf</code>å³å¯ã€‚</p><p>RDB éƒ¨åˆ†</p><p>é»˜è®¤æƒ…å†µä¸‹, Redis ä¼šå°†æ•°æ®é›†çš„å¿«ç…§ä¿å­˜åœ¨ç£ç›˜ä¸Šä¸€ä¸ªåä¸º <code>dump.rdb</code>çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚</p><p>ç›®å½•(ä¸€èˆ¬æƒ…å†µ)</p><p><code>C:\Program Files\Redis</code>ï¼Œ åœ¨<code>redis.windows.conf</code>æ–‡ä»¶å†…</p><p>æ‰¾åˆ°</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>save 60 1000
</span></span></code></pre></td></tr></table></div></div><p>AOF éƒ¨åˆ†</p><p>æ‰¾åˆ° å°†<code>no</code>æ”¹ä¸º<code>yes</code>, å¼€å¯ AOF</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>appendonly yes
</span></span></code></pre></td></tr></table></div></div><p>å®ƒåœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­çš„ä½œç”¨ï¼š</p><ul><li>è®¡æ•°å™¨ ï¼ˆç‚¹èµã€è½¬å‘ã€è¯„è®ºæ•°ï¼‰</li></ul><h2 id=go-redis>Go-redis<a hidden class=anchor aria-hidden=true href=#go-redis>#</a></h2><p>å®šä¹‰: Go-redis æ˜¯ Golang ä¸­ç”¨äºä¸ Redis äº¤äº’çš„å¼ºå¤§å·¥å…·, æ”¯æŒ Redis Server çš„ Golang å®¢æˆ·ç«¯ã€‚</p><p>GitHub: <a href=https://github.com/redis/go-redis>https://github.com/redis/go-redis</a></p><p>æ–‡æ¡£: <a href=https://redis.uptrace.dev/zh/>https://redis.uptrace.dev/zh/</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go get -u github.com/go-redis/redis
</span></span></code></pre></td></tr></table></div></div><p><code>config/redis.go</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>config</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;github.com/go-redis/redis&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>RedisClient</span> <span class=o>*</span><span class=nx>redis</span><span class=p>.</span><span class=nx>Client</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>InitRedis</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>RedisClient</span> <span class=p>=</span> <span class=nx>redis</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>redis</span><span class=p>.</span><span class=nx>Options</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Addr</span><span class=p>:</span> <span class=s>&#34;localhost:6379&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>DB</span><span class=p>:</span>   <span class=mi>0</span><span class=p>,</span>  <span class=c1>// é»˜è®¤æ•°æ®åº“(use default DB)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>Password</span><span class=p>:</span> <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>RedisClient</span><span class=p>.</span><span class=nf>Ping</span><span class=p>().</span><span class=nf>Result</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>panic</span><span class=p>(</span><span class=s>&#34;Failed to connect to Redis&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>localhost:6379</code>â€”â€”åœ¨å®‰è£…è¿‡ç¨‹ä¸­è®¾ç½®çš„ç«¯å£ã€‚é»˜è®¤æƒ…å†µä¸‹å°±æ˜¯ 6379ã€‚</p><p><code>global.go</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>DB</span> <span class=o>*</span><span class=nx>gorm</span><span class=p>.</span><span class=nx>DB</span>
</span></span><span class=line><span class=cl>    <span class=nx>RedisDB</span> <span class=o>*</span><span class=nx>redis</span><span class=p>.</span><span class=nx>Client</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=å®ç°ç‚¹èµåŠŸèƒ½>å®ç°ç‚¹èµåŠŸèƒ½<a hidden class=anchor aria-hidden=true href=#å®ç°ç‚¹èµåŠŸèƒ½>#</a></h2><p>ç»™æ–‡ç« å¢åŠ ç‚¹èµæ•°ï¼Œ<code>like_controller.go</code></p><h3 id=redis-key-å‘½åè§„èŒƒçš„è®¾è®¡>redis key å‘½åè§„èŒƒçš„è®¾è®¡<a hidden class=anchor aria-hidden=true href=#redis-key-å‘½åè§„èŒƒçš„è®¾è®¡>#</a></h3><p>key å•è¯ä¸å•è¯ä¹‹é—´ä»¥ (:)åˆ†å‰², å¦‚<code>user:userinfo</code>, <code>article:1:likes</code></p><h3 id=set-incr-decr-getå‘½ä»¤>SET, INCR, DECR, GETå‘½ä»¤<a hidden class=anchor aria-hidden=true href=#set-incr-decr-getå‘½ä»¤>#</a></h3><p><code>SET</code> å‘½ä»¤ç”¨äºè®¾ç½®ç»™å®š key çš„å€¼ã€‚</p><p><code>INCR</code> å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€ã€‚è‹¥ key ä¸å­˜åœ¨,é‚£ä¹ˆ key çš„å€¼ä¼šå…ˆè¢«åˆå§‹åŒ–ä¸º 0,ç„¶åå†æ‰§è¡Œæ“ä½œã€‚(<code>0</code> -> <code>1</code>)</p><p><code>DECR</code> åˆ™å°† key ä¸­å‚¨å­˜çš„æ•°å­—å‡ä¸€ã€‚</p><p><code>GET</code> å‘½ä»¤ç”¨äºè·å–æŒ‡å®š key çš„å€¼ã€‚</p><p>Go-redisæ´»ç”¨:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// æ‰§è¡Œ Redis å‘½ä»¤:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>val</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>rdb</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;key&#34;</span><span class=p>).</span><span class=nf>Result</span><span class=p>()</span> <span class=c1>// (*redis.Client).Get(key)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>val</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=é‡è¦æ¦‚å¿µ-åŸå­æ€§>é‡è¦æ¦‚å¿µ: åŸå­æ€§<a hidden class=anchor aria-hidden=true href=#é‡è¦æ¦‚å¿µ-åŸå­æ€§>#</a></h3><p>åŸå­æ€§ç¡®ä¿ä¸€ä¸ªæ“ä½œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯ä¸å¯è¢«æ‰“æ–­çš„ã€‚å¯¹äºåŸå­æ“ä½œ, è¦ä¹ˆæ‰€æœ‰çš„æ­¥éª¤éƒ½æˆåŠŸå®Œæˆå¹¶å¯¹å¤–å¯è§, è¦ä¹ˆè¿™äº›æ­¥éª¤éƒ½ä¸æ‰§è¡Œ, ç³»ç»Ÿçš„çŠ¶æ€ä¿æŒä¸å˜ã€‚</p><p><code>INCR</code> å’Œ <code>DECR</code> æ“ä½œåœ¨ Redis ä¸­å°±æ˜¯åŸå­æ“ä½œã€‚</p><p>ä¾‹å­: ç”¨æˆ· A å‘èµ·ç‚¹èµè¯·æ±‚, Redis æ‰§è¡Œ <code>INCR</code> å‘½ä»¤, å°†ç‚¹èµæ•°ä» 10 å¢åŠ åˆ° 11ã€‚
ç”¨æˆ· B å‡ ä¹åŒæ—¶å‘èµ·ç‚¹èµè¯·æ±‚, Redis æ‰§è¡Œ <code>INCR</code> å‘½ä»¤, å°†ç‚¹èµæ•°ä» 11 å¢åŠ åˆ° 12ã€‚</p><p>å› æ­¤, è‹¥å¤šä¸ªæ“ä½œåªæ˜¯å•çº¯çš„å¯¹æ•°æ®è¿›è¡Œå¢åŠ æˆ–å‡å°‘å€¼, Redis æä¾›çš„<code>INCR</code>å’Œ<code>DECR</code>å‘½ä»¤å¯ä»¥ç›´æ¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œ<code>å¹¶å‘æ§åˆ¶</code>ã€‚</p><p>ä½†æ˜¯, è‹¥å¤šä¸ªæ“ä½œä¸åªæ˜¯å•çº¯çš„è¿›è¡Œæ•°æ®å¢å‡å€¼, è¿˜åŒ…æ‹¬æ›´å¤æ‚çš„æ“ä½œ, å¦‚: é€»è¾‘åˆ¤æ–­, æ­¤æ—¶ Redis çš„å•å‘½ä»¤æ“ä½œæ— æ³•ä¿è¯å¤šä¸ªæ“ä½œäº’æ–¥æ‰§è¡Œ, æ•…å¯ç”¨ <code>Lua è„šæœ¬</code>æ¥è§£å†³æ­¤é—®é¢˜ã€‚<a href=https://cloud.tencent.com/developer/article/1844723/>https://cloud.tencent.com/developer/article/1844723/</a></p><h3 id=è·¯ç”±éƒ¨åˆ†æœ€åé…ç½®>è·¯ç”±éƒ¨åˆ†æœ€åé…ç½®<a hidden class=anchor aria-hidden=true href=#è·¯ç”±éƒ¨åˆ†æœ€åé…ç½®>#</a></h3><p><code>router.go</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>api</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/articles/:id/likes&#34;</span><span class=p>,</span> <span class=nx>controllers</span><span class=p>.</span><span class=nx>LikeArticle</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>api</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/articles/:id/likes&#34;</span><span class=p>,</span> <span class=nx>controllers</span><span class=p>.</span><span class=nx>GetArticleLikes</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>æµ‹è¯•ç”¨: <code>GET</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>http://localhost:3000/api/articles/1/likes
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹åˆ°, æ­£ç¡®åœ°å¾—åˆ°äº† likes ä¸º 0 çš„å“åº”å†…å®¹ã€‚</p><h2 id=ä¼˜åŒ–---redisç¼“å­˜>ä¼˜åŒ– - Redisç¼“å­˜<a hidden class=anchor aria-hidden=true href=#ä¼˜åŒ–---redisç¼“å­˜>#</a></h2><ul><li>ä¸ºä½•è¦æœ‰ç¼“å­˜æŠ€æœ¯?</li></ul><p>å‡è½»æ•°æ®åº“è®¿é—®å‹åŠ›, åŠ å¿«è¯·æ±‚å“åº”é€Ÿåº¦ã€‚</p><p>ç¼“å­˜è¯»å–é€Ÿåº¦æ¯”ä»æ•°æ®åº“ä¸­è¯»å–å¿«å¾—å¤šã€‚äº¦å¯å¤§å¹…å‡å°‘æ•°æ®åº“æŸ¥è¯¢çš„æ¬¡æ•°, æé«˜åº”ç”¨ç¨‹åºçš„å“åº”é€Ÿåº¦ã€‚</p><ul><li>æ¡ˆä¾‹:</li></ul><p>æ–‡ç« é¢„è§ˆé¡µé¢, è‹¥æœ‰éå¸¸å¤šçš„æ–‡ç« å†…å®¹(å‡ åƒæ¡å†…å®¹), ä¸”æ­¤é¡¹ç›®ç”¨æˆ·é‡è¾ƒå¤§
è‹¥æ— ç¼“å­˜, æ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€è¦ç›´æ¥è®¿é—®æ•°æ®åº“,</p><p>å¯èƒ½å¸¦æ¥çš„é£é™©: åº”ç”¨ç¨‹åºå“åº”å˜æ…¢, æ•°æ®åº“å®¹æ˜“è¢«å¤§é‡æŸ¥è¯¢æ‹–æ…¢, å½±å“æ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</p><h3 id=å¸¸è§çš„ç¼“å­˜è®¾è®¡æ¨¡å¼>å¸¸è§çš„ç¼“å­˜è®¾è®¡æ¨¡å¼<a hidden class=anchor aria-hidden=true href=#å¸¸è§çš„ç¼“å­˜è®¾è®¡æ¨¡å¼>#</a></h3><ol><li><strong>æ—è·¯ç¼“å­˜æ¨¡å¼</strong>(<strong>Cache-Aside æ¨¡å¼</strong>):</li></ol><p>åº”ç”¨ç¨‹åºç›´æ¥ä¸ç¼“å­˜å’Œæ•°æ®åº“äº¤äº’, å¹¶è´Ÿè´£ç®¡ç†ç¼“å­˜çš„å†…å®¹ã€‚ä½¿ç”¨è¯¥æ¨¡å¼çš„åº”ç”¨ç¨‹åº, ä¼šåŒæ—¶æ“ä½œç¼“å­˜ä¸æ•°æ®åº“</p><p>å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li><p>å…ˆå°è¯•ä»ç¼“å­˜ä¸­è¯»å–æ•°æ®ã€‚è‹¥ç¼“å­˜å‘½ä¸­, ç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„æ•°æ®,</p></li><li><p>è‹¥ç¼“å­˜æœªå‘½ä¸­, åˆ™ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®, å¹¶å°†æ•°æ®å­˜å…¥ç¼“å­˜ä¸­, ç„¶åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p></li></ul><p>ä»£ç é€»è¾‘:</p><ol><li><strong>ç¼“å­˜æœªå‘½ä¸­</strong>ï¼š</li></ol><ul><li>å¦‚æœ Redis ä¸­æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç¼“å­˜(ç¼“å­˜æœªå‘½ä¸­), ä»£ç ä¼šä»æ•°æ®åº“ä¸­è·å–æ–‡ç« æ•°æ®ã€‚</li><li>è·å–åˆ°æ•°æ®å, ä»£ç å°†æ•°æ®åºåˆ—åŒ–ä¸º JSON, å¹¶å°†å…¶å­˜å‚¨åœ¨ Redis ç¼“å­˜ä¸­, åŒæ—¶è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚</li><li>æœ€å, è¿”å›æ•°æ®åº“ä¸­çš„æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚</li></ul><ol start=2><li><strong>ç¼“å­˜å‘½ä¸­</strong>ï¼š</li></ol><ul><li>å¦‚æœç¼“å­˜å‘½ä¸­ (Redis ä¸­æ‰¾åˆ°äº†å¯¹åº”çš„ç¼“å­˜æ•°æ®), ä»£ç ç›´æ¥ä»ç¼“å­˜ä¸­è·å–æ•°æ®ã€‚</li><li>ç„¶å, å°†ç¼“å­˜ä¸­çš„æ•°æ®<strong>ååºåˆ—åŒ–</strong>ä¸ºæ–‡ç« åˆ—è¡¨, è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ul><p>(åœ¨è¯»å–æ•°æ®æ—¶, åªæœ‰åœ¨ç¼“å­˜æœªå‘½ä¸­çš„æƒ…å†µä¸‹, æ‰ä¼šæŸ¥è¯¢æ•°æ®åº“å¹¶å°†ç»“æœå†™å…¥ç¼“å­˜ã€‚)</p><p>æ­¤å¤–, è¿˜æœ‰å¦‚<strong>è¯»å†™ç©¿é€æ¨¡å¼</strong>ç­‰ç­‰æ¨¡å¼ã€‚</p><hr><p>è§£å†³ä¸‹ä¸€ä¸ªé—®é¢˜ï¼š</p><p>è‹¥åœ¨ç¼“å­˜æœ‰æ•ˆæœŸå†…, ç”¨æˆ·åˆæ–°å¢äº†ä¸€äº›æ–‡ç« , æ­¤æ—¶ç”¨æˆ·é€šè¿‡ç¼“å­˜å¾—åˆ°æ–‡ç« , å°†çœ‹ä¸åˆ°å˜åŒ–ã€‚</p><p>è§£å†³æ–¹æ³•æ¡ˆä¾‹:</p><h3 id=å¸¸è§çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥>å¸¸è§çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥<a hidden class=anchor aria-hidden=true href=#å¸¸è§çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥>#</a></h3><ol><li><p>è®¾ç½®è¿‡æœŸæ—¶é—´ (æˆ‘ä»¬å·²ç»åšè¿‡äº†)</p></li><li><p>ä¸»åŠ¨æ›´æ–°ç¼“å­˜ (å¦‚ä½•ä¿è¯æ•°æ®åº“å’Œç¼“å­˜çš„æ•°æ®ä¸€è‡´æ€§)</p><blockquote><p>å¦‚: å½“æ–°å¢æ–‡ç« æ—¶, é™¤äº†æ›´æ–°æ•°æ®åº“, è¿˜è¦åŒæ­¥æ›´æ–°æˆ–åˆ é™¤ç¼“å­˜ä¸­çš„å¯¹åº”æ•°æ®ã€‚è¿™æ ·, ä¸‹ä¸€æ¬¡è¯»å–æ—¶, ç¼“å­˜ä¸­çš„æ•°æ®å°±æ˜¯æœ€æ–°çš„ã€‚</p><p>æˆ–è€…æ–°å¢æ–‡ç« æ—¶, ä¸ç›´æ¥æ›´æ–°ç¼“å­˜, è€Œæ˜¯åˆ é™¤ç¼“å­˜ä¸­çš„æ—§æ•°æ®ã€‚ä¸‹æ¬¡è¯»å–æ—¶, ç”±äºç¼“å­˜æ²¡æœ‰å‘½ä¸­, ä»æ•°æ®åº“ä¸­è¯»å–æœ€æ–°æ•°æ®å¹¶é‡æ–°å†™å…¥ç¼“å­˜ã€‚</p></blockquote></li></ol><p>Redis <code>DEL</code>å‘½ä»¤: ç”¨äºåˆ é™¤å·²å­˜åœ¨çš„é”®ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// ä¸»åŠ¨æ›´æ–°ç¼“å­˜ åˆ é™¤å°±ç¼“å­˜
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>global</span><span class=p>.</span><span class=nx>RedisDB</span><span class=p>.</span><span class=nf>Del</span><span class=p>(</span><span class=nx>cacheKey</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ctx</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;error&#34;</span><span class=p>:</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>()})</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=cors-è·¨åŸŸ>CORS è·¨åŸŸ<a hidden class=anchor aria-hidden=true href=#cors-è·¨åŸŸ>#</a></h2><p>CORS (Cross-Origin Resource Sharing), å…¨ç§°ä¸º"è·¨åŸŸ (è·¨æº) èµ„æºå…±äº«, æ˜¯ä¸€ç§æœºåˆ¶, ä½¿ç”¨é¢å¤–çš„ HTTP å¤´æ¥å‘Šè¯‰æµè§ˆå™¨å…è®¸ä¸€ä¸ªç½‘é¡µä»å¦ä¸€ä¸ªåŸŸ (ä¸åŒäºè¯¥ç½‘é¡µæ‰€åœ¨çš„åŸŸ) è¯·æ±‚èµ„æºã€‚è¿™æ ·å¯ä»¥åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´è¿›è¡Œå®‰å…¨çš„è·¨åŸŸé€šä¿¡ã€‚</p><p>æµè§ˆå™¨å°† CORS è¯·æ±‚åˆ†æˆä¸¤ç±»:</p><ul><li>ç®€å•è¯·æ±‚ (simple req)</li></ul><p>æ–¹æ³•å¦‚<code>GET</code>, <code>POST</code></p><p>å¤´éƒ¨å­—æ®µå¦‚: <code>Accept</code>, <code>Accept-Language</code>, <code>Content-Language</code>, <code>Content-Type</code>(éœ€è¦æ³¨æ„é¢å¤–çš„é™åˆ¶)ç­‰</p><p>åœ¨ Postman ä¸­æ£€æŸ¥ <code>content-type</code> åŠ <code>content-length</code></p><ul><li>éç®€å•è¯·æ±‚ (not-so-simple req)</li></ul><p>æ–¹æ³•å¦‚<code>PUT</code></p><p>åœ¨æ­£å¼é€šä¿¡ä¹‹å‰, å¢åŠ ä¸€æ¬¡<code>HTTP</code>æŸ¥è¯¢è¯·æ±‚, ç§°ä¸º<code>é¢„æ£€ (Preflight)</code>è¯·æ±‚ã€‚
è¯¥è¯·æ±‚æ˜¯<code>Option</code>æ–¹æ³•çš„, é€šè¿‡è¯¥è¯·æ±‚æ¥çŸ¥é“æœåŠ¡ç«¯æ˜¯å¦å…è®¸è·¨åŸŸè¯·æ±‚ã€‚</p><p>å¯¹äºç®€å•è¯·æ±‚, æµè§ˆå™¨ç›´æ¥å‘å‡º CORS è¯·æ±‚ã€‚</p><h3 id=cors-ç›¸å…³çš„é—®é¢˜>CORS ç›¸å…³çš„é—®é¢˜<a hidden class=anchor aria-hidden=true href=#cors-ç›¸å…³çš„é—®é¢˜>#</a></h3><p>åŸŸæ˜¯ä»€ä¹ˆ?</p><ul><li>Origin, å¯è¯‘ä¸ºæº, äº¦å¯è¯‘ä¸ºåŸŸ, åœ¨ CORS ä¸Šä¸‹æ–‡ä¸­ Origin ç”±ä¸‰ä¸ªå…ƒç´ ç»„æˆï¼š</li><li>Origin å³ä¸º <code>åè®®(å¦‚https)</code> + <code>åŸŸå(å¦‚www.example.com)</code> + <code>ç«¯å£(å¦‚80)</code></li></ul><p>åŒæºç­–ç•¥(Same-Origin Policy, SOP)</p><ul><li>æµè§ˆå™¨çš„ä¸€ç§å®‰å…¨æœºåˆ¶, ç”¨äºé˜²æ­¢æ¶æ„ç½‘ç«™é€šè¿‡è„šæœ¬å¯¹å…¶ä»–ç½‘ç«™çš„å†…å®¹è¿›è¡Œè®¿é—®ã€‚</li></ul><p>ä»¥ä¸‹ URL å±äºåŒæºåœ°å€ï¼š</p><ul><li><p>å¦‚: <code>example.com:443</code> å’Œ <code>example.com:443/articles</code></p></li><li><p>ä½†<code>inkkaplumé¢‘é“Bç«™.example.com/articles</code> å’Œ <code>example.com/articles</code>åˆ™ä¸æ˜¯ã€‚</p></li><li><p>è‡ªç„¶, <code>example.com:80</code>å’Œ<code>example.com:443</code>åˆ™ä¸æ˜¯</p></li></ul><p>è·¨åŸŸè¯·æ±‚</p><ul><li><p>æŒ‡ä»ä¸€ä¸ªåŸŸå‘å¦ä¸€ä¸ªåŸŸå‘èµ·çš„ HTTP è¯·æ±‚ã€‚(æ¯”å¦‚ä»80ç«¯å£å‘é€åˆ°443ç«¯å£çš„è¯·æ±‚)</p></li><li><p>å¦‚ä»å‰ç«¯åº”ç”¨å‘ä¸åŒçš„åç«¯ API æœåŠ¡å™¨è¯·æ±‚æ•°æ®, ä½†æ˜¯åŒæºç­–ç•¥é»˜è®¤ä¼šé˜»æ­¢è¿™äº›è¯·æ±‚ã€‚</p></li></ul><p><strong>æ‰€ä»¥éœ€è¦ CORS æœºåˆ¶æ¥æ˜¾å¼å…è®¸è·¨åŸŸè®¿é—®ã€‚</strong></p><p>æœ¬æ¡ˆä¾‹çš„ URL:</p><p>(å‰ç«¯)<a href=http://localhost:5173>http://localhost:5173</a> å’Œ(åç«¯)<a href=http://localhost:3000>http://localhost:3000</a></p><p>æµè§ˆå™¨é»˜è®¤å…è®¸åŒæºè¯·æ±‚, ä½†æ˜¯é»˜è®¤ä¼šé˜»æ­¢è¿™äº›è·¨åŸŸè¯·æ±‚, é™¤éæœåŠ¡å™¨æ˜ç¡®å…è®¸ã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜, éœ€åœ¨åç«¯åº”ç”¨ä¸­é…ç½® CORS, å…è®¸å‰ç«¯åº”ç”¨<a href=http://localhost:5173>http://localhost:5173</a>è®¿é—®åç«¯ APIã€‚</p><h4 id=å®‰è£…-cors-ä¸­é—´ä»¶>å®‰è£… CORS ä¸­é—´ä»¶<a hidden class=anchor aria-hidden=true href=#å®‰è£…-cors-ä¸­é—´ä»¶>#</a></h4><p>ä½¿ç”¨ <code>Gin CORS middleware</code>, å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨ Gin ä¸­é…ç½® CORSã€‚</p><p>å®˜æ–¹æ¡ˆä¾‹: <a href=https://github.com/gin-contrib/cors>https://github.com/gin-contrib/cors</a></p><p>å‘½ä»¤</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go get github.com/gin-contrib/cors
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=s>&#34;github.com/gin-contrib/cors&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>router</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>Default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=c1>// CORS for https://foo.com and https://github.com origins, allowing:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// - PUT and PATCH methods
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// - Origin header
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// - Credentials share
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// - Preflight requests cached for 12 hours
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>router</span><span class=p>.</span><span class=nf>Use</span><span class=p>(</span><span class=nx>cors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>cors</span><span class=p>.</span><span class=nx>Config</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>AllowOrigins</span><span class=p>:</span>     <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;https://....com&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>AllowMethods</span><span class=p>:</span>     <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;PUT&#34;</span><span class=p>,</span> <span class=s>&#34;PATCH&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>AllowHeaders</span><span class=p>:</span>     <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;Origin&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>ExposeHeaders</span><span class=p>:</span>    <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;Content-Length&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>AllowCredentials</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>AllowOriginFunc</span><span class=p>:</span> <span class=kd>func</span><span class=p>(</span><span class=nx>origin</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>origin</span> <span class=o>==</span> <span class=s>&#34;https://github.com&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>MaxAge</span><span class=p>:</span> <span class=mi>12</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Hour</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}))</span>
</span></span><span class=line><span class=cl>  <span class=nx>router</span><span class=p>.</span><span class=nf>Run</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=ä¼˜é›…åœ°é€€å‡ºåº”ç”¨>ä¼˜é›…åœ°é€€å‡ºåº”ç”¨<a hidden class=anchor aria-hidden=true href=#ä¼˜é›…åœ°é€€å‡ºåº”ç”¨>#</a></h2><p>æˆ‘ä»¬ç›®å‰å¯ä»¥çœ‹åˆ°</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>exit</span> status 0xc000013a
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘ä»¬éœ€è¦è¿›è¡Œå¤„ç†ã€‚</p><p>å‚è€ƒæ­¤æ–‡æ¡£:</p><p><a href=https://gin-gonic.com/zh-cn/docs/examples/graceful-restart-or-stop/>https://gin-gonic.com/zh-cn/docs/examples/graceful-restart-or-stop/</a></p><h3 id=go-channel>Go Channel<a hidden class=anchor aria-hidden=true href=#go-channel>#</a></h3><p>Go è¯­è¨€çš„å¹¶å‘æ¨¡å‹æ˜¯ CSP (Communicating Sequential Processes/è¯‘ä¸ºé€šä¿¡é¡ºåºè¿›ç¨‹), æå€¡ <strong>é€šè¿‡é€šä¿¡å…±äº«å†…å­˜</strong> è€Œéé€šè¿‡å…±äº«å†…å­˜è€Œå®ç°é€šä¿¡ã€‚ä¹Ÿå°±æ˜¯goroutineé—´çš„é€šä¿¡æœºåˆ¶ã€‚</p><p>Channel ç±»å‹: é€šé“åœ¨ Go ä¸­æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»å‹ã€‚</p><p>é€šé“åƒä¸€ä¸ªé˜Ÿåˆ—(Queue), æ€»æ˜¯éµå¾ªå…ˆå…¥å…ˆå‡º(FIFO)çš„è§„åˆ™ä»¥ä¿è¯æ”¶å‘æ•°æ®çš„é¡ºåºã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>channelExample</span> <span class=kd>chan</span> <span class=kt>int</span>   <span class=c1>// å£°æ˜ä¸€ä¸ªä¼ é€’æ•´å‹çš„é€šé“
</span></span></span></code></pre></td></tr></table></div></div><p>åˆ¤æ–­:</p><p><code>chan T</code> åŒå‘chanç±»å‹çš„T</p><p><code>chan&lt;- T</code> å•å‘å†™å…¥chanç±»å‹çš„Tï¼ˆåªå†™ï¼‰</p><p><code>&lt;-chan T</code>å•å‘æ¥æ”¶chanç±»å‹çš„Tï¼ˆåªè¯»ï¼‰</p><p>é€šé“æ˜¯å¼•ç”¨ç±»å‹, æ•…ç©ºå€¼ä¸º<code>nil</code>ã€‚</p><p>æ¡ˆä¾‹:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>channelExample</span> <span class=kd>chan</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>channelExample</span><span class=p>)</span> <span class=c1>//è¾“å‡º&lt;nil&gt;
</span></span></span></code></pre></td></tr></table></div></div><p>å£°æ˜çš„ Channel, éœ€ç”¨ make func åˆå§‹åŒ–ä¹‹åæ‰èƒ½ä½¿ç”¨ã€‚æ ¼å¼å¦‚ä¸‹:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>    <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=nx>å…ƒç´ ç±»å‹</span><span class=p>,</span> <span class=p>[</span><span class=nx>ç¼“å†²</span><span class=p>(</span><span class=nx>Buffer</span><span class=p>)</span><span class=nx>å¤§å°</span><span class=p>(</span><span class=nx>å¯é€‰</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ä¾‹å­:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>channelExample01</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=p>[]</span><span class=kt>int</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>æ“ä½œ: æœ‰å‘é€(Send)ã€æ¥æ”¶(Receive)å’Œå…³é—­(Close)ä¸‰ç§æ“ä½œã€‚</li></ul><p>å‘é€çš„æ¡ˆä¾‹:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>channelExample</span> <span class=kd>chan</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=nx>channelExample</span> <span class=o>&lt;-</span> <span class=mi>114</span>  <span class=c1>// ä¼šæ­»é”
</span></span></span></code></pre></td></tr></table></div></div><p>æ¥æ”¶çš„æ¡ˆä¾‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>example</span> <span class=o>:=</span> <span class=o>&lt;-</span> <span class=nx>channelExample</span>
</span></span><span class=line><span class=cl><span class=o>&lt;-</span><span class=nx>channelExample</span>
</span></span></code></pre></td></tr></table></div></div><p>å…³é—­çš„æ¡ˆä¾‹</p><p>é€šè¿‡è°ƒç”¨å†…ç½®çš„ <code>close</code> func æ¥å…³é—­ channelã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nb>close</span><span class=p>(</span><span class=nx>channelExample</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>å…³é—­åçš„é€šé“æœ‰å¦‚ä¸‹ç‰¹ç‚¹:</p><ul><li>å†å‘é€å€¼å°±ä¼šå¯¼è‡´ panicã€‚</li><li>å¯¹å…¶è¿›è¡Œæ¥æ”¶ä¼šä¸€ç›´è·å–å€¼ç›´åˆ°é€šé“ä¸ºç©ºã€‚</li><li>å¯¹ä¸€ä¸ªå…³é—­çš„å¹¶ä¸”æ²¡æœ‰å€¼çš„é€šé“æ‰§è¡Œæ¥æ”¶æ“ä½œä¼šå¾—åˆ°å¯¹åº”ç±»å‹çš„é›¶å€¼ã€‚</li><li>å…³é—­ä¸€ä¸ªå·²ç»å…³é—­çš„é€šé“ä¼šå¯¼è‡´ panicã€‚</li></ul><p>åˆ¤æ–­ channel æ˜¯å¦å…³é—­</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>v</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>channel</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=æ­»é”deadlock>æ­»é”(Deadlock)<a hidden class=anchor aria-hidden=true href=#æ­»é”deadlock>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>fatal error: all goroutines are asleep - deadlock!
</span></span></code></pre></td></tr></table></div></div><p>ç¬¬ä¸€ç§æƒ…å½¢</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>channel</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>  <span class=c1>// ç¼“å†²åŒºå¤§å°ä¸º0
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nx>channel</span> <span class=o>&lt;-</span> <span class=mi>114</span>
</span></span><span class=line><span class=cl>    <span class=nx>x</span> <span class=o>:=</span> <span class=o>&lt;-</span> <span class=nx>channel</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è§£å†³æ–¹æ³•, ç¼“å†²å¤§å°æ”¹å˜, å¦‚<code>channel := make(chan int, 1)</code></p><p>ä½†æ˜¯:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>   <span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=nx>channel</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>       <span class=nx>channel</span> <span class=o>&lt;-</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>       <span class=nx>channel</span> <span class=o>&lt;-</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>       <span class=nx>x</span><span class=o>:=</span> <span class=o>&lt;-</span> <span class=nx>channel</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>x</span><span class=p>)</span>  <span class=c1>// deadlock
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>æˆ–è€…,</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>channel</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>go</span> <span class=kd>func</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nx>channel</span> <span class=o>&lt;-</span> <span class=mi>114</span>
</span></span><span class=line><span class=cl>    <span class=p>}()</span>
</span></span><span class=line><span class=cl>    <span class=nx>x</span> <span class=o>:=</span> <span class=o>&lt;-</span> <span class=nx>channel</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>x</span><span class=p>)</span>  <span class=c1>// 114
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç¬¬äºŒç§æƒ…å½¢</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>channel</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>x</span> <span class=o>:=</span> <span class=o>&lt;-</span> <span class=nx>channel</span>
</span></span><span class=line><span class=cl>    <span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>channel</span> <span class=o>&lt;-</span><span class=mi>114</span>
</span></span><span class=line><span class=cl>    <span class=p>}()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>x</span><span class=p>)</span>  <span class=c1>// deadlock
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç¬¬ä¸‰ç§æƒ…å½¢</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>channel01</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>channel02</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>select</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=o>&lt;-</span> <span class=nx>channel01</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>channel02</span><span class=o>&lt;-</span><span class=mi>114</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>select</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=o>&lt;-</span> <span class=nx>channel02</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>channel01</span> <span class=o>&lt;-</span> <span class=mi>114</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// chan1 chan2éƒ½åœ¨ç­‰ä»å¯¹æ–¹è¯»å‡ºä¸œè¥¿
</span></span></span><span class=line><span class=cl><span class=c1>//ç»“è®º: fatal error: all goroutines are asleep - deadlock!
</span></span></span></code></pre></td></tr></table></div></div><p><code>Select</code>è¯´æ˜:
select æ˜¯ Go ä¸­çš„ä¸€ä¸ªæ§åˆ¶ç»“æ„ã€‚</p><h4 id=å®˜æ–¹æ–‡æ¡£å…³é—­æ¡ˆä¾‹>å®˜æ–¹æ–‡æ¡£å…³é—­æ¡ˆä¾‹<a hidden class=anchor aria-hidden=true href=#å®˜æ–¹æ–‡æ¡£å…³é—­æ¡ˆä¾‹>#</a></h4><p><a href=https://gin-gonic.com/zh-cn/docs/examples/graceful-restart-or-stop/>https://gin-gonic.com/zh-cn/docs/examples/graceful-restart-or-stop/</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// +build go1.8
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl> <span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl> <span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl> <span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl> <span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl> <span class=s>&#34;os/signal&#34;</span>
</span></span><span class=line><span class=cl> <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=nx>router</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>Default</span><span class=p>()</span>
</span></span><span class=line><span class=cl> <span class=nx>router</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>5</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl> <span class=nx>c</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=s>&#34;Welcome Gin Server&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=nx>srv</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>http</span><span class=p>.</span><span class=nx>Server</span><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=nx>Addr</span><span class=p>:</span>    <span class=s>&#34;:8080&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=nx>Handler</span><span class=p>:</span> <span class=nx>router</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>srv</span><span class=p>.</span><span class=nf>ListenAndServe</span><span class=p>();</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=o>&amp;&amp;</span> <span class=nx>err</span> <span class=o>!=</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ErrServerClosed</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;listen: %s\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>quit</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=nx>os</span><span class=p>.</span><span class=nx>Signal</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>signal</span><span class=p>.</span><span class=nf>Notify</span><span class=p>(</span><span class=nx>quit</span><span class=p>,</span> <span class=nx>os</span><span class=p>.</span><span class=nx>Interrupt</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&lt;-</span><span class=nx>quit</span>
</span></span><span class=line><span class=cl><span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Shutdown Server ...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>ctx</span><span class=p>,</span> <span class=nx>cancel</span> <span class=o>:=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>WithTimeout</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span> <span class=mi>5</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nf>cancel</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>srv</span><span class=p>.</span><span class=nf>Shutdown</span><span class=p>(</span><span class=nx>ctx</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=s>&#34;Server Shutdown:&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Server exiting&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åå³å¯çœ‹åˆ°æ”¹å˜:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>2024/08/30 23:34:22 Shutdown Server...
</span></span><span class=line><span class=cl>2024/08/30 23:34:22 Server exiting
</span></span></code></pre></td></tr></table></div></div><h3 id=syncwaitgroup>sync.WaitGroup<a hidden class=anchor aria-hidden=true href=#syncwaitgroup>#</a></h3><p><code>WaitGroup</code>æ˜¯<code>sync</code> package ä¸­çš„ä¸€ä¸ª<code>struct</code>, ç”¨æ¥æ”¶é›†éœ€è¦ç­‰å¾…æ‰§è¡Œå®Œæˆçš„<code>goroutine</code>ã€‚</p><p>ä¸‰ä¸ªæ–¹æ³•:</p><p><code>Add()</code>: ç”¨æ¥è®¾ç½®æˆ–æ·»åŠ è¦ç­‰å¾…å®Œæˆçš„ goroutine æ•°é‡
ä¾‹å­:</p><p><code>Add(2)</code>æˆ–ä¸¤æ¬¡è°ƒç”¨<code>Add(1)</code>éƒ½ä¼šè®¾ç½®ç­‰å¾…è®¡æ•°å™¨çš„å€¼ä¸º 2, å³ä¸ºè¦ç­‰å¾… 2 ä¸ª goroutine å®Œæˆã€‚</p><p>è‡ªç„¶, <code>Done()</code>åˆ™è¡¨ç¤ºéœ€è¦ç­‰å¾…çš„ goroutine åœ¨çœŸæ­£å®Œæˆä¹‹å‰, åº”è°ƒç”¨è¯¥æ–¹æ³•æ¥äººä¸ºè¡¨ç¤º goroutine å®Œæˆäº†, é‡è¦åœ°æ˜¯: è¯¥æ–¹æ³•ä¼šå¯¹ç­‰å¾…è®¡æ•°å™¨å‡ 1ã€‚</p><p>æœ€å, <code>Wait()</code>åˆ™æ„å‘³ç€åœ¨ç­‰å¾…è®¡æ•°å™¨å‡ä¸º 0 ä¹‹å‰, <code>Wait()</code>ä¼šä¸€ç›´é˜»å¡å½“å‰çš„ goroutine</p><p>æ¡ˆä¾‹ä»£ç :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestTaskControdl</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>taskNum</span> <span class=o>:=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>    <span class=nx>wg</span> <span class=o>:=</span> <span class=nx>sync</span><span class=p>.</span><span class=nx>WaitGroup</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>wg</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=nx>taskNum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>taskNum</span><span class=p>;</span> <span class=nx>i</span> <span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>go</span> <span class=kd>func</span><span class=p>(</span><span class=nx>i</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>defer</span> <span class=nx>wg</span><span class=p>.</span><span class=nf>Done</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;info&#34;</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}(</span><span class=nx>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>wg</span><span class=p>.</span><span class=nf>Wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç»“è®ºï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>info <span class=m>4</span>
</span></span><span class=line><span class=cl>info <span class=m>3</span>
</span></span><span class=line><span class=cl>info <span class=m>1</span>
</span></span><span class=line><span class=cl>info <span class=m>0</span>
</span></span><span class=line><span class=cl>info <span class=m>2</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=closeæ¡ˆä¾‹>Closeæ¡ˆä¾‹<a hidden class=anchor aria-hidden=true href=#closeæ¡ˆä¾‹>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Test</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl> <span class=nx>test</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>go</span> <span class=kd>func</span><span class=p>(</span><span class=nx>info</span> <span class=kd>chan</span> <span class=kt>int</span><span class=p>){</span>
</span></span><span class=line><span class=cl> <span class=k>for</span><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>select</span><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>case</span> <span class=nx>val</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=o>&lt;-</span> <span class=nx>test</span><span class=p>:</span>
</span></span><span class=line><span class=cl> <span class=k>if</span> <span class=p>!</span><span class=nx>ok</span><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=nx>t</span><span class=p>.</span><span class=nf>Logf</span><span class=p>(</span><span class=s>&#34;Channel Closed!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl> <span class=k>return</span>
</span></span><span class=line><span class=cl> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=nx>t</span><span class=p>.</span><span class=nf>Logf</span><span class=p>(</span><span class=s>&#34;data %d\n&#34;</span><span class=p>,</span> <span class=nx>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}(</span><span class=nx>test</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>go</span> <span class=kd>func</span><span class=p>(){</span>
</span></span><span class=line><span class=cl> <span class=nx>test</span> <span class=o>&lt;-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl> <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>1</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl> <span class=nx>test</span> <span class=o>&lt;-</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=nb>close</span><span class=p>(</span><span class=nx>test</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>5</span> <span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><p>è¾“å‡º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>data <span class=m>1</span>
</span></span><span class=line><span class=cl>data <span class=m>2</span>
</span></span><span class=line><span class=cl>Context Closed!
</span></span></code></pre></td></tr></table></div></div><h4 id=å•ç‹¬é€€å‡ºé€šé“>å•ç‹¬é€€å‡ºé€šé“<a hidden class=anchor aria-hidden=true href=#å•ç‹¬é€€å‡ºé€šé“>#</a></h4><p>ä¼ è¾“æ•°æ®ä¸å…±ç”¨ä¸€ä¸ª channel</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>   <span class=kd>func</span> <span class=nf>TestA</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>test</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>exit</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kd>struct</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>go</span> <span class=kd>func</span><span class=p>(</span><span class=nx>info</span> <span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>exit</span> <span class=kd>chan</span> <span class=kd>struct</span><span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>select</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nx>val</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>info</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nx>t</span><span class=p>.</span><span class=nf>Logf</span><span class=p>(</span><span class=s>&#34;data %d\n&#34;</span><span class=p>,</span> <span class=nx>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=o>&lt;-</span><span class=nx>exit</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nx>t</span><span class=p>.</span><span class=nf>Logf</span><span class=p>(</span><span class=s>&#34;Task Exit!!\n&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}(</span><span class=nx>test</span><span class=p>,</span> <span class=nx>exit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>test</span> <span class=o>&lt;-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>1</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>test</span> <span class=o>&lt;-</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        <span class=nb>close</span><span class=p>(</span><span class=nx>exit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}()</span>
</span></span><span class=line><span class=cl><span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>5</span> <span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=è¶…æ—¶ä»»åŠ¡æ§åˆ¶>è¶…æ—¶ä»»åŠ¡æ§åˆ¶<a hidden class=anchor aria-hidden=true href=#è¶…æ—¶ä»»åŠ¡æ§åˆ¶>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Test</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>){</span>
</span></span><span class=line><span class=cl> <span class=nx>test</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=kd>func</span><span class=p>(</span><span class=nx>info</span> <span class=kd>chan</span> <span class=kt>int</span><span class=p>){</span>
</span></span><span class=line><span class=cl> <span class=k>for</span><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>select</span><span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>case</span> <span class=nx>val</span> <span class=o>:=</span> <span class=o>&lt;-</span> <span class=nx>info</span><span class=p>:</span>
</span></span><span class=line><span class=cl> <span class=nx>t</span><span class=p>.</span><span class=nf>Logf</span><span class=p>(</span><span class=s>&#34;Data %d\n&#34;</span><span class=p>,</span> <span class=nx>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>case</span> <span class=o>&lt;-</span> <span class=nx>time</span><span class=p>.</span><span class=nf>After</span><span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>):</span>
</span></span><span class=line><span class=cl> <span class=nx>t</span><span class=p>.</span><span class=nf>Logf</span><span class=p>(</span><span class=s>&#34;Time out!\n&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl> <span class=k>return</span>
</span></span><span class=line><span class=cl> <span class=p>}</span>
</span></span><span class=line><span class=cl> <span class=p>}</span>
</span></span><span class=line><span class=cl> <span class=p>}(</span><span class=nx>test</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=k>go</span> <span class=kd>func</span><span class=p>(){</span>
</span></span><span class=line><span class=cl> <span class=nx>test</span> <span class=o>&lt;-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl> <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span> <span class=c1>//&gt;=2
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=nx>test</span> <span class=o>&lt;-</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl> <span class=p>}()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>5</span> <span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç»“è®º:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>main_test.go:98: Data <span class=m>1</span>
</span></span><span class=line><span class=cl>main_test.go:101: Time out!
</span></span></code></pre></td></tr></table></div></div><h4 id=context-çš„åœºæ™¯>Context çš„åœºæ™¯<a hidden class=anchor aria-hidden=true href=#context-çš„åœºæ™¯>#</a></h4></div><footer class=post-footer><ul class=post-tags><li><a href=https://erica423.github.io/tags/%E6%8A%80%E6%9C%AF/>æŠ€æœ¯</a></li></ul><nav class=paginav><a class=prev href=https://erica423.github.io/posts/first/><span class=title>Â« Prev</span><br><span>ã€å®Œã€‘ä½¿ç”¨Github Actionså®ç°Hugoé™æ€åšå®¢è‡ªåŠ¨éƒ¨ç½²</span>
</a><a class=next href=https://erica423.github.io/posts/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3map/><span class=title>Next Â»</span><br><span>æ·±å…¥ç†è§£Go sync.Map</span></a></nav></footer><div id=waline></div><script>Waline.init({el:"#waline",dark:"body.dark",serverURL:"https://waline.vercel.app"})</script></article></main><footer class=footer><span>&copy; 2024 <a href=https://erica423.github.io/>Erica-Blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><div class=busuanzi-footer><span id=busuanzi_container_site_pv>æœ¬ç«™æ€»è®¿é—®é‡<span id=busuanzi_value_site_pv></span>æ¬¡
</span><span id=busuanzi_container_site_uv>æœ¬ç«™è®¿å®¢æ•°<span id=busuanzi_value_site_uv></span>äººæ¬¡</span></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>