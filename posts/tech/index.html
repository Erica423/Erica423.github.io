<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Tech | Go八股总结 | Erica-Blog</title>
<meta name=keywords content="Technique"><meta name=description content="常见golang面经技术要点笔记"><meta name=author content="erica423"><link rel=canonical href=https://canonical.url/to/page><link crossorigin=anonymous href=/assets/css/stylesheet.765a84d67992a2542387ba60a51d1ca92b3fe2e3791d5ca120ea783131514435.css integrity rel="preload stylesheet" as=style><link rel=icon href=https://erica423.github.io/static/images/dls_icon.png><link rel=icon type=image/png sizes=16x16 href=https://erica423.github.io/static/images/dls_icon.png><link rel=icon type=image/png sizes=32x32 href=https://erica423.github.io/static/images/dls_icon.png><link rel=apple-touch-icon href=https://erica423.github.io/static/images/dls_icon.png><link rel=mask-icon href=https://erica423.github.io/static/images/dls_icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://erica423.github.io/posts/tech/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>(function(){""&&prompt("请输入文章密码")!==""&&(alert("密码错误！"),history.back())})()</script><meta property="og:title" content="Tech | Go八股总结"><meta property="og:description" content="常见golang面经技术要点笔记"><meta property="og:type" content="article"><meta property="og:url" content="https://erica423.github.io/posts/tech/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-26T14:25:21+08:00"><meta property="article:modified_time" content="2024-05-26T14:25:21+08:00"><meta property="og:site_name" content="erica-blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tech | Go八股总结"><meta name=twitter:description content="常见golang面经技术要点笔记"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://erica423.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Tech | Go八股总结","item":"https://erica423.github.io/posts/tech/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Tech | Go八股总结","name":"Tech | Go八股总结","description":"常见golang面经技术要点笔记","keywords":["Technique"],"articleBody":" db项目 一个db的实例理解成os上的文件夹，除了一些配置，关注的是数据文件，最主要的是当前的活跃文件，only用来w操作，追加到文件尾部。\n写入的数据称作entry，结构：\n一个数据文件看成好多entry的集合\n冗余数据处理：reclaim方法，重新整理（新建tmp文件夹，遍历db，依次取出entry判断有效否，写入有效的，将tmp copy为新的，最后将原来的文件delete）\nwhy string类型存入跳表？ 为了支持字符串的前缀扫描和范围扫描，不需要的话就换成哈希表即可。 Disk磁盘写操作一定是顺序写入，类似LSM树，提升w性能。常见数据索引模型还有b+树。 外层操作接口：\ndb_str.go (略有不同) db_list.go db_hash.go db_set.go db_zset.go go语言slice和map底层实现原理 slice和map都是引用类型，长度不固定。\nslice底层： slice指向一个底层array，声明时不需要指定长度。\nappend函数会改变slice所引用的数组的内容，从而影响到引用同一数组的其它slice。 但当slice中没有剩余空间（即(cap-len) == 0时，此时将动态分配新的数组空间。返回的slice数组指针将指向这个空间，而原数组的内容将保持不变；其它引用此数组的slice则不受影响。\nmap底层： map的读取和设置也类似slice一样，通过key来操作，只是slice的index只能是int类型，而map多了很多类型，可以是int，可以是string及所有完全定义了==与!=操作的类型。\nmap是无序的，如何map进行有序的排序？ 开一个空切片，把key拿出来，对key进行排序，再按排好序的key中map中拿value。\nslice的扩容机制 在使用 append 向 slice 追加元素时，若 slice 空间不足则会发生扩容，扩容会重新分配一块更大的内存，将原 slice 拷贝到新 slice ，然后返回新 slice。扩容后再将数据追加进去。\n扩容操作只对容量，扩容后的 slice 长度不变，容量变化规则如下：\n1.18版本之前：若 slice 容量小于1024个元素，那么扩容的时候slice的cap就翻番，乘以2；一旦元素个数超过1024个元素，增长因子就变成1.25，即每次增加原来容量的四分之一。 若 slice 容量够用，则将新元素追加进去，slice.len++，返回原 slice 若 slice 容量不够用，将 slice 先扩容，扩容得到新 slice，将新元素追加进新 slice，slice.len++，返回新 slice。 例如：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 func main() { s1 := make([]int64, 0) for i := 0; i \u003c 1025; i++ { s1 = append(s1, 1) } fmt.Printf(\"len = %d, cap = %d\\n\", len(s1), cap(s1)) // output: len = 1025, cap = 1280 s2 := make([]int32, 0) for i := 0; i \u003c 1025; i++ { s2 = append(s2, 1) } fmt.Printf(\"len = %d, cap = %d\\n\", len(s2), cap(s2)) // output: len = 1025, cap = 1344 } 原因是golang库下runtime/slice.go中的growslice函数的逻辑。核心是后半的内存对齐。switch的几个case分支，就是针对不同类型的slice。以et.size == sys.PtrSize分支为例，其思想就是首先计算出slice的内存大小，然后调用roundupsize函数内存对齐，然后计算出最终的容量。\nroundupsize函数：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 var size_to_class8 = [1024/8 + 1]uint8{0, 1, 2, 3, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, 14, 14, 15, 15, 16, 16, 17, 17, 18, 18, 19, 19, 19, 19, 20, 20, 20, 20, 21, 21, 21, 21, 22, 22, 22, 22, 23, 23, 23, 23, 24, 24, 24, 24, 25, 25, 25, 25, 26, 26, 26, 26, 27, 27, 27, 27, 27, 27, 27, 27, 28, 28, 28, 28, 28, 28, 28, 28, 29, 29, 29, 29, 29, 29, 29, 29, 30, 30, 30, 30, 30, 30, 30, 30, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32} var class_to_size = [68]uint16{0, 8, 16, 24, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240, 256, 288, 320, 352, 384, 416, 448, 480, 512, 576, 640, 704, 768, 896, 1024, 1152, 1280, 1408, 1536, 1792, 2048, 2304, 2688, 3072, 3200, 3456, 4096, 4864, 5376, 6144, 6528, 6784, 6912, 8192, 9472, 9728, 10240, 10880, 12288, 13568, 14336, 16384, 18432, 19072, 20480, 21760, 24576, 27264, 28672, 32768} var size_to_class128 = [(_MaxSmallSize-smallSizeMax)/largeSizeDiv + 1]uint8{32, 33, 34, 35, 36, 37, 37, 38, 38, 39, 39, 40, 40, 40, 41, 41, 41, 42, 43, 43, 44, 44, 44, 44, 44, 45, 45, 45, 45, 45, 45, 46, 46, 46, 46, 47, 47, 47, 47, 47, 47, 48, 48, 48, 49, 49, 50, 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 53, 53, 54, 54, 54, 54, 55, 55, 55, 55, 55, 56, 56, 56, 56, 56, 56, 56, 56, 56, 56, 56, 57, 57, 57, 57, 57, 57, 57, 57, 57, 57, 58, 58, 58, 58, 58, 58, 59, 59, 59, 59, 59, 59, 59, 59, 59, 59, 59, 59, 59, 59, 59, 59, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 61, 61, 61, 61, 61, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 62, 63, 63, 63, 63, 63, 63, 63, 63, 63, 63, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67} func roundupsize(size uintptr) uintptr { if size \u003c _MaxSmallSize { // 32K内存以内 // class_to_size 68个不同的内存长度（包含0），对应runtime/sizeclasses.go中表格 // 当小于等于1016时，从size_to_class8中找，结果时1到32，对应class_to_size中的index // 否则从size_to_class128中找，结果是32到68。 最终都是根据index到class_to_size中最终的结果。 // 其作用就是67个内存长度中找到大于等于size的最接近的长度。 应该是为了效率考虑，直接查的方式，比挨个比较的效率更高。空间换时间 if size \u003c= smallSizeMax-8 { return uintptr(class_to_size[size_to_class8[divRoundUp(size, smallSizeDiv)]]) } else { fmt.Println(divRoundUp(size-smallSizeMax, largeSizeDiv)) return uintptr(class_to_size[size_to_class128[divRoundUp(size-smallSizeMax, largeSizeDiv)]]) } } if size+_PageSize \u003c size { // 这种情况只会发生在溢出时，变成负数了 return size } return alignUp(size, _PageSize) } // 按8192的倍数向上取整，采用位运算的方式，更加高效 func alignUp(n, a uintptr) uintptr { return (n + a - 1) \u0026^ (a - 1) } 到这里就可以解释int32的切片扩容后为什么是1344了:\n正常情况下，按照1.25被扩容后，容量为1024 * 1.25 = 1280; int32占4字节，其切片内存大小为，1280 * 4 = 5120; 通过查下面的表，可以得出大于等于5120的最接近的是5376; 最终的容量为 5376 / 4 = 1344 同样，也可以算出int64的切片内存对齐后，和原来是没有变化，仍然是1280。简单计算下：\n1280 * 8 = 10240; 查表仍然是10240 10240 / 8 = 1280。所以没有变化。 go 1.18版本后的修改 小于256时，双倍扩容；大于等于256时，扩容后容量 = 1.25倍的原容量 + 192。目的主要为了是内存的变化更加平滑。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 func growslice(et *_type, old slice, cap int) slice { // 省略。。。 newcap := old.cap doublecap := newcap + newcap if cap \u003e doublecap { newcap = cap } else { const threshold = 256 if old.cap \u003c threshold { newcap = doublecap } else { // Check 0 \u003c newcap to detect overflow // and prevent an infinite loop. for 0 \u003c newcap \u0026\u0026 newcap \u003c cap { // Transition from growing 2x for small slices // to growing 1.25x for large slices. This formula // gives a smooth-ish transition between the two. newcap += (newcap + 3*threshold) / 4 } // Set newcap to the requested cap when // the newcap calculation overflowed. if newcap \u003c= 0 { newcap = cap } } } // 省略。。。 } 补充： int 类型大小为 8 字节, go语言中的int的大小是和操作系统位数相关的，如果是32位操作系统，int类型的大小就是4字节; 如果是64位操作系统，int类型的大小就是8个字节\nint8 类型大小为 1 字节\nint16 类型大小为 2 字节\nint32 类型大小为 4 字节\nint64 类型大小为 8 字节\n取值范围\nint8: -128 ~ 127\nint16: -32768 ~ 32767\nint32: -2147483648 ~ 2147483647\nint64: -9223372036854775808 ~ 9223372036854775807\n结构体里的变量不加tag可以转json字符串吗？ 如果变量首字母小写，即为private变量，无论加不加tag都不可能转为json字段，因为获取不到反射信息。 反射？\n如果变量首字母大写，为public变量： 不加tag：可以转，json内字段名和结构体内字段原名一致； 加tag，转json的字段名就是tag里的字段名（也就是别名）。 生成json：jsonInfo, err := json.Marshal(struct_J)\n展示json内容：string(jsonInfo)\njson对象只支持string作为key。channel、complex、function不能被编码成json。\ngo语言TCP、UDP具体实现原理 TCP (Transmission Connect Protocol, 传输控制协议) 面向连接的、可靠的、基于字节流的传输层通信协议。提供了全双工通信、流量控制、错误控制等功能。\nTCP基本原理： 三次握手：通过三次握手建立TCP连接。 (1) client向server发送SYN包，请求连接；\n(2) server收到SYN包，向client发送SYN+ACK包，同意连接并确认client的SYN包；\n(3) client收到SYN+ACK包后，向server发送ACK包，确认连接。\n四次挥手：通过四次挥手断开TCP连接。 (1) client向server发送FIN包，表示不再发送数据；\n(2) server收到FIN包，向client发送ACK包，确认收到FIN包；\n(3) server向client发送FIN包，表示不再接收数据；\n(4) client收到FIN包后，向server发送ACK包，确认断连。\n流量控制：TCP使用滑动窗口机制进行流量控制。 server向client发送数据时，需要考虑client的接收能力，避免数据溢出。\n错误控制：TCP使用ACK和NACK机制进行错误控制。 当client收到server发送的数据时，需要发送ACK包确认。如果收到的数据有错，就发送NACK包。\nUDP (User Datagram Protocol, 用户数据报协议) 面向事务的、无连接、不可靠的传输层通信协议。 提供了简单快速的数据传输功能。\nUDP基本原理： 无连接：UDP不需要建立连接，数据包直接发送到目的地址。 不可靠：不提供可靠性保证，数据包可能丢失、错误或重复。 简单快速：UDP数据包的head只有8 byte，相对于TCP的20byte head更加简单快速。 Go语言的网络编程主要涉及以下几个核心概念： net包：Go语言提供了net包，用于实现网络编程。net包提供了TCP/UDP的基本功能，包括创建、监听、连接、读写等\nconn：conn是net包中的一个类型，表示一个网络连接。conn包含了连接的两端的地址和数据缓冲区。\nio包：Go语言的io包提供了一系列的读写器接口，用于实现各种数据流操作。网络编程中，我们经常使用io包的Reader和Writer接口来处理网络数据。\nbufio包：bufio包提供了基于缓冲的I/O功能，可以提高网络编程的性能。我们可以使用bufio包的Reader和Writer来实现高效的网络数据处理。\nTCP：使用 net.Dial/ net.Listen / conn.Write / conn.Read 等 UDP：使用 net.Dial / net.Listen / conn.Write / conn.ReadFrom / conn.SetReadDeadline 问：net.Listen和net.ListenTCPandnet.ListenUDP有啥区别？？\nnet.Listen()返回一个接口net.Listener，该接口只保证它支持以下方法：Accept()、Close()和Addr()。\nnet.ListenTCP()返回一个支持上述三种方法的类型*net.TCPListener，因此(鸭子类型duckTyping)它支持net.Listener接口。但是，它还支持更多特定于TCP的功能，并且可以控制连接接受的低级别方面。像设置SetDeadline()之类的事情。\n使用场景 Web服务：使用net/http包构建Web服务，提供RESTful API接口。 聊天室：使用TCP协议实现客户端和服务器之间的实时通信。 文件传输：使用UDP协议实现高速文件传输，例如P2P文件共享。 游戏服务器：使用TCP协议实现在线游戏服务器，处理玩家之间的实时通信和数据同步。 TCP和UDP的客户端实现 一致，只有net.Dial()的第一个参数不同。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 // Connect TCP conn, err := net.Dial(\"tcp\", \"host:port\") if err != nil { return err } defer conn.Close() //simple Read buffer := make([]byte, 1024) conn.Read(buffer) //simple write conn.Write([]byte(\"Hello from client\")) // Connect udp conn, err := net.Dial(\"udp\", \"host:port\") if err != nil { return err } defer conn.Close() //simple Read buffer := make([]byte, 1024) conn.Read(buffer) //simple write conn.Write([]byte(\"Hello from client\")) TCP和UDP的服务端实现： 不同，在实现TCP时要用Listener接口监听和建立TCP连接\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // TCP l, err := net.Listen(\"tcp\", \"host:port\") if err != nil { return err } defer l.Close() for { conn, err := l.Accept() if err != nil { return err } go handleConnection(conn) } func handleConnection(conn net.Conn) { // ... buffer := make([]byte, 1024) conn.Read(buffer) conn.Write([]byte(\"Hello from server\")) } 实现UDP时用PacketConn接口取代了Conn接口和Listener。\n与类型Conn不同的是，PackerConn并不支持io.reader和io.writer接口，但是它支持两个特殊的读写方法ReadFrom() 和 WriteTo() 。WriteTo()方法需要提供一个参数作为发送的数据到哪个地址，ReadFrom()则返回数据是从哪个地址接收的。 1 2 3 4 5 6 7 8 9 10 // UDP pc, err := net.ListenPacket(\"udp\", \"host:port\") if err != nil { log.Fatal(err) } buffer := make([]byte, 1024) pc.ReadFrom(buffer) pc.WriteTo([]byte(\"Hello from client\"), addr) go协程调度原理，协程为什么快？ goroutine的理解： goroutine，协程，是一种轻量级的用户线程（可以避免用户态到内核态的切换，从而节省了资源开销），由Go运行时调度器进行管理。Go中的每一个协程都会被分配到一个较小的栈空间（默认大小2KB），以非常低的成本进行创建和销毁。\ngoroutine的运行： Go运行时调度器采用了 M:N 的模型，即在M个操作系统线程上运行N个协程。具体来说，Go运行时初始化了一个或多个GOMAXPROCS指定数量的操作系统线程，并在这些线程上运行协程。\n​当一个协程阻塞时，调度器会自动将其与当前协程解除绑定，并将其转移到等待队列中，然后运行其它的协程，从而实现了高效地利用了CPU的时间片。\ngoroutine的优势： 协程不像传统多线程编程那样必须避免线程竞争和加锁解锁等操作。\n在Go中通常通过channel实现协程之间的同步和通信。Go的channel机制提供了一种非常有效且安全的协程同步方式，可以避免竞争条件和死锁等问题。\n同时，协程可以自我调节、自我管理，从而可以避免了频繁的线程切换带来的性能损耗。这使得协程有非常快的相应速度和高效的并发处理能力。\n扩展：\n并发(concurrency) vs 并行(parallelism) 在单个CPU 核上，线程通过时间片或者让出控制权来实现任务切换，达到 “同时” 运行多个任务的目的，这就是所谓的并发。但实际上任何时刻都只有一个任务被执行，其他任务通过某种算法来排队。\n只用多核CPU可以让同一进程内的\"多个线程\" 做到真正意义上的同时运行。\n进程 vs 线程 vs 协程 进程：系统进行资源分配的基本单位，占有独立的内存空间。\n线程：CPU调度和分配的基本单位，依附于进程存在，每个线程共享父进程的资源。\n线程的上下文切换？\n由于中断处理，多任务处理，用户态切换等原因会导致 CPU 从一个线程切换到另一个线程，切换过程需要保存当前进程的状态并恢复另一个进程的状态。代价是高昂的。\n协程：用户态的轻量级线程，调度完全由用户控制，协程间切换只需要保存任务的上下文，没有内核的开销。\nGoroutine 上下文切换只涉及到三个寄存器（PC / SP / DX）的值修改；而对比线程的上下文切换则需要涉及模式切换（从用户态切换到内核态）、以及 16 个寄存器、PC、SP…等寄存器的刷新；\n线程栈空间通常是 2M，Goroutine 栈空间最小 2K；\nGolang 程序中可以轻松支持10w 级别的 Goroutine 运行，而线程数量达到 1k 时，内存占用就已经达到 2G。\nGo调度器是啥？ Go调度器模型通常叫做GPM模型，Go程序通过调度器来调度goroutine在内核线程上执行，但是goroutine（G）不直接绑定os线程（M）运行，而是由 goroutine scheduler 中的逻辑处理器（P）来作为获取内核线程资源的“中介”。\n包括4个重要结构，分别是G、P、M、Sched：(G砖头 M地鼠 P小车)\nG: Goroutine，协程，运行在线程上；每个 Goroutine 对应一个 G 结构体，G 存储 Goroutine 的运行堆栈、状态以及任务函数，可重用。G 并非执行体，每个 G 需要绑定到 P 才能被调度执行。\nM: Machine，thread，即线程，循环调取协程并执行；OS 内核线程抽象，代表着真正执行计算的资源。在绑定有效的 P 后，进入 schedule 循环；而 schedule 循环的机制大致是从 Global 队列、P 的 Local 队列以及 wait 队列中获取。\nM 的数量是不定的，由 Go Runtime 调整，为了防止创建过多 OS 线程导致系统调度不过来，目前默认最大限制为 10000 个。\nM 并不保留 G 状态，这是 G 可以跨 M 调度的基础。\nP: Processor，处理器；对 G 来说，P 相当于 CPU 核，G 只有绑定到 P 才能被调度。对 M 来说，P 提供了相关的执行环境(Context)，如内存分配状态(mcache)，任务队列(G)等。P 的数量决定了系统内最大可并行的 G 的数量（前提：物理 CPU 核数 \u003e= P 的数量）。\nP 的数量由用户设置的 GoMAXPROCS 决定，但是不论 GoMAXPROCS 设置为多大，P 的数量最大为 256。\nSched: Go 调度器，它维护有存储 M 和 G 的队列以及调度器的一些状态信息等。调度器循环的机制大致是从各种队列、P 的本地队列中获取 G，切换到 G 的执行栈上并执行 G 的函数，调用 Goexit 做清理工作并回到 M，如此反复。\n具体讲解地址\ngo实现基本的排序和查找算法 详细内容\n（1）基本排序算法 基于Big-O(n^2)的排序\n选择排序：选数组中最小的元素和第一个元素交换；再选剩下元素中最小的和第二个元素交换，… 空间O(1)，不稳定 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 func selectSort(arr []int) { for i := 0; i \u003c len(arr); i ++ { minIndex := i for j := i + 1; j \u003c len(arr); j ++ { if arr[minIndex] \u003e arr[j] { minIndex = j; } } swap(arr, i, minIndex) } } func swap(arr []int, i, j int) { temp := arr[i] arr[i] = arr[j] arr[j] = temp } 冒泡排序: 从第一个元素开始，每次比较相邻元素，按顺序交换，否则继续往后比较下一对，… 空间O(1)，稳定 1 2 3 4 5 6 7 8 9 10 func bubbleSort(arr []int) { for e := len(arr) - 1; e \u003e 0; e -- { for i := 0; i \u003c e; i ++ { // 升序 if arr[i] \u003e arr[i + 1] { swap(arr, i, i + 1) } } } } 插入排序：冒泡的每一次冒，都要把无序序列轮一遍；插入排序恰恰相反，一旦你遇到比自己大或小的了，你就知道，后面都是比自己大或小的，现在坐下，当前元素就进入了有序序列。插入的每一次插，都不一定要轮一遍有序序列。 1 2 3 4 5 6 7 8 9 10 11 func insertSort(arr []int) { // 未排序区间 for i := 1; i \u003c len(arr); i ++ { // 已排序区间 for j := i - 1; j \u003e= 0; j -- { if arr[j] \u003e arr[j + 1] { swap(arr, j, j + 1) } } } } 基于Big-O(nlogn)的排序\n快排：分治思想，空间O(logn), 不稳定 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 import ( \"fmt\" \"math/rand\" \"time\" ) func quickSort(arr []int, L int, R int) { if(L \u003c R){ lF, rF := float32(L), float32(R) rand.Seed(time.Now().UnixNano()) randomIndex := int(lF + rand.Float32() * (rF - lF + 1))//数组中随机获取下标 swap(arr, randomIndex, R) var p []int = partition(arr, L, R) //partition操作返回p[0]和p[1] quickSort(arr, L, p[0] - 1) //p[0]-1为随机下标对应的值的左边 quickSort(arr, p[1] + 1, R) //p[1]+1为随机下标对应的值的右边 } } func partition(arr []int, L int, R int) []int { less, more := L - 1, R //less区域为小于随机下标对应的值，more区域为大于随机下标对应的值 for L \u003c more { if arr[L] \u003c arr[R] { less++ swap(arr, less, L) L++ } else if arr[L] \u003e arr[R]{ more-- swap(arr, more, L) } else { L++ } } swap(arr, more, R) return []int {less + 1, more} } 归并排：空间复杂度O(n)，稳定 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 func mergeSort(arr []int, L int, Mid int, R int) { if len(arr) \u003c 2 { return } help := make([]int, 0, R - L + 1) p1, p2 := L, Mid + 1 for p1 \u003c= Mid \u0026\u0026 p2 \u003c= R { if arr[p1] \u003c= arr[p2] { help = append(help, arr[p1]) p1++ } else { help = append(help, arr[p2]) p2++ } } for p1 \u003c= Mid { help = append(help, arr[p1]) p1++ } for p2 \u003c= R { help = append(help, arr[p2]) p2++ } for i := 0; i \u003c len(help); i++ { arr[L + i] = help[i] } } 堆排（优先队列）： heapInsert(arr []int, index int) 建立大根堆，(index * 2) + 1为该节点左孩子，(index * 2) + 2 为该节点右孩子，(index - 1) / 2 为该节点的父节点。若该节点大于父节点，就交换，并且index = (index - 1) / 2。\nheapify(arr []int, index int, heapSize int), 找到最后一个节点lastNode，该节点与当前根节点交换，同时heap–，即最后位置上为最大值，根节点为极小值。此时从根结点出发，继续heapify的过程(左孩子右孩子较大者与根节点交换, lastNode节点 来到孩子节点较大者位置，继续左右孩子较大者比较，直至没有左右孩子)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 func heapInsert(arr []int, index int){ for arr[index] \u003e arr[(index - 1) / 2] { swap(arr, index, (index - 1) / 2) index = (index - 1) / 2 } } //index * 2 + 1 左孩子节点 //index * 2 + 2 右孩子节点 //(index - 1) / 2 父节点 func heapify(arr []int, index int, heapSize int){ var largestIndex int leftNode := index * 2 + 1 for leftNode \u003c heapSize { if leftNode + 1 \u003c heapSize \u0026\u0026 arr[leftNode + 1] \u003e arr[leftNode] { largestIndex = leftNode + 1 } else { largestIndex = leftNode } if arr[largestIndex] \u003c arr[index] { largestIndex = index } if largestIndex == index { break } swap(arr, largestIndex, index) index = largestIndex leftNode = index * 2 + 1 } } （2）基本查找算法 博文link\n七大查找算法： 顺序查找、二分查找、差值查找、斐波那契查找、 树表查找 (二叉树查找、平衡查找树之2-3查找树、平衡查找树之红黑树、B树和B+树)、分块查找、哈希查找、图查找 (广度优先查找、深度优先查找)\n分类： 静态查找 vs 动态查找\n有序查找 vs 无序查找\nmysql索引分为几种？ 按数据结构：B+tree索引、Hash索引、Full-text索引。\n按物理存储：聚簇索引、二级索引（辅助索引或者非主键索引）。\nMySQL索引按叶子节点存储的是否为完整表数据分为：聚簇索引、二级索引（辅助索引）。全表数据存储在聚簇索引中，聚簇索引以外的其他索引叫做二级索引，也叫辅助索引。\n按字段特性：主键索引、普通索引、前缀索引。\n按字段个数：单列索引、联合索引（复合索引、组合索引）。\nRedis vs MySQL 区别： 数据类型 mysql是关系型数据库，主要用于存放持久化数据，将数据存储在硬盘中，读取速度较慢。\nredis是NOSQL，即非关系型数据库，也是缓存数据库，即将数据存储在缓存中，缓存的读取速度快，能够大大的提高运行效率，但是保存时间有限。\n本质区别 Redis：基于内存，读写速度快，也可做持久化，但是内存空间有限，当数据量超过内存空间时，需扩充内存，而内存成本较高；\nMySQL：基于磁盘，读写速度没有Redis快，但是不受空间容量限制，性价比高；\nredis优缺点 优点 速度快：Redis 数据存储在内存中，读写速度非常快，适用于需要高速数据处理的场景。\n数据结构丰富：Redis 支持多种数据结构，如字符串、哈希、列表、集合、有序集合等，可以满足不同类型的数据存储需求。\n支持分布式：Redis 可以通过主从复制和哨兵机制实现分布式部署，提高系统的可靠性和可用性。\n轻量级：Redis 相对其他数据库来说比较轻量级，占用资源少，启动速度快。\n可扩展性：Redis 可以通过插件或扩展机制实现更多的功能，如 Redis Modules。\n支持事务：Redis 提供了简单的事务机制，保证了数据的一致性。\n缺点 内存限制：由于数据存储在内存中，Redis 的内存容量有限，无法处理大量的数据\n数据持久性：Redis 默认情况下是将数据存储在内存中的，如果没有正确配置持久化机制，数据在服务器重启或故障时可能会丢失。\n复杂性：虽然 Redis 相对简单，但在分布式环境下的管理和配置可能会变得复杂。\n不支持复杂查询：Redis 主要用于简单的数据操作，对于复杂的查询和分析功能较弱。\n使用场景 缓存：Redis 最常见的用途之一是作为缓存服务器，将频繁访问的数据存储在内存中，以加速数据访问速度。由于 Redis 具有快速的读写速度和丰富的数据结构，适用于各种缓存场景，如网页缓存、会话缓存、对象缓存等。\n会话存储：Redis 可以用作会话存储，将用户会话数据存储在内存中，以提供快速的会话访问和管理。这对于需要跨多个服务器共享会话数据的 Web 应用程序非常有用。\n消息队列：Redis 支持发布/订阅模式（Pub/Sub），可以用作轻量级的消息队列系统，实现消息的发布和订阅，用于异步任务处理、事件通知等场景。\n计数器：Redis 的原子操作能力使其成为实现计数器功能的理想选择。它可以用于统计网站访问量、用户点击量、商品销量等。\n分布式锁：Redis 的分布式锁功能可以用于实现分布式系统中的互斥操作，确保共享资源的安全访问。这对于控制并发访问、避免资源竞争非常有用。\n实时数据分析：Redis 支持持久化和数据备份，可以用于实时数据分析和监控系统，存储实时数据，并支持数据的快速查询和分析。\n任务队列：Redis 可以用作任务队列，用于存储和管理需要异步处理的任务，如后台任务、定时任务等。\n地理位置服务：Redis 的地理位置数据类型（Geo）可以用于存储地理位置信息，并支持基于位置的搜索和查询，用于实现位置服务和地理信息系统。\nmysql优缺点 优点 开源和免费：MySQL 是开源软件，可以免费使用，降低了企业的成本负担。\n跨平台性：MySQL 可以在多种操作系统上运行，包括 Windows、Linux、Mac 等，具有良好的跨平台性。\n易于使用：MySQL 的安装和配置相对简单，具有良好的用户文档和社区支持，使得用户可以快速上手并进行数据库管理和查询。\n高性能：MySQL 具有较高的性能，能够处理大量的并发请求，提供高效的数据存取和查询能力。\n可扩展性：MySQL 支持主从复制、分区表、分布式数据库等功能，可以方便地进行系统扩展和负载均衡。\n缺点 性能瓶颈：在处理大规模数据和高并发请求时，MySQL 可能会遇到性能瓶颈，需要进行优化和调整以满足需求。\n单点故障：MySQL 在单机部署时存在单点故障的风险，需要采取合适的容错和备份策略来保证系统的可靠性和稳定性。\n复杂的管理：虽然 MySQL 相对易于使用，但在大规模部署和管理时，需要花费一定的时间和精力来进行数据库的管理和维护。\n存储引擎限制：MySQL 的存储引擎数量有限，不同的存储引擎具有不同的特性和性能，选择合适的存储引擎需要根据具体需求进行评估。\n事务支持有限：在某些场景下，MySQL 的事务支持可能有限，不适合要求严格事务一致性的应用场景。\n使用场景 Web 应用程序：MySQL 是许多 Web 应用程序的首选数据库，包括电子商务网站、博客、社交网络、论坛等。它能够处理大量的并发请求，并提供良好的性能和可靠性。\n日志和监控系统：MySQL 可以用于存储日志和监控数据，用于分析系统的运行状态和性能指标，帮助管理员监控和管理系统的运行情况。\n企业应用程序：许多企业级应用程序使用 MySQL 作为其关键的数据存储和管理工具。这些应用程序可能涉及客户关系管理（CRM）、企业资源规划（ERP）、人力资源管理（HRM）等各种业务功能。\n数据仓库和报告系统：MySQL 可以作为数据仓库和报告系统的后端存储，用于存储和管理大量的历史数据，并支持复杂的查询和报告生成。\nes具体的使用方法好在哪里？ Elasticsearch是一个开源的分布式全文搜索引擎，它构建在Apache Lucene库之上。它专注于提供快速、弹性和可靠的全文搜索、结构化搜索、分析和可视化功能。\n详细介绍\n分布式架构： Elasticsearch被设计为在多台服务器上运行，并自动管理数据的分片和复制。这使得它能够处理大规模的数据，并提供高可用性和容错性。\n全文搜索： Elasticsearch使用倒排索引技术，可以高效地进行全文搜索。它支持各种查询类型，包括匹配、模糊搜索、范围搜索等。\n实时数据： Elasticsearch对数据的更改几乎是实时的，通常在毫秒级别内就可以被索引并可查询。这使得它非常适合需要及时反馈的应用场景，如日志分析、监控数据处理等。\n多语言支持： Elasticsearch提供了广泛的语言客户端，使得开发人员可以使用自己熟悉的语言与之交互，如Java、Python、Node.js等。\n弹性扩展： Elasticsearch支持水平扩展，可以通过添加更多的节点来增加存储容量和负载能力。它还提供了自动分片和负载均衡机制，使得数据在集群中的分布更加均匀。\n多种数据类型支持： 除了文本数据，Elasticsearch也可以处理结构化数据和地理位置数据。它支持各种数据类型的索引和查询，包括字符串、数字、日期、布尔值、数组等。\n易于使用的API： Elasticsearch提供了RESTful风格的API，可以使用HTTP协议与之进行交互。这使得开发人员可以轻松地索引、查询、修改和删除数据。\n数据聚合与分析： Elasticsearch提供了丰富的聚合功能，可以对数据进行统计、分组、筛选和排序等操作。同时，它还集成了Kibana工具，用于可视化和分析数据。\nHTTP状态码 1XX - 提示信息 2XX - success 3XX - 重定向 4XX - 客户端错误，请求有语法错误or请求无法实现 400 - bad request 错误请求 服务器不理解请求的语法 401 - unauthorized 未授权 请求要求身份验证 402 - 为了将来可能的需求而预留的 403 - forbidden 禁止 服务器拒绝请求 404 - not found 未找到 服务器找不到请求的网页 5XX - 服务端错误，服务器未能实现合法的请求 你在开发过程中遇到了什么困难 以及怎么解决的 ","wordCount":"11024","inLanguage":"en","datePublished":"2024-05-26T14:25:21+08:00","dateModified":"2024-05-26T14:25:21+08:00","author":{"@type":"Person","name":"erica423"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://erica423.github.io/posts/tech/"},"publisher":{"@type":"Organization","name":"Erica-Blog","logo":{"@type":"ImageObject","url":"https://erica423.github.io/static/images/dls_icon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://erica423.github.io/ accesskey=h title="首页 (Alt + H)"><img src=https://erica423.github.io/static/images/dls_icon.png alt aria-label=logo height=35>首页</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://erica423.github.io/archives/ title=🎮动态><span>🎮动态</span></a></li><li><a href=https://erica423.github.io/tags/ title=🎲标签><span>🎲标签</span></a></li><li><a href=https://erica423.github.io/search/ title="🎯搜索 (Alt + /)" accesskey=/><span>🎯搜索</span></a></li><li><a href=https://github.com/Erica423/Erica423.github.io/ title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://erica423.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://erica423.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Tech | Go八股总结</h1><div class=post-description>常见golang面经技术要点笔记</div><div class=post-meta><span title='2024-05-26 14:25:21 +0800 +0800'>May 26, 2024</span>&nbsp;·&nbsp;erica423&nbsp;|&nbsp;<a href=https://github.com/Erica423/Erica423.github.io//posts/Tech.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#db项目>db项目</a></li><li><a href=#go语言slice和map底层实现原理>go语言slice和map底层实现原理</a></li><li><a href=#slice的扩容机制>slice的扩容机制</a></li><li><a href=#结构体里的变量不加tag可以转json字符串吗>结构体里的变量不加tag可以转json字符串吗？</a></li><li><a href=#go语言tcpudp具体实现原理>go语言TCP、UDP具体实现原理</a><ul><li><a href=#tcp-transmission-connect-protocol-传输控制协议>TCP (Transmission Connect Protocol, 传输控制协议)</a></li><li><a href=#udp-user-datagram-protocol-用户数据报协议>UDP (User Datagram Protocol, 用户数据报协议)</a></li><li><a href=#tcp和udp的客户端实现>TCP和UDP的客户端实现</a></li><li><a href=#tcp和udp的服务端实现>TCP和UDP的服务端实现：</a></li></ul></li><li><a href=#go协程调度原理协程为什么快>go协程调度原理，协程为什么快？</a></li><li><a href=#go实现基本的排序和查找算法>go实现基本的排序和查找算法</a><ul><li><a href=#1基本排序算法>（1）基本排序算法</a></li><li><a href=#2基本查找算法>（2）基本查找算法</a></li></ul></li><li><a href=#mysql索引分为几种>mysql索引分为几种？</a></li><li><a href=#redis-vs-mysql>Redis vs MySQL</a></li><li><a href=#es具体的使用方法好在哪里>es具体的使用方法好在哪里？</a></li><li><a href=#http状态码>HTTP状态码</a></li><li><a href=#你在开发过程中遇到了什么困难-以及怎么解决的>你在开发过程中遇到了什么困难 以及怎么解决的</a></li></ul></nav></div></details></div><div class=post-content><hr><h2 id=db项目>db项目<a hidden class=anchor aria-hidden=true href=#db项目>#</a></h2><p>一个db的实例理解成os上的文件夹，除了一些配置，关注的是数据文件，最主要的是当前的活跃文件，only用来w操作，追加到文件尾部。</p><p>写入的数据称作entry，结构：</p><p>一个数据文件看成好多entry的集合</p><p>冗余数据处理：reclaim方法，重新整理（新建tmp文件夹，遍历db，依次取出entry判断有效否，写入有效的，将tmp copy为新的，最后将原来的文件delete）</p><p><img loading=lazy src=/images/%e6%95%b0%e6%8d%ae%e5%86%99%e5%85%a5%e6%b5%81%e7%a8%8b.png alt=db数据读入流程></p><ul><li>why string类型存入<strong>跳表</strong>？ 为了支持字符串的<strong>前缀扫描</strong>和<strong>范围扫描</strong>，不需要的话就换成哈希表即可。</li><li>Disk磁盘写操作一定是顺序写入，类似LSM树，提升w性能。常见数据索引模型还有b+树。</li></ul><p>外层操作接口：</p><ul><li>db_str.go (略有不同)</li><li>db_list.go</li><li>db_hash.go</li><li>db_set.go</li><li>db_zset.go</li></ul><hr><h2 id=go语言slice和map底层实现原理>go语言slice和map底层实现原理<a hidden class=anchor aria-hidden=true href=#go语言slice和map底层实现原理>#</a></h2><p><code>slice</code>和<code>map</code>都是引用类型，长度不固定。</p><ul><li>slice底层：</li></ul><p><code>slice</code>指向一个底层<code>array</code>，声明时不需要指定长度。</p><p><code>append</code>函数会改变<code>slice</code>所引用的数组的内容，从而影响到引用同一数组的其它<code>slice</code>。 但当<code>slice</code>中没有剩余空间（即<code>(cap-len) == 0</code>时，此时将动态分配新的数组空间。返回的<code>slice</code>数组指针将指向这个空间，而原数组的内容将保持不变；其它引用此数组的<code>slice</code>则不受影响。</p><ul><li>map底层：</li></ul><p><code>map</code>的读取和设置也类似<code>slice</code>一样，通过<code>key</code>来操作，只是<code>slice</code>的index只能是<code>int</code>类型，而<code>map</code>多了很多类型，可以是<code>int</code>，可以是string及所有完全定义了<code>==</code>与<code>!=</code>操作的类型。</p><ul><li>map是无序的，如何map进行有序的排序？</li></ul><p>开一个空切片，把key拿出来，对key进行排序，再按排好序的key中map中拿value。</p><hr><h2 id=slice的扩容机制>slice的扩容机制<a hidden class=anchor aria-hidden=true href=#slice的扩容机制>#</a></h2><p>在使用 append 向 slice 追加元素时，若 slice 空间不足则会发生扩容，扩容会重新分配一块更大的内存，将原 slice 拷贝到新 slice ，然后返回新 slice。扩容后再将数据追加进去。</p><p>扩容操作只对容量，扩容后的 slice 长度不变，容量变化规则如下：</p><ul><li>1.18版本之前：若 slice 容量小于1024个元素，那么扩容的时候slice的cap就翻番，乘以2；一旦元素个数超过1024个元素，增长因子就变成1.25，即每次增加原来容量的四分之一。</li><li>若 slice 容量够用，则将新元素追加进去，slice.len++，返回原 slice</li><li>若 slice 容量不够用，将 slice 先扩容，扩容得到新 slice，将新元素追加进新 slice，slice.len++，返回新 slice。</li></ul><p>例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>s1</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>int64</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>1025</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>s1</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>s1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;len = %d, cap = %d\n&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>s1</span><span class=p>),</span> <span class=nb>cap</span><span class=p>(</span><span class=nx>s1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1>// output: len = 1025, cap = 1280
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=nx>s2</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>int32</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>1025</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>s2</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>s2</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;len = %d, cap = %d\n&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>s2</span><span class=p>),</span> <span class=nb>cap</span><span class=p>(</span><span class=nx>s2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1>// output: len = 1025, cap = 1344
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>原因是golang库下<code>runtime/slice.go</code>中的<code>growslice</code>函数的逻辑。核心是后半的<strong>内存对齐</strong>。switch的几个case分支，就是针对不同类型的slice。以et.size == sys.PtrSize分支为例，其思想就是首先计算出slice的内存大小，然后调用roundupsize函数内存对齐，然后计算出最终的容量。</p><p>roundupsize函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>size_to_class8</span> <span class=p>=</span> <span class=p>[</span><span class=mi>1024</span><span class=o>/</span><span class=mi>8</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span><span class=kt>uint8</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>15</span><span class=p>,</span> <span class=mi>15</span><span class=p>,</span> <span class=mi>16</span><span class=p>,</span> <span class=mi>16</span><span class=p>,</span> <span class=mi>17</span><span class=p>,</span> <span class=mi>17</span><span class=p>,</span> <span class=mi>18</span><span class=p>,</span> <span class=mi>18</span><span class=p>,</span> <span class=mi>19</span><span class=p>,</span> <span class=mi>19</span><span class=p>,</span> <span class=mi>19</span><span class=p>,</span> <span class=mi>19</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>21</span><span class=p>,</span> <span class=mi>21</span><span class=p>,</span> <span class=mi>21</span><span class=p>,</span> <span class=mi>21</span><span class=p>,</span> <span class=mi>22</span><span class=p>,</span> <span class=mi>22</span><span class=p>,</span> <span class=mi>22</span><span class=p>,</span> <span class=mi>22</span><span class=p>,</span> <span class=mi>23</span><span class=p>,</span> <span class=mi>23</span><span class=p>,</span> <span class=mi>23</span><span class=p>,</span> <span class=mi>23</span><span class=p>,</span> <span class=mi>24</span><span class=p>,</span> <span class=mi>24</span><span class=p>,</span> <span class=mi>24</span><span class=p>,</span> <span class=mi>24</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=mi>26</span><span class=p>,</span> <span class=mi>26</span><span class=p>,</span> <span class=mi>26</span><span class=p>,</span> <span class=mi>26</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>28</span><span class=p>,</span> <span class=mi>28</span><span class=p>,</span> <span class=mi>28</span><span class=p>,</span> <span class=mi>28</span><span class=p>,</span> <span class=mi>28</span><span class=p>,</span> <span class=mi>28</span><span class=p>,</span> <span class=mi>28</span><span class=p>,</span> <span class=mi>28</span><span class=p>,</span> <span class=mi>29</span><span class=p>,</span> <span class=mi>29</span><span class=p>,</span> <span class=mi>29</span><span class=p>,</span> <span class=mi>29</span><span class=p>,</span> <span class=mi>29</span><span class=p>,</span> <span class=mi>29</span><span class=p>,</span> <span class=mi>29</span><span class=p>,</span> <span class=mi>29</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>31</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>class_to_size</span> <span class=p>=</span> <span class=p>[</span><span class=mi>68</span><span class=p>]</span><span class=kt>uint16</span><span class=p>{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>16</span><span class=p>,</span> <span class=mi>24</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>48</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>80</span><span class=p>,</span> <span class=mi>96</span><span class=p>,</span> <span class=mi>112</span><span class=p>,</span> <span class=mi>128</span><span class=p>,</span> <span class=mi>144</span><span class=p>,</span> <span class=mi>160</span><span class=p>,</span> <span class=mi>176</span><span class=p>,</span> <span class=mi>192</span><span class=p>,</span> <span class=mi>208</span><span class=p>,</span> <span class=mi>224</span><span class=p>,</span> <span class=mi>240</span><span class=p>,</span> <span class=mi>256</span><span class=p>,</span> <span class=mi>288</span><span class=p>,</span> <span class=mi>320</span><span class=p>,</span> <span class=mi>352</span><span class=p>,</span> <span class=mi>384</span><span class=p>,</span> <span class=mi>416</span><span class=p>,</span> <span class=mi>448</span><span class=p>,</span> <span class=mi>480</span><span class=p>,</span> <span class=mi>512</span><span class=p>,</span> <span class=mi>576</span><span class=p>,</span> <span class=mi>640</span><span class=p>,</span> <span class=mi>704</span><span class=p>,</span> <span class=mi>768</span><span class=p>,</span> <span class=mi>896</span><span class=p>,</span> <span class=mi>1024</span><span class=p>,</span> <span class=mi>1152</span><span class=p>,</span> <span class=mi>1280</span><span class=p>,</span> <span class=mi>1408</span><span class=p>,</span> <span class=mi>1536</span><span class=p>,</span> <span class=mi>1792</span><span class=p>,</span> <span class=mi>2048</span><span class=p>,</span> <span class=mi>2304</span><span class=p>,</span> <span class=mi>2688</span><span class=p>,</span> <span class=mi>3072</span><span class=p>,</span> <span class=mi>3200</span><span class=p>,</span> <span class=mi>3456</span><span class=p>,</span> <span class=mi>4096</span><span class=p>,</span> <span class=mi>4864</span><span class=p>,</span> <span class=mi>5376</span><span class=p>,</span> <span class=mi>6144</span><span class=p>,</span> <span class=mi>6528</span><span class=p>,</span> <span class=mi>6784</span><span class=p>,</span> <span class=mi>6912</span><span class=p>,</span> <span class=mi>8192</span><span class=p>,</span> <span class=mi>9472</span><span class=p>,</span> <span class=mi>9728</span><span class=p>,</span> <span class=mi>10240</span><span class=p>,</span> <span class=mi>10880</span><span class=p>,</span> <span class=mi>12288</span><span class=p>,</span> <span class=mi>13568</span><span class=p>,</span> <span class=mi>14336</span><span class=p>,</span> <span class=mi>16384</span><span class=p>,</span> <span class=mi>18432</span><span class=p>,</span> <span class=mi>19072</span><span class=p>,</span> <span class=mi>20480</span><span class=p>,</span> <span class=mi>21760</span><span class=p>,</span> <span class=mi>24576</span><span class=p>,</span> <span class=mi>27264</span><span class=p>,</span> <span class=mi>28672</span><span class=p>,</span> <span class=mi>32768</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>size_to_class128</span> <span class=p>=</span> <span class=p>[(</span><span class=nx>_MaxSmallSize</span><span class=o>-</span><span class=nx>smallSizeMax</span><span class=p>)</span><span class=o>/</span><span class=nx>largeSizeDiv</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span><span class=kt>uint8</span><span class=p>{</span><span class=mi>32</span><span class=p>,</span> <span class=mi>33</span><span class=p>,</span> <span class=mi>34</span><span class=p>,</span> <span class=mi>35</span><span class=p>,</span> <span class=mi>36</span><span class=p>,</span> <span class=mi>37</span><span class=p>,</span> <span class=mi>37</span><span class=p>,</span> <span class=mi>38</span><span class=p>,</span> <span class=mi>38</span><span class=p>,</span> <span class=mi>39</span><span class=p>,</span> <span class=mi>39</span><span class=p>,</span> <span class=mi>40</span><span class=p>,</span> <span class=mi>40</span><span class=p>,</span> <span class=mi>40</span><span class=p>,</span> <span class=mi>41</span><span class=p>,</span> <span class=mi>41</span><span class=p>,</span> <span class=mi>41</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=mi>43</span><span class=p>,</span> <span class=mi>43</span><span class=p>,</span> <span class=mi>44</span><span class=p>,</span> <span class=mi>44</span><span class=p>,</span> <span class=mi>44</span><span class=p>,</span> <span class=mi>44</span><span class=p>,</span> <span class=mi>44</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=mi>46</span><span class=p>,</span> <span class=mi>46</span><span class=p>,</span> <span class=mi>46</span><span class=p>,</span> <span class=mi>46</span><span class=p>,</span> <span class=mi>47</span><span class=p>,</span> <span class=mi>47</span><span class=p>,</span> <span class=mi>47</span><span class=p>,</span> <span class=mi>47</span><span class=p>,</span> <span class=mi>47</span><span class=p>,</span> <span class=mi>47</span><span class=p>,</span> <span class=mi>48</span><span class=p>,</span> <span class=mi>48</span><span class=p>,</span> <span class=mi>48</span><span class=p>,</span> <span class=mi>49</span><span class=p>,</span> <span class=mi>49</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=mi>52</span><span class=p>,</span> <span class=mi>52</span><span class=p>,</span> <span class=mi>52</span><span class=p>,</span> <span class=mi>52</span><span class=p>,</span> <span class=mi>52</span><span class=p>,</span> <span class=mi>52</span><span class=p>,</span> <span class=mi>52</span><span class=p>,</span> <span class=mi>52</span><span class=p>,</span> <span class=mi>52</span><span class=p>,</span> <span class=mi>52</span><span class=p>,</span> <span class=mi>53</span><span class=p>,</span> <span class=mi>53</span><span class=p>,</span> <span class=mi>54</span><span class=p>,</span> <span class=mi>54</span><span class=p>,</span> <span class=mi>54</span><span class=p>,</span> <span class=mi>54</span><span class=p>,</span> <span class=mi>55</span><span class=p>,</span> <span class=mi>55</span><span class=p>,</span> <span class=mi>55</span><span class=p>,</span> <span class=mi>55</span><span class=p>,</span> <span class=mi>55</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=mi>57</span><span class=p>,</span> <span class=mi>57</span><span class=p>,</span> <span class=mi>57</span><span class=p>,</span> <span class=mi>57</span><span class=p>,</span> <span class=mi>57</span><span class=p>,</span> <span class=mi>57</span><span class=p>,</span> <span class=mi>57</span><span class=p>,</span> <span class=mi>57</span><span class=p>,</span> <span class=mi>57</span><span class=p>,</span> <span class=mi>57</span><span class=p>,</span> <span class=mi>58</span><span class=p>,</span> <span class=mi>58</span><span class=p>,</span> <span class=mi>58</span><span class=p>,</span> <span class=mi>58</span><span class=p>,</span> <span class=mi>58</span><span class=p>,</span> <span class=mi>58</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>61</span><span class=p>,</span> <span class=mi>61</span><span class=p>,</span> <span class=mi>61</span><span class=p>,</span> <span class=mi>61</span><span class=p>,</span> <span class=mi>61</span><span class=p>,</span> <span class=mi>62</span><span class=p>,</span> <span class=mi>62</span><span class=p>,</span> <span class=mi>62</span><span class=p>,</span> <span class=mi>62</span><span class=p>,</span> <span class=mi>62</span><span class=p>,</span> <span class=mi>62</span><span class=p>,</span> <span class=mi>62</span><span class=p>,</span> <span class=mi>62</span><span class=p>,</span> <span class=mi>62</span><span class=p>,</span> <span class=mi>62</span><span class=p>,</span> <span class=mi>62</span><span class=p>,</span> <span class=mi>63</span><span class=p>,</span> <span class=mi>63</span><span class=p>,</span> <span class=mi>63</span><span class=p>,</span> <span class=mi>63</span><span class=p>,</span> <span class=mi>63</span><span class=p>,</span> <span class=mi>63</span><span class=p>,</span> <span class=mi>63</span><span class=p>,</span> <span class=mi>63</span><span class=p>,</span> <span class=mi>63</span><span class=p>,</span> <span class=mi>63</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>65</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>,</span> <span class=mi>67</span><span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>roundupsize</span><span class=p>(</span><span class=nx>size</span> <span class=kt>uintptr</span><span class=p>)</span> <span class=kt>uintptr</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>size</span> <span class=p>&lt;</span> <span class=nx>_MaxSmallSize</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 32K内存以内
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// class_to_size 68个不同的内存长度（包含0），对应runtime/sizeclasses.go中表格
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// 当小于等于1016时，从size_to_class8中找，结果时1到32，对应class_to_size中的index
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// 否则从size_to_class128中找，结果是32到68。 最终都是根据index到class_to_size中最终的结果。
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// 其作用就是67个内存长度中找到大于等于size的最接近的长度。 应该是为了效率考虑，直接查的方式，比挨个比较的效率更高。空间换时间
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>if</span> <span class=nx>size</span> <span class=o>&lt;=</span> <span class=nx>smallSizeMax</span><span class=o>-</span><span class=mi>8</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nb>uintptr</span><span class=p>(</span><span class=nx>class_to_size</span><span class=p>[</span><span class=nx>size_to_class8</span><span class=p>[</span><span class=nf>divRoundUp</span><span class=p>(</span><span class=nx>size</span><span class=p>,</span> <span class=nx>smallSizeDiv</span><span class=p>)]])</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>divRoundUp</span><span class=p>(</span><span class=nx>size</span><span class=o>-</span><span class=nx>smallSizeMax</span><span class=p>,</span> <span class=nx>largeSizeDiv</span><span class=p>))</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nb>uintptr</span><span class=p>(</span><span class=nx>class_to_size</span><span class=p>[</span><span class=nx>size_to_class128</span><span class=p>[</span><span class=nf>divRoundUp</span><span class=p>(</span><span class=nx>size</span><span class=o>-</span><span class=nx>smallSizeMax</span><span class=p>,</span> <span class=nx>largeSizeDiv</span><span class=p>)]])</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>size</span><span class=o>+</span><span class=nx>_PageSize</span> <span class=p>&lt;</span> <span class=nx>size</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 这种情况只会发生在溢出时，变成负数了
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>return</span> <span class=nx>size</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nf>alignUp</span><span class=p>(</span><span class=nx>size</span><span class=p>,</span> <span class=nx>_PageSize</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 按8192的倍数向上取整，采用位运算的方式，更加高效
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>alignUp</span><span class=p>(</span><span class=nx>n</span><span class=p>,</span> <span class=nx>a</span> <span class=kt>uintptr</span><span class=p>)</span> <span class=kt>uintptr</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>(</span><span class=nx>n</span> <span class=o>+</span> <span class=nx>a</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&amp;^</span> <span class=p>(</span><span class=nx>a</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>到这里就可以解释int32的切片扩容后为什么是1344了:</p><blockquote><ol><li>正常情况下，按照1.25被扩容后，容量为1024 * 1.25 = 1280;</li><li>int32占4字节，其切片内存大小为，1280 * 4 = 5120;</li><li>通过查下面的表，可以得出大于等于5120的最接近的是5376;</li><li>最终的容量为 5376 / 4 = 1344</li></ol></blockquote><p>同样，也可以算出int64的切片内存对齐后，和原来是没有变化，仍然是1280。简单计算下：</p><blockquote><ol><li>1280 * 8 = 10240;</li><li>查表仍然是10240</li><li>10240 / 8 = 1280。所以没有变化。</li></ol></blockquote><ul><li><strong>go 1.18版本后的修改</strong></li></ul><p>小于256时，双倍扩容；大于等于256时，扩容后容量 = 1.25倍的原容量 + 192。目的主要为了是内存的变化更加平滑。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>growslice</span><span class=p>(</span><span class=nx>et</span> <span class=o>*</span><span class=nx>_type</span><span class=p>,</span> <span class=nx>old</span> <span class=nx>slice</span><span class=p>,</span> <span class=nx>cap</span> <span class=kt>int</span><span class=p>)</span> <span class=nx>slice</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 省略。。。
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>newcap</span> <span class=o>:=</span> <span class=nx>old</span><span class=p>.</span><span class=nx>cap</span>
</span></span><span class=line><span class=cl>	<span class=nx>doublecap</span> <span class=o>:=</span> <span class=nx>newcap</span> <span class=o>+</span> <span class=nx>newcap</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>cap</span> <span class=p>&gt;</span> <span class=nx>doublecap</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>newcap</span> <span class=p>=</span> <span class=nx>cap</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kd>const</span> <span class=nx>threshold</span> <span class=p>=</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>old</span><span class=p>.</span><span class=nx>cap</span> <span class=p>&lt;</span> <span class=nx>threshold</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>newcap</span> <span class=p>=</span> <span class=nx>doublecap</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=c1>// Check 0 &lt; newcap to detect overflow
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=c1>// and prevent an infinite loop.
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>for</span> <span class=mi>0</span> <span class=p>&lt;</span> <span class=nx>newcap</span> <span class=o>&amp;&amp;</span> <span class=nx>newcap</span> <span class=p>&lt;</span> <span class=nx>cap</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=c1>// Transition from growing 2x for small slices
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=c1>// to growing 1.25x for large slices. This formula
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=c1>// gives a smooth-ish transition between the two.
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=nx>newcap</span> <span class=o>+=</span> <span class=p>(</span><span class=nx>newcap</span> <span class=o>+</span> <span class=mi>3</span><span class=o>*</span><span class=nx>threshold</span><span class=p>)</span> <span class=o>/</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=c1>// Set newcap to the requested cap when
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=c1>// the newcap calculation overflowed.
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=k>if</span> <span class=nx>newcap</span> <span class=o>&lt;=</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>newcap</span> <span class=p>=</span> <span class=nx>cap</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 省略。。。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>补充：</li></ul><blockquote><p>int 类型大小为 8 字节, go语言中的int的大小是和操作系统位数相关的，如果是32位操作系统，int类型的大小就是4字节; 如果是64位操作系统，int类型的大小就是8个字节</p><p>int8 类型大小为 1 字节</p><p>int16 类型大小为 2 字节</p><p>int32 类型大小为 4 字节</p><p>int64 类型大小为 8 字节</p></blockquote><p>取值范围</p><blockquote><p>int8: -128 ~ 127</p><p>int16: -32768 ~ 32767</p><p>int32: -2147483648 ~ 2147483647</p><p>int64: -9223372036854775808 ~ 9223372036854775807</p></blockquote><hr><h2 id=结构体里的变量不加tag可以转json字符串吗>结构体里的变量不加tag可以转json字符串吗？<a hidden class=anchor aria-hidden=true href=#结构体里的变量不加tag可以转json字符串吗>#</a></h2><ol><li>如果变量<strong>首字母小写</strong>，即为private变量，无论加不加tag都不可能转为json字段，因为获取不到反射信息。</li></ol><blockquote><p>反射？</p></blockquote><ol start=2><li>如果变量<strong>首字母大写</strong>，为public变量：</li></ol><blockquote></blockquote><ul><li>不加tag：可以转，json内字段名和结构体内字段<code>原名一致</code>；</li><li>加tag，转json的字段名就是tag里的字段名（也就是别名）。</li></ul><blockquote><p>生成json：<code>jsonInfo, err := json.Marshal(struct_J)</code></p><p>展示json内容：<code>string(jsonInfo)</code></p></blockquote><blockquote><p>json对象只支持string作为key。channel、complex、function不能被编码成json。</p></blockquote><hr><h2 id=go语言tcpudp具体实现原理>go语言TCP、UDP具体实现原理<a hidden class=anchor aria-hidden=true href=#go语言tcpudp具体实现原理>#</a></h2><h3 id=tcp-transmission-connect-protocol-传输控制协议>TCP (Transmission Connect Protocol, 传输控制协议)<a hidden class=anchor aria-hidden=true href=#tcp-transmission-connect-protocol-传输控制协议>#</a></h3><p>面向连接的、可靠的、基于字节流的传输层通信协议。提供了全双工通信、流量控制、错误控制等功能。</p><ul><li>TCP基本原理：</li></ul><ol><li><strong>三次握手</strong>：通过三次握手建立TCP连接。</li></ol><p>(1) client向server发送SYN包，请求连接；</p><p>(2) server收到SYN包，向client发送SYN+ACK包，同意连接并确认client的SYN包；</p><p>(3) client收到SYN+ACK包后，向server发送ACK包，确认连接。</p><ol start=2><li><strong>四次挥手</strong>：通过四次挥手断开TCP连接。</li></ol><p>(1) client向server发送FIN包，表示不再发送数据；</p><p>(2) server收到FIN包，向client发送ACK包，确认收到FIN包；</p><p><strong>(3) server向client发送FIN包，表示不再接收数据；</strong></p><p>(4) client收到FIN包后，向server发送ACK包，确认断连。</p><ol start=3><li><strong>流量控制</strong>：TCP使用滑动窗口机制进行流量控制。</li></ol><p>server向client发送数据时，需要考虑client的接收能力，避免数据溢出。</p><ol start=4><li><strong>错误控制</strong>：TCP使用ACK和NACK机制进行错误控制。</li></ol><p>当client收到server发送的数据时，需要发送ACK包确认。如果收到的数据有错，就发送NACK包。</p><h3 id=udp-user-datagram-protocol-用户数据报协议>UDP (User Datagram Protocol, 用户数据报协议)<a hidden class=anchor aria-hidden=true href=#udp-user-datagram-protocol-用户数据报协议>#</a></h3><p>面向事务的、无连接、不可靠的传输层通信协议。
提供了简单快速的数据传输功能。</p><ul><li>UDP基本原理：</li></ul><ol><li>无连接：UDP不需要建立连接，数据包直接发送到目的地址。</li><li>不可靠：不提供可靠性保证，数据包可能丢失、错误或重复。</li><li>简单快速：UDP数据包的head只有8 byte，相对于TCP的20byte head更加简单快速。</li></ol><ul><li>Go语言的网络编程主要涉及以下几个核心概念：</li></ul><blockquote><p>net包：Go语言提供了net包，用于实现网络编程。net包提供了TCP/UDP的基本功能，包括创建、监听、连接、读写等</p></blockquote><blockquote><p>conn：conn是net包中的一个类型，表示一个网络连接。conn包含了连接的两端的地址和数据缓冲区。</p></blockquote><blockquote><p>io包：Go语言的io包提供了一系列的读写器接口，用于实现各种数据流操作。网络编程中，我们经常使用io包的Reader和Writer接口来处理网络数据。</p></blockquote><blockquote><p>bufio包：bufio包提供了基于缓冲的I/O功能，可以提高网络编程的性能。我们可以使用bufio包的Reader和Writer来实现高效的网络数据处理。</p></blockquote><ul><li>TCP：使用 <code>net.Dial</code>/ <code>net.Listen</code> / <code>conn.Write</code> / <code>conn.Read</code> 等</li><li>UDP：使用 <code>net.Dial</code> / <code>net.Listen</code> / <code>conn.Write</code> / <code>conn.ReadFrom</code> / <code>conn.SetReadDeadline</code></li></ul><blockquote><p>问：<code>net.Listen</code>和<code>net.ListenTCP</code>and<code>net.ListenUDP</code>有啥区别？？</p></blockquote><ul><li><p><code>net.Listen()</code>返回一个接口<code>net.Listener</code>，该接口只保证它支持以下方法：<code>Accept()</code>、<code>Close()</code>和<code>Addr()</code>。</p></li><li><p><code>net.ListenTCP()</code>返回一个支持上述三种方法的类型<code>*net.TCPListener</code>，因此(鸭子类型duckTyping)它支持<code>net.Listener</code>接口。但是，它还支持更多特定于TCP的功能，并且可以控制连接接受的低级别方面。像设置<code>SetDeadline()</code>之类的事情。</p></li></ul><p><img loading=lazy src=/images/http_methods.png alt=各种HTTP服务端监听方法的关系></p><ul><li>使用场景<ul><li>Web服务：使用net/http包构建Web服务，提供RESTful API接口。</li><li>聊天室：使用TCP协议实现客户端和服务器之间的实时通信。</li><li>文件传输：使用UDP协议实现高速文件传输，例如P2P文件共享。</li><li>游戏服务器：使用TCP协议实现在线游戏服务器，处理玩家之间的实时通信和数据同步。</li></ul></li></ul><h3 id=tcp和udp的客户端实现>TCP和UDP的客户端实现<a hidden class=anchor aria-hidden=true href=#tcp和udp的客户端实现>#</a></h3><p>一致，只有<code>net.Dial()</code>的第一个参数不同。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Connect TCP
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>conn</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>net</span><span class=p>.</span><span class=nf>Dial</span><span class=p>(</span><span class=s>&#34;tcp&#34;</span><span class=p>,</span> <span class=s>&#34;host:port&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>conn</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1>//simple Read
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>buffer</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>byte</span><span class=p>,</span> <span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>conn</span><span class=p>.</span><span class=nf>Read</span><span class=p>(</span><span class=nx>buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>//simple write
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>conn</span><span class=p>.</span><span class=nf>Write</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&#34;Hello from client&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Connect udp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>conn</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>net</span><span class=p>.</span><span class=nf>Dial</span><span class=p>(</span><span class=s>&#34;udp&#34;</span><span class=p>,</span> <span class=s>&#34;host:port&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>conn</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1>//simple Read
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>buffer</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>byte</span><span class=p>,</span> <span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>conn</span><span class=p>.</span><span class=nf>Read</span><span class=p>(</span><span class=nx>buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>//simple write
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>conn</span><span class=p>.</span><span class=nf>Write</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&#34;Hello from client&#34;</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=tcp和udp的服务端实现>TCP和UDP的服务端实现：<a hidden class=anchor aria-hidden=true href=#tcp和udp的服务端实现>#</a></h3><p>不同，在实现TCP时要用Listener接口监听和建立TCP连接</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// TCP
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>l</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>net</span><span class=p>.</span><span class=nf>Listen</span><span class=p>(</span><span class=s>&#34;tcp&#34;</span><span class=p>,</span> <span class=s>&#34;host:port&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>defer</span> <span class=nx>l</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>conn</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>l</span><span class=p>.</span><span class=nf>Accept</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>go</span> <span class=nf>handleConnection</span><span class=p>(</span><span class=nx>conn</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>handleConnection</span><span class=p>(</span><span class=nx>conn</span> <span class=nx>net</span><span class=p>.</span><span class=nx>Conn</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>buffer</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>byte</span><span class=p>,</span> <span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>conn</span><span class=p>.</span><span class=nf>Read</span><span class=p>(</span><span class=nx>buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>conn</span><span class=p>.</span><span class=nf>Write</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&#34;Hello from server&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>实现UDP时用PacketConn接口取代了Conn接口和Listener。</p><ul><li>与类型Conn不同的是，<code>PackerConn</code>并不支持<code>io.reader</code>和<code>io.writer</code>接口，但是它支持两个特殊的读写方法<code>ReadFrom()</code> 和 <code>WriteTo()</code> 。<code>WriteTo()</code>方法需要提供一个参数作为发送的数据到哪个地址，<code>ReadFrom()</code>则返回数据是从哪个地址接收的。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// UDP
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>pc</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>net</span><span class=p>.</span><span class=nf>ListenPacket</span><span class=p>(</span><span class=s>&#34;udp&#34;</span><span class=p>,</span> <span class=s>&#34;host:port&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>buffer</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>byte</span><span class=p>,</span> <span class=mi>1024</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>pc</span><span class=p>.</span><span class=nf>ReadFrom</span><span class=p>(</span><span class=nx>buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>pc</span><span class=p>.</span><span class=nf>WriteTo</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&#34;Hello from client&#34;</span><span class=p>),</span> <span class=nx>addr</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=go协程调度原理协程为什么快>go协程调度原理，协程为什么快？<a hidden class=anchor aria-hidden=true href=#go协程调度原理协程为什么快>#</a></h2><ul><li>goroutine的理解：</li></ul><p>goroutine，协程，是一种轻量级的用户线程（可以避免用户态到内核态的切换，从而节省了资源开销），由Go运行时调度器进行管理。Go中的每一个协程都会被分配到一个较小的栈空间（默认大小<strong>2KB</strong>），以非常低的成本进行创建和销毁。</p><ul><li>goroutine的运行：</li></ul><p>Go运行时调度器采用了 M:N 的模型，即在M个操作系统线程上运行N个协程。具体来说，Go运行时初始化了一个或多个GOMAXPROCS指定数量的操作系统线程，并在这些线程上运行协程。</p><p><strong>​当一个协程阻塞时，调度器会自动将其与当前协程解除绑定，并将其转移到等待队列中，然后运行其它的协程，从而实现了高效地利用了CPU的时间片。</strong></p><ul><li>goroutine的优势：</li></ul><p>协程不像传统多线程编程那样必须避免线程竞争和加锁解锁等操作。</p><p>在Go中通常通过<strong>channel</strong>实现协程之间的同步和通信。Go的channel机制提供了一种非常有效且安全的协程同步方式，可以避免竞争条件和死锁等问题。</p><p>同时，协程可以自我调节、自我管理，从而可以避免了频繁的线程切换带来的性能损耗。这使得协程有非常快的相应速度和高效的并发处理能力。</p><blockquote><p>扩展：</p></blockquote><ul><li><strong>并发(concurrency) vs 并行(parallelism)</strong></li></ul><p>在单个CPU 核上，线程通过时间片或者让出控制权来实现任务切换，达到 &ldquo;同时&rdquo; 运行多个任务的目的，这就是所谓的并发。但实际上任何时刻都只有一个任务被执行，其他任务通过某种算法来排队。</p><p>只用多核CPU可以让同一进程内的"多个线程" 做到真正意义上的同时运行。</p><ul><li><strong>进程 vs 线程 vs 协程</strong></li></ul><p>进程：系统进行资源分配的基本单位，占有独立的内存空间。</p><p>线程：CPU调度和分配的基本单位，依附于进程存在，每个线程共享父进程的资源。</p><blockquote><p><strong>线程的上下文切换？</strong></p><p>由于<strong>中断处理，多任务处理，用户态切换</strong>等原因会导致 CPU 从一个线程切换到另一个线程，切换过程需要保存当前进程的状态并恢复另一个进程的状态。代价是高昂的。</p></blockquote><p>协程：用户态的轻量级线程，调度完全由用户控制，协程间切换只需要保存任务的上下文，没有内核的开销。</p><blockquote><p>Goroutine 上下文切换只涉及到三个寄存器（PC / SP / DX）的值修改；而对比线程的上下文切换则需要涉及模式切换（从用户态切换到内核态）、以及 16 个寄存器、PC、SP…等寄存器的刷新；</p><p>线程栈空间通常是 2M，Goroutine 栈空间最小 2K；</p><p>Golang 程序中可以轻松支持10w 级别的 Goroutine 运行，而线程数量达到 1k 时，内存占用就已经达到 2G。</p></blockquote><ul><li><strong>Go调度器是啥？</strong></li></ul><p>Go调度器模型通常叫做<strong>GPM模型</strong>，Go程序通过调度器来调度goroutine在内核线程上执行，但是goroutine（G）不直接绑定os线程（M）运行，而是由 goroutine scheduler 中的逻辑处理器（P）来作为获取内核线程资源的“中介”。</p><p>包括4个重要结构，分别是G、P、M、Sched：(G砖头 M地鼠 P小车)</p><blockquote><p>G: Goroutine，协程，运行在线程上；每个 Goroutine 对应一个 G 结构体，G 存储 Goroutine 的运行堆栈、状态以及任务函数，可重用。G 并非执行体，每个 G 需要绑定到 P 才能被调度执行。</p></blockquote><blockquote><p>M: Machine，thread，即线程，循环调取协程并执行；OS 内核线程抽象，代表着真正执行计算的资源。在绑定有效的 P 后，进入 schedule 循环；而 schedule 循环的机制大致是从 Global 队列、P 的 Local 队列以及 wait 队列中获取。</p><p>M 的数量是不定的，由 Go Runtime 调整，为了防止创建过多 OS 线程导致系统调度不过来，目前默认最大限制为 10000 个。</p><p>M 并不保留 G 状态，这是 G 可以跨 M 调度的基础。</p></blockquote><blockquote><p>P: Processor，处理器；对 G 来说，P 相当于 CPU 核，G 只有绑定到 P 才能被调度。对 M 来说，P 提供了相关的执行环境(Context)，如内存分配状态(mcache)，任务队列(G)等。P 的数量决定了系统内最大可并行的 G 的数量（前提：物理 CPU 核数 >= P 的数量）。</p><p>P 的数量由用户设置的 GoMAXPROCS 决定，但是不论 GoMAXPROCS 设置为多大，P 的数量最大为 256。</p></blockquote><blockquote><p>Sched: Go 调度器，它维护有存储 M 和 G 的队列以及调度器的一些状态信息等。调度器循环的机制大致是从各种队列、P 的本地队列中获取 G，切换到 G 的执行栈上并执行 G 的函数，调用 Goexit 做清理工作并回到 M，如此反复。</p></blockquote><p><a href=https://blog.csdn.net/qq_16059847/article/details/105826286>具体讲解地址</a></p><hr><h2 id=go实现基本的排序和查找算法>go实现基本的排序和查找算法<a hidden class=anchor aria-hidden=true href=#go实现基本的排序和查找算法>#</a></h2><p><img loading=lazy src=/images/array_sorting_algorithm.png alt=各种排序算法的复杂度></p><p><a href=https://blog.csdn.net/weixin_47512724/article/details/121888939>详细内容</a></p><h3 id=1基本排序算法>（1）基本排序算法<a hidden class=anchor aria-hidden=true href=#1基本排序算法>#</a></h3><ul><li><p>基于Big-O(n^2)的排序</p><ul><li>选择排序：选数组中最小的元素和第一个元素交换；再选剩下元素中最小的和第二个元素交换，&mldr; 空间O(1)，不稳定</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>selectSort</span><span class=p>(</span><span class=nx>arr</span> <span class=p>[]</span><span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>arr</span><span class=p>);</span> <span class=nx>i</span> <span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  	<span class=nx>minIndex</span> <span class=o>:=</span> <span class=nx>i</span>
</span></span><span class=line><span class=cl>  	<span class=k>for</span> <span class=nx>j</span> <span class=o>:=</span> <span class=nx>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>j</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>arr</span><span class=p>);</span> <span class=nx>j</span> <span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  		<span class=k>if</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>minIndex</span><span class=p>]</span> <span class=p>&gt;</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  			<span class=nx>minIndex</span> <span class=p>=</span> <span class=nx>j</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  		<span class=p>}</span>
</span></span><span class=line><span class=cl>  	<span class=p>}</span>
</span></span><span class=line><span class=cl>  	<span class=nf>swap</span><span class=p>(</span><span class=nx>arr</span><span class=p>,</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>minIndex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>swap</span><span class=p>(</span><span class=nx>arr</span> <span class=p>[]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>j</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>temp</span> <span class=o>:=</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=nx>arr</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=nx>arr</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=p>=</span> <span class=nx>temp</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>冒泡排序: 从第一个元素开始，每次比较相邻元素，按顺序交换，否则继续往后比较下一对，&mldr; 空间O(1)，稳定</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>bubbleSort</span><span class=p>(</span><span class=nx>arr</span> <span class=p>[]</span><span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=nx>e</span> <span class=o>:=</span> <span class=nb>len</span><span class=p>(</span><span class=nx>arr</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>e</span> <span class=p>&gt;</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>e</span> <span class=o>--</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>e</span><span class=p>;</span> <span class=nx>i</span> <span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  		<span class=c1>// 升序
</span></span></span><span class=line><span class=cl><span class=c1></span>  		<span class=k>if</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>&gt;</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  			<span class=nf>swap</span><span class=p>(</span><span class=nx>arr</span><span class=p>,</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  		<span class=p>}</span>
</span></span><span class=line><span class=cl>  	<span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>插入排序：冒泡的每一次冒，都要把无序序列轮一遍；插入排序恰恰相反，一旦你遇到比自己大或小的了，你就知道，后面都是比自己大或小的，现在坐下，当前元素就进入了有序序列。插入的每一次插，都不一定要轮一遍有序序列。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>insertSort</span><span class=p>(</span><span class=nx>arr</span> <span class=p>[]</span><span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 未排序区间
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>arr</span><span class=p>);</span> <span class=nx>i</span> <span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  	<span class=c1>// 已排序区间
</span></span></span><span class=line><span class=cl><span class=c1></span>  	<span class=k>for</span> <span class=nx>j</span> <span class=o>:=</span> <span class=nx>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=o>--</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  		<span class=k>if</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=p>&gt;</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>j</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  			<span class=nf>swap</span><span class=p>(</span><span class=nx>arr</span><span class=p>,</span> <span class=nx>j</span><span class=p>,</span> <span class=nx>j</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  		<span class=p>}</span>
</span></span><span class=line><span class=cl>  	<span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>基于Big-O(nlogn)的排序</p><ul><li>快排：分治思想，空间O(logn), 不稳定</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>  <span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>  	<span class=s>&#34;math/rand&#34;</span>
</span></span><span class=line><span class=cl>  	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>func</span> <span class=nf>quickSort</span><span class=p>(</span><span class=nx>arr</span> <span class=p>[]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>L</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>R</span> <span class=kt>int</span><span class=p>)</span>  <span class=p>{</span>
</span></span><span class=line><span class=cl>  	<span class=k>if</span><span class=p>(</span><span class=nx>L</span> <span class=p>&lt;</span> <span class=nx>R</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  		<span class=nx>lF</span><span class=p>,</span> <span class=nx>rF</span> <span class=o>:=</span> <span class=nb>float32</span><span class=p>(</span><span class=nx>L</span><span class=p>),</span> <span class=nb>float32</span><span class=p>(</span><span class=nx>R</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  		<span class=nx>rand</span><span class=p>.</span><span class=nf>Seed</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>UnixNano</span><span class=p>())</span>
</span></span><span class=line><span class=cl>  		<span class=nx>randomIndex</span> <span class=o>:=</span> <span class=nb>int</span><span class=p>(</span><span class=nx>lF</span> <span class=o>+</span> <span class=nx>rand</span><span class=p>.</span><span class=nf>Float32</span><span class=p>()</span> <span class=o>*</span> <span class=p>(</span><span class=nx>rF</span> <span class=o>-</span> <span class=nx>lF</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))</span><span class=c1>//数组中随机获取下标
</span></span></span><span class=line><span class=cl><span class=c1></span>  		<span class=nf>swap</span><span class=p>(</span><span class=nx>arr</span><span class=p>,</span> <span class=nx>randomIndex</span><span class=p>,</span> <span class=nx>R</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  		<span class=kd>var</span> <span class=nx>p</span> <span class=p>[]</span><span class=kt>int</span> <span class=p>=</span> <span class=nf>partition</span><span class=p>(</span><span class=nx>arr</span><span class=p>,</span> <span class=nx>L</span><span class=p>,</span> <span class=nx>R</span><span class=p>)</span>    <span class=c1>//partition操作返回p[0]和p[1]
</span></span></span><span class=line><span class=cl><span class=c1></span>  		<span class=nf>quickSort</span><span class=p>(</span><span class=nx>arr</span><span class=p>,</span> <span class=nx>L</span><span class=p>,</span> <span class=nx>p</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>           <span class=c1>//p[0]-1为随机下标对应的值的左边
</span></span></span><span class=line><span class=cl><span class=c1></span>  		<span class=nf>quickSort</span><span class=p>(</span><span class=nx>arr</span><span class=p>,</span> <span class=nx>p</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>R</span><span class=p>)</span>           <span class=c1>//p[1]+1为随机下标对应的值的右边
</span></span></span><span class=line><span class=cl><span class=c1></span>  	<span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>func</span> <span class=nf>partition</span><span class=p>(</span><span class=nx>arr</span> <span class=p>[]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>L</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>R</span> <span class=kt>int</span><span class=p>)</span> <span class=p>[]</span><span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  	<span class=nx>less</span><span class=p>,</span> <span class=nx>more</span> <span class=o>:=</span> <span class=nx>L</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>R</span>  <span class=c1>//less区域为小于随机下标对应的值，more区域为大于随机下标对应的值
</span></span></span><span class=line><span class=cl><span class=c1></span>  	<span class=k>for</span> <span class=nx>L</span> <span class=p>&lt;</span> <span class=nx>more</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  		<span class=k>if</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>L</span><span class=p>]</span> <span class=p>&lt;</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>R</span><span class=p>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  			<span class=nx>less</span><span class=o>++</span>
</span></span><span class=line><span class=cl>  			<span class=nf>swap</span><span class=p>(</span><span class=nx>arr</span><span class=p>,</span> <span class=nx>less</span><span class=p>,</span> <span class=nx>L</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  			<span class=nx>L</span><span class=o>++</span>
</span></span><span class=line><span class=cl>  		<span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>L</span><span class=p>]</span> <span class=p>&gt;</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>R</span><span class=p>]{</span>
</span></span><span class=line><span class=cl>  			<span class=nx>more</span><span class=o>--</span>
</span></span><span class=line><span class=cl>  			<span class=nf>swap</span><span class=p>(</span><span class=nx>arr</span><span class=p>,</span> <span class=nx>more</span><span class=p>,</span> <span class=nx>L</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  			<span class=nx>L</span><span class=o>++</span>
</span></span><span class=line><span class=cl>  		<span class=p>}</span>
</span></span><span class=line><span class=cl>  	<span class=p>}</span>
</span></span><span class=line><span class=cl>  	<span class=nf>swap</span><span class=p>(</span><span class=nx>arr</span><span class=p>,</span> <span class=nx>more</span><span class=p>,</span> <span class=nx>R</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  	<span class=k>return</span> <span class=p>[]</span><span class=kt>int</span> <span class=p>{</span><span class=nx>less</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>more</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>归并排：空间复杂度O(n)，稳定</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>func</span> <span class=nf>mergeSort</span><span class=p>(</span><span class=nx>arr</span> <span class=p>[]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>L</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>Mid</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>R</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  	<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>arr</span><span class=p>)</span> <span class=p>&lt;</span> <span class=mi>2</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  		<span class=k>return</span>
</span></span><span class=line><span class=cl>  	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  	<span class=nx>help</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>int</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>R</span> <span class=o>-</span> <span class=nx>L</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  	<span class=nx>p1</span><span class=p>,</span> <span class=nx>p2</span> <span class=o>:=</span> <span class=nx>L</span><span class=p>,</span> <span class=nx>Mid</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  	<span class=k>for</span> <span class=nx>p1</span> <span class=o>&lt;=</span> <span class=nx>Mid</span> <span class=o>&amp;&amp;</span> <span class=nx>p2</span> <span class=o>&lt;=</span> <span class=nx>R</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  		<span class=k>if</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>p1</span><span class=p>]</span> <span class=o>&lt;=</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>p2</span><span class=p>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  			<span class=nx>help</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>help</span><span class=p>,</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>p1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>  			<span class=nx>p1</span><span class=o>++</span>
</span></span><span class=line><span class=cl>  		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  			<span class=nx>help</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>help</span><span class=p>,</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>p2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>  			<span class=nx>p2</span><span class=o>++</span>
</span></span><span class=line><span class=cl>  		<span class=p>}</span>
</span></span><span class=line><span class=cl>  	<span class=p>}</span>
</span></span><span class=line><span class=cl>  	<span class=k>for</span> <span class=nx>p1</span> <span class=o>&lt;=</span> <span class=nx>Mid</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  		<span class=nx>help</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>help</span><span class=p>,</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>p1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>  		<span class=nx>p1</span><span class=o>++</span>
</span></span><span class=line><span class=cl>  	<span class=p>}</span>
</span></span><span class=line><span class=cl>  	<span class=k>for</span> <span class=nx>p2</span> <span class=o>&lt;=</span> <span class=nx>R</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  		<span class=nx>help</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>help</span><span class=p>,</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>p2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>  		<span class=nx>p2</span><span class=o>++</span>
</span></span><span class=line><span class=cl>  	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>help</span><span class=p>);</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  		<span class=nx>arr</span><span class=p>[</span><span class=nx>L</span> <span class=o>+</span> <span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nx>help</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  	<span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>堆排（优先队列）：</li></ul><blockquote><p>heapInsert(arr []int, index int) 建立大根堆，(index * 2) + 1为该节点左孩子，(index * 2) + 2 为该节点右孩子，(index - 1) / 2 为该节点的父节点。若该节点大于父节点，就交换，并且index = (index - 1) / 2。</p><p>heapify(arr []int, index int, heapSize int), 找到最后一个节点lastNode，该节点与当前根节点交换，同时heap&ndash;，即最后位置上为最大值，根节点为极小值。此时从根结点出发，继续heapify的过程(左孩子右孩子较大者与根节点交换, lastNode节点 来到孩子节点较大者位置，继续左右孩子较大者比较，直至没有左右孩子)</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>func</span> <span class=nf>heapInsert</span><span class=p>(</span><span class=nx>arr</span> <span class=p>[]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>index</span> <span class=kt>int</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  	<span class=k>for</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>index</span><span class=p>]</span> <span class=p>&gt;</span> <span class=nx>arr</span><span class=p>[(</span><span class=nx>index</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  		<span class=nf>swap</span><span class=p>(</span><span class=nx>arr</span><span class=p>,</span> <span class=nx>index</span><span class=p>,</span> <span class=p>(</span><span class=nx>index</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  		<span class=nx>index</span> <span class=p>=</span> <span class=p>(</span><span class=nx>index</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>  	<span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>//index * 2 + 1  左孩子节点
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//index * 2 + 2  右孩子节点
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//(index - 1) / 2 父节点
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>func</span> <span class=nf>heapify</span><span class=p>(</span><span class=nx>arr</span> <span class=p>[]</span><span class=kt>int</span><span class=p>,</span> <span class=nx>index</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>heapSize</span> <span class=kt>int</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  	<span class=kd>var</span> <span class=nx>largestIndex</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>  	<span class=nx>leftNode</span> <span class=o>:=</span> <span class=nx>index</span> <span class=o>*</span> <span class=mi>2</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  	<span class=k>for</span> <span class=nx>leftNode</span> <span class=p>&lt;</span> <span class=nx>heapSize</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  		<span class=k>if</span> <span class=nx>leftNode</span> <span class=o>+</span> <span class=mi>1</span> <span class=p>&lt;</span> <span class=nx>heapSize</span> <span class=o>&amp;&amp;</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>leftNode</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=p>&gt;</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>leftNode</span><span class=p>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  			<span class=nx>largestIndex</span> <span class=p>=</span> <span class=nx>leftNode</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  			<span class=nx>largestIndex</span> <span class=p>=</span> <span class=nx>leftNode</span>
</span></span><span class=line><span class=cl>  		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  		<span class=k>if</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>largestIndex</span><span class=p>]</span> <span class=p>&lt;</span> <span class=nx>arr</span><span class=p>[</span><span class=nx>index</span><span class=p>]</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  			<span class=nx>largestIndex</span> <span class=p>=</span> <span class=nx>index</span>
</span></span><span class=line><span class=cl>  		<span class=p>}</span>
</span></span><span class=line><span class=cl>  		<span class=k>if</span> <span class=nx>largestIndex</span> <span class=o>==</span> <span class=nx>index</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  			<span class=k>break</span>
</span></span><span class=line><span class=cl>  		<span class=p>}</span>
</span></span><span class=line><span class=cl>  		<span class=nf>swap</span><span class=p>(</span><span class=nx>arr</span><span class=p>,</span> <span class=nx>largestIndex</span><span class=p>,</span> <span class=nx>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  		<span class=nx>index</span> <span class=p>=</span> <span class=nx>largestIndex</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  		<span class=nx>leftNode</span> <span class=p>=</span> <span class=nx>index</span> <span class=o>*</span> <span class=mi>2</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=2基本查找算法>（2）基本查找算法<a hidden class=anchor aria-hidden=true href=#2基本查找算法>#</a></h3><p><a href="https://blog.csdn.net/qq_25870633/article/details/82705217?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-1-82705217-blog-123477896.235%5Ev43%5Epc_blog_bottom_relevance_base8&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-1-82705217-blog-123477896.235%5Ev43%5Epc_blog_bottom_relevance_base8&amp;utm_relevant_index=2">博文link</a></p><ul><li>七大查找算法：</li></ul><p>顺序查找、二分查找、差值查找、斐波那契查找、 树表查找 (二叉树查找、平衡查找树之2-3查找树、平衡查找树之红黑树、B树和B+树)、分块查找、哈希查找、图查找 (广度优先查找、深度优先查找)</p><ul><li>分类：</li></ul><p>静态查找 vs 动态查找</p><p>有序查找 vs 无序查找</p><hr><h2 id=mysql索引分为几种>mysql索引分为几种？<a hidden class=anchor aria-hidden=true href=#mysql索引分为几种>#</a></h2><ul><li><p>按数据结构：B+tree索引、Hash索引、Full-text索引。</p></li><li><p>按物理存储：聚簇索引、二级索引（辅助索引或者非主键索引）。</p></li></ul><p>MySQL索引按叶子节点存储的是否为完整表数据分为：聚簇索引、二级索引（辅助索引）。全表数据存储在聚簇索引中，聚簇索引以外的其他索引叫做二级索引，也叫辅助索引。</p><ul><li><p>按字段特性：主键索引、普通索引、前缀索引。</p></li><li><p>按字段个数：单列索引、联合索引（复合索引、组合索引）。</p></li></ul><h2 id=redis-vs-mysql>Redis vs MySQL<a hidden class=anchor aria-hidden=true href=#redis-vs-mysql>#</a></h2><ul><li>区别：</li></ul><ol><li>数据类型</li></ol><p>mysql是关系型数据库，主要用于存放持久化数据，将数据存储在硬盘中，读取速度较慢。</p><p>redis是NOSQL，即非关系型数据库，也是缓存数据库，即将数据存储在缓存中，缓存的读取速度快，能够大大的提高运行效率，但是保存时间有限。</p><ol start=2><li>本质区别</li></ol><p>Redis：基于内存，读写速度快，也可做持久化，但是内存空间有限，当数据量超过内存空间时，需扩充内存，而内存成本较高；</p><p>MySQL：基于磁盘，读写速度没有Redis快，但是不受空间容量限制，性价比高；</p><ul><li>redis优缺点</li></ul><ol><li>优点</li></ol><p>速度快：Redis 数据存储在内存中，读写速度非常快，适用于需要高速数据处理的场景。</p><p>数据结构丰富：Redis 支持多种数据结构，如字符串、哈希、列表、集合、有序集合等，可以满足不同类型的数据存储需求。</p><p>支持分布式：Redis 可以通过主从复制和哨兵机制实现分布式部署，提高系统的可靠性和可用性。</p><p>轻量级：Redis 相对其他数据库来说比较轻量级，占用资源少，启动速度快。</p><p>可扩展性：Redis 可以通过插件或扩展机制实现更多的功能，如 Redis Modules。</p><p>支持事务：Redis 提供了简单的事务机制，保证了数据的一致性。</p><ol start=2><li>缺点</li></ol><p>内存限制：由于数据存储在内存中，Redis 的内存容量有限，无法处理大量的数据</p><p>数据持久性：Redis 默认情况下是将数据存储在内存中的，如果没有正确配置持久化机制，数据在服务器重启或故障时可能会丢失。</p><p>复杂性：虽然 Redis 相对简单，但在分布式环境下的管理和配置可能会变得复杂。</p><p>不支持复杂查询：Redis 主要用于简单的数据操作，对于复杂的查询和分析功能较弱。</p><ol start=3><li>使用场景</li></ol><p>缓存：Redis 最常见的用途之一是作为缓存服务器，将频繁访问的数据存储在内存中，以加速数据访问速度。由于 Redis 具有快速的读写速度和丰富的数据结构，适用于各种缓存场景，如网页缓存、会话缓存、对象缓存等。</p><p>会话存储：Redis 可以用作会话存储，将用户会话数据存储在内存中，以提供快速的会话访问和管理。这对于需要跨多个服务器共享会话数据的 Web 应用程序非常有用。</p><p>消息队列：Redis 支持发布/订阅模式（Pub/Sub），可以用作轻量级的消息队列系统，实现消息的发布和订阅，用于异步任务处理、事件通知等场景。</p><p>计数器：Redis 的原子操作能力使其成为实现计数器功能的理想选择。它可以用于统计网站访问量、用户点击量、商品销量等。</p><p>分布式锁：Redis 的分布式锁功能可以用于实现分布式系统中的互斥操作，确保共享资源的安全访问。这对于控制并发访问、避免资源竞争非常有用。</p><p>实时数据分析：Redis 支持持久化和数据备份，可以用于实时数据分析和监控系统，存储实时数据，并支持数据的快速查询和分析。</p><p>任务队列：Redis 可以用作任务队列，用于存储和管理需要异步处理的任务，如后台任务、定时任务等。</p><p>地理位置服务：Redis 的地理位置数据类型（Geo）可以用于存储地理位置信息，并支持基于位置的搜索和查询，用于实现位置服务和地理信息系统。</p><ul><li>mysql优缺点</li></ul><ol><li>优点</li></ol><p>开源和免费：MySQL 是开源软件，可以免费使用，降低了企业的成本负担。</p><p>跨平台性：MySQL 可以在多种操作系统上运行，包括 Windows、Linux、Mac 等，具有良好的跨平台性。</p><p>易于使用：MySQL 的安装和配置相对简单，具有良好的用户文档和社区支持，使得用户可以快速上手并进行数据库管理和查询。</p><p>高性能：MySQL 具有较高的性能，能够处理大量的并发请求，提供高效的数据存取和查询能力。</p><p>可扩展性：MySQL 支持主从复制、分区表、分布式数据库等功能，可以方便地进行系统扩展和负载均衡。</p><ol start=2><li>缺点</li></ol><p>性能瓶颈：在处理大规模数据和高并发请求时，MySQL 可能会遇到性能瓶颈，需要进行优化和调整以满足需求。</p><p>单点故障：MySQL 在单机部署时存在单点故障的风险，需要采取合适的容错和备份策略来保证系统的可靠性和稳定性。</p><p>复杂的管理：虽然 MySQL 相对易于使用，但在大规模部署和管理时，需要花费一定的时间和精力来进行数据库的管理和维护。</p><p>存储引擎限制：MySQL 的存储引擎数量有限，不同的存储引擎具有不同的特性和性能，选择合适的存储引擎需要根据具体需求进行评估。</p><p>事务支持有限：在某些场景下，MySQL 的事务支持可能有限，不适合要求严格事务一致性的应用场景。</p><ol start=3><li>使用场景</li></ol><p>Web 应用程序：MySQL 是许多 Web 应用程序的首选数据库，包括电子商务网站、博客、社交网络、论坛等。它能够处理大量的并发请求，并提供良好的性能和可靠性。</p><p>日志和监控系统：MySQL 可以用于存储日志和监控数据，用于分析系统的运行状态和性能指标，帮助管理员监控和管理系统的运行情况。</p><p>企业应用程序：许多企业级应用程序使用 MySQL 作为其关键的数据存储和管理工具。这些应用程序可能涉及客户关系管理（CRM）、企业资源规划（ERP）、人力资源管理（HRM）等各种业务功能。</p><p>数据仓库和报告系统：MySQL 可以作为数据仓库和报告系统的后端存储，用于存储和管理大量的历史数据，并支持复杂的查询和报告生成。</p><h2 id=es具体的使用方法好在哪里>es具体的使用方法好在哪里？<a hidden class=anchor aria-hidden=true href=#es具体的使用方法好在哪里>#</a></h2><p>Elasticsearch是一个开源的<strong>分布式全文搜索引擎</strong>，它构建在Apache Lucene库之上。它专注于提供快速、弹性和可靠的全文搜索、结构化搜索、分析和可视化功能。</p><p><a href=https://blog.csdn.net/weixin_38201936/article/details/121746906>详细介绍</a></p><ul><li>分布式架构：</li></ul><p>Elasticsearch被设计为在多台服务器上运行，并自动管理数据的分片和复制。这使得它能够处理大规模的数据，并提供高可用性和容错性。</p><ul><li>全文搜索：</li></ul><p>Elasticsearch使用倒排索引技术，可以高效地进行全文搜索。它支持各种查询类型，包括匹配、模糊搜索、范围搜索等。</p><ul><li>实时数据：</li></ul><p>Elasticsearch对数据的更改几乎是实时的，通常在毫秒级别内就可以被索引并可查询。这使得它非常适合需要及时反馈的应用场景，如日志分析、监控数据处理等。</p><ul><li>多语言支持：</li></ul><p>Elasticsearch提供了广泛的语言客户端，使得开发人员可以使用自己熟悉的语言与之交互，如Java、Python、Node.js等。</p><ul><li>弹性扩展：</li></ul><p>Elasticsearch支持水平扩展，可以通过添加更多的节点来增加存储容量和负载能力。它还提供了自动分片和负载均衡机制，使得数据在集群中的分布更加均匀。</p><ul><li>多种数据类型支持：</li></ul><p>除了文本数据，Elasticsearch也可以处理结构化数据和地理位置数据。它支持各种数据类型的索引和查询，包括字符串、数字、日期、布尔值、数组等。</p><ul><li>易于使用的API：</li></ul><p>Elasticsearch提供了RESTful风格的API，可以使用HTTP协议与之进行交互。这使得开发人员可以轻松地索引、查询、修改和删除数据。</p><ul><li>数据聚合与分析：</li></ul><p>Elasticsearch提供了丰富的聚合功能，可以对数据进行统计、分组、筛选和排序等操作。同时，它还集成了Kibana工具，用于可视化和分析数据。</p><h2 id=http状态码>HTTP状态码<a hidden class=anchor aria-hidden=true href=#http状态码>#</a></h2><ul><li>1XX - 提示信息</li><li>2XX - success</li><li>3XX - 重定向</li><li>4XX - 客户端错误，请求有语法错误or请求无法实现<ul><li>400 - bad request 错误请求 服务器不理解请求的语法</li><li>401 - unauthorized 未授权 请求要求身份验证</li><li>402 - 为了将来可能的需求而预留的</li><li>403 - forbidden 禁止 服务器拒绝请求</li><li>404 - not found 未找到 服务器找不到请求的网页</li></ul></li><li>5XX - 服务端错误，服务器未能实现合法的请求</li></ul><h2 id=你在开发过程中遇到了什么困难-以及怎么解决的>你在开发过程中遇到了什么困难 以及怎么解决的<a hidden class=anchor aria-hidden=true href=#你在开发过程中遇到了什么困难-以及怎么解决的>#</a></h2></div><footer class=post-footer><ul class=post-tags><li><a href=https://erica423.github.io/tags/technique/>Technique</a></li></ul><nav class=paginav><a class=next href=https://erica423.github.io/posts/todo/><span class=title>Next »</span><br><span>ToDo | 学习进度</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Tech | Go八股总结 on x" href="https://x.com/intent/tweet/?text=Tech%20%7c%20Go%e5%85%ab%e8%82%a1%e6%80%bb%e7%bb%93&amp;url=https%3a%2f%2ferica423.github.io%2fposts%2ftech%2f&amp;hashtags=Technique"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Tech | Go八股总结 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2ferica423.github.io%2fposts%2ftech%2f&amp;title=Tech%20%7c%20Go%e5%85%ab%e8%82%a1%e6%80%bb%e7%bb%93&amp;summary=Tech%20%7c%20Go%e5%85%ab%e8%82%a1%e6%80%bb%e7%bb%93&amp;source=https%3a%2f%2ferica423.github.io%2fposts%2ftech%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Tech | Go八股总结 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ferica423.github.io%2fposts%2ftech%2f&title=Tech%20%7c%20Go%e5%85%ab%e8%82%a1%e6%80%bb%e7%bb%93"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Tech | Go八股总结 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ferica423.github.io%2fposts%2ftech%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Tech | Go八股总结 on whatsapp" href="https://api.whatsapp.com/send?text=Tech%20%7c%20Go%e5%85%ab%e8%82%a1%e6%80%bb%e7%bb%93%20-%20https%3a%2f%2ferica423.github.io%2fposts%2ftech%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Tech | Go八股总结 on telegram" href="https://telegram.me/share/url?text=Tech%20%7c%20Go%e5%85%ab%e8%82%a1%e6%80%bb%e7%bb%93&amp;url=https%3a%2f%2ferica423.github.io%2fposts%2ftech%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Tech | Go八股总结 on ycombinator" href="https://news.ycombinator.com/submitlink?t=Tech%20%7c%20Go%e5%85%ab%e8%82%a1%e6%80%bb%e7%bb%93&u=https%3a%2f%2ferica423.github.io%2fposts%2ftech%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://erica423.github.io/>Erica-Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>